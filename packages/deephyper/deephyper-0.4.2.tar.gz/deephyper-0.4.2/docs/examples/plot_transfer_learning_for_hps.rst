
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples/plot_transfer_learning_for_hps.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_examples_plot_transfer_learning_for_hps.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_plot_transfer_learning_for_hps.py:


Transfer Learning for Hyperparameter Search
===========================================

**Author(s)**: Romain Egele.

In this example we present how to apply transfer-learning for hyperparameter search. Let's assume you have a bunch of similar tasks for example the search of neural networks hyperparameters for different datasets. You can easily imagine that close choices of hyperparameters can perform well these different datasets even if some light additional tuning can help improve the performance. Therefore, you can perform an expensive search once to then reuse the explored set of hyperparameters of thid search and bias the following search with it. Here, we will use a cheap to compute and easy to understand example where we maximise the :math:`f(x) = -\sum_{i=0}^{n-1}` function. In this case the size of the problem can be defined by the variable :math:`n`. We will start by optimizing the small-size problem where :math:`n=1`, then apply transfer-learning from to optimize the larger-size problem where :math:`n=2` and visualize the difference if were not to apply transfer-learning on this larger problem instance.

Let us start by defining the run-functions of the small and large scale problems:

.. GENERATED FROM PYTHON SOURCE LINES 14-25

.. code-block:: default

    import functools


    def run(config: dict, N: int) -> float:
        y = -sum([config[f"x{i}"] ** 2 for i in range(N)])
        return y


    run_small = functools.partial(run, N=1)
    run_large = functools.partial(run, N=2)








.. GENERATED FROM PYTHON SOURCE LINES 26-27

Then, we can define the hyperparameter problem space based on :math:`n`

.. GENERATED FROM PYTHON SOURCE LINES 27-36

.. code-block:: default

    from deephyper.problem import HpProblem


    N = 1
    problem_small = HpProblem()
    for i in range(N):
        problem_small.add_hyperparameter((-10.0, 10.0), f"x{i}")
    problem_small





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    Configuration space object:
      Hyperparameters:
        x0, Type: UniformFloat, Range: [-10.0, 10.0], Default: 0.0




.. GENERATED FROM PYTHON SOURCE LINES 37-43

.. code-block:: default

    N = 2
    problem_large = HpProblem()
    for i in range(N):
        problem_large.add_hyperparameter((-10.0, 10.0), f"x{i}")
    problem_large





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    Configuration space object:
      Hyperparameters:
        x0, Type: UniformFloat, Range: [-10.0, 10.0], Default: 0.0
        x1, Type: UniformFloat, Range: [-10.0, 10.0], Default: 0.0




.. GENERATED FROM PYTHON SOURCE LINES 44-45

Then, we define setup the search and execute it:

.. GENERATED FROM PYTHON SOURCE LINES 45-57

.. code-block:: default

    from deephyper.evaluator import Evaluator
    from deephyper.evaluator.callback import TqdmCallback
    from deephyper.search.hps import CBO

    results = {}
    max_evals = 20
    evaluator_small = Evaluator.create(
        run_small, method="serial", method_kwargs={"callbacks": [TqdmCallback(max_evals)]}
    )
    search_small = CBO(problem_small, evaluator_small, random_state=42)
    results["Small"] = search_small.search(max_evals)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

      0%|          | 0/20 [00:00<?, ?it/s]      5%|5         | 1/20 [00:00<00:00, 102.30it/s, objective=-35.2]     10%|#         | 2/20 [00:00<00:00, 103.58it/s, objective=-23.6]     15%|#5        | 3/20 [00:00<00:00, 109.31it/s, objective=-23.6]     20%|##        | 4/20 [00:00<00:00, 113.04it/s, objective=-23.6]     25%|##5       | 5/20 [00:00<00:00, 115.63it/s, objective=-23.6]     30%|###       | 6/20 [00:00<00:00, 48.86it/s, objective=-23.6]      30%|###       | 6/20 [00:00<00:00, 48.86it/s, objective=-.545]     35%|###5      | 7/20 [00:00<00:00, 48.86it/s, objective=-.545]     40%|####      | 8/20 [00:00<00:00, 48.86it/s, objective=-.545]     45%|####5     | 9/20 [00:00<00:00, 48.86it/s, objective=-.545]     50%|#####     | 10/20 [00:00<00:00, 48.86it/s, objective=-.545]     55%|#####5    | 11/20 [00:00<00:00, 23.38it/s, objective=-.545]     55%|#####5    | 11/20 [00:00<00:00, 23.38it/s, objective=-.469]     60%|######    | 12/20 [00:00<00:00, 23.38it/s, objective=-.469]     65%|######5   | 13/20 [00:00<00:00, 23.38it/s, objective=-.469]     70%|#######   | 14/20 [00:01<00:00, 10.03it/s, objective=-.469]     70%|#######   | 14/20 [00:01<00:00, 10.03it/s, objective=-.469]     75%|#######5  | 15/20 [00:01<00:00, 10.03it/s, objective=-.469]     80%|########  | 16/20 [00:01<00:00,  7.28it/s, objective=-.469]     80%|########  | 16/20 [00:01<00:00,  7.28it/s, objective=-.469]     85%|########5 | 17/20 [00:01<00:00,  7.28it/s, objective=-.469]     90%|######### | 18/20 [00:02<00:00,  5.87it/s, objective=-.469]     90%|######### | 18/20 [00:02<00:00,  5.87it/s, objective=-.469]     95%|#########5| 19/20 [00:02<00:00,  5.52it/s, objective=-.469]     95%|#########5| 19/20 [00:02<00:00,  5.52it/s, objective=-.469]    100%|##########| 20/20 [00:02<00:00,  5.18it/s, objective=-.469]    100%|##########| 20/20 [00:02<00:00,  5.18it/s, objective=-.469]



.. GENERATED FROM PYTHON SOURCE LINES 58-64

.. code-block:: default

    evaluator_large = Evaluator.create(
        run_large, method="serial", method_kwargs={"callbacks": [TqdmCallback(max_evals)]}
    )
    search_large = CBO(problem_large, evaluator_large, random_state=42)
    results["Large"] = search_large.search(max_evals)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


      0%|          | 0/20 [00:00<?, ?it/s]
      5%|5         | 1/20 [00:00<00:00, 126.68it/s, objective=-58.7]
     10%|#         | 2/20 [00:00<00:00, 24.55it/s, objective=-58.7] 
     15%|#5        | 3/20 [00:00<00:00, 32.13it/s, objective=-58.7]
     20%|##        | 4/20 [00:00<00:00, 38.02it/s, objective=-58.7]
     20%|##        | 4/20 [00:00<00:00, 38.02it/s, objective=-30.2]
     25%|##5       | 5/20 [00:00<00:00, 38.02it/s, objective=-30.2]
     30%|###       | 6/20 [00:00<00:00, 38.02it/s, objective=-30.2]
     35%|###5      | 7/20 [00:00<00:00, 38.02it/s, objective=-30.2]
     40%|####      | 8/20 [00:00<00:00, 38.02it/s, objective=-30.2]
     45%|####5     | 9/20 [00:00<00:00, 39.85it/s, objective=-30.2]
     45%|####5     | 9/20 [00:00<00:00, 39.85it/s, objective=-30.2]
     50%|#####     | 10/20 [00:00<00:00, 39.85it/s, objective=-1.84]
     55%|#####5    | 11/20 [00:00<00:00, 39.85it/s, objective=-1.84]
     60%|######    | 12/20 [00:00<00:00, 39.85it/s, objective=-1.84]
     65%|######5   | 13/20 [00:00<00:00, 10.81it/s, objective=-1.84]
     65%|######5   | 13/20 [00:00<00:00, 10.81it/s, objective=-1.84]
     70%|#######   | 14/20 [00:01<00:00, 10.81it/s, objective=-1.84]
     75%|#######5  | 15/20 [00:01<00:00, 10.81it/s, objective=-.26] 
     80%|########  | 16/20 [00:01<00:00,  6.96it/s, objective=-.26]
     80%|########  | 16/20 [00:01<00:00,  6.96it/s, objective=-.26]
     85%|########5 | 17/20 [00:01<00:00,  6.96it/s, objective=-.26]
     90%|######### | 18/20 [00:02<00:00,  6.00it/s, objective=-.26]
     90%|######### | 18/20 [00:02<00:00,  6.00it/s, objective=-.26]
     95%|#########5| 19/20 [00:02<00:00,  6.00it/s, objective=-.26]
    100%|##########| 20/20 [00:02<00:00,  5.13it/s, objective=-.26]
    100%|##########| 20/20 [00:02<00:00,  5.13it/s, objective=-.26]



.. GENERATED FROM PYTHON SOURCE LINES 65-72

.. code-block:: default

    evaluator_large_tl = Evaluator.create(
        run_large, method="serial", method_kwargs={"callbacks": [TqdmCallback(max_evals)]}
    )
    search_large_tl = CBO(problem_large, evaluator_large_tl, random_state=42)
    search_large_tl.fit_generative_model(results["Large"])
    results["Large+TL"] = search_large_tl.search(max_evals)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none



      0%|          | 0/20 [00:00<?, ?it/s]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


      5%|5         | 1/20 [00:01<00:19,  1.01s/it]

      5%|5         | 1/20 [00:01<00:19,  1.01s/it, objective=-.204]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     10%|#         | 2/20 [00:01<00:18,  1.01s/it, objective=-.132]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     15%|#5        | 3/20 [00:01<00:05,  3.01it/s, objective=-.132]

     15%|#5        | 3/20 [00:01<00:05,  3.01it/s, objective=-.132]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     20%|##        | 4/20 [00:01<00:05,  3.01it/s, objective=-.123]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     25%|##5       | 5/20 [00:01<00:02,  5.12it/s, objective=-.123]

     25%|##5       | 5/20 [00:01<00:02,  5.12it/s, objective=-.123]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     30%|###       | 6/20 [00:01<00:02,  5.12it/s, objective=-.11] /Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     35%|###5      | 7/20 [00:01<00:02,  6.37it/s, objective=-.11]

     35%|###5      | 7/20 [00:01<00:02,  6.37it/s, objective=-.11]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     40%|####      | 8/20 [00:01<00:01,  6.37it/s, objective=-.11]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     45%|####5     | 9/20 [00:01<00:01,  8.13it/s, objective=-.11]

     45%|####5     | 9/20 [00:01<00:01,  8.13it/s, objective=-.11]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     50%|#####     | 10/20 [00:01<00:01,  8.13it/s, objective=-.11]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)
    /Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     55%|#####5    | 11/20 [00:02<00:01,  6.72it/s, objective=-.11]

     55%|#####5    | 11/20 [00:02<00:01,  6.72it/s, objective=-.11]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)
    /Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     60%|######    | 12/20 [00:02<00:01,  4.98it/s, objective=-.11]

     60%|######    | 12/20 [00:02<00:01,  4.98it/s, objective=-.0295]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)
    /Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     65%|######5   | 13/20 [00:02<00:01,  4.34it/s, objective=-.0295]

     65%|######5   | 13/20 [00:02<00:01,  4.34it/s, objective=-.0295]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)
    /Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     70%|#######   | 14/20 [00:03<00:01,  3.90it/s, objective=-.0295]

     70%|#######   | 14/20 [00:03<00:01,  3.90it/s, objective=-.0295]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)
    /Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     75%|#######5  | 15/20 [00:03<00:01,  3.61it/s, objective=-.0295]

     75%|#######5  | 15/20 [00:03<00:01,  3.61it/s, objective=-.0295]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)
    /Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     80%|########  | 16/20 [00:03<00:01,  3.17it/s, objective=-.0295]

     80%|########  | 16/20 [00:03<00:01,  3.17it/s, objective=-.0295]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)
    /Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     85%|########5 | 17/20 [00:04<00:00,  3.09it/s, objective=-.0295]

     85%|########5 | 17/20 [00:04<00:00,  3.09it/s, objective=-.0295]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)
    /Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     90%|######### | 18/20 [00:04<00:00,  3.04it/s, objective=-.0295]

     90%|######### | 18/20 [00:04<00:00,  3.04it/s, objective=-.0295]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)
    /Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


     95%|#########5| 19/20 [00:04<00:00,  2.99it/s, objective=-.0295]

     95%|#########5| 19/20 [00:04<00:00,  2.99it/s, objective=-.0295]/Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)
    /Users/romainegele/miniforge3/envs/dh-0.4/lib/python3.8/site-packages/sdv/tabular/base.py:250: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
      sampled = previous_rows.append(sampled, ignore_index=True)


    100%|##########| 20/20 [00:05<00:00,  2.77it/s, objective=-.0295]

    100%|##########| 20/20 [00:05<00:00,  2.77it/s, objective=-.0295]



.. GENERATED FROM PYTHON SOURCE LINES 73-74

Finally, we compare the results and quickly see that transfer-learning provided a consequant speed-up for the search:

.. GENERATED FROM PYTHON SOURCE LINES 74-88

.. code-block:: default

    import matplotlib.pyplot as plt

    plt.figure()

    for strategy, df in results.items():
        x = [i for i in range(len(df))]
        plt.scatter(x, df.objective, label=strategy)
        plt.plot(x, df.objective.cummax())

    plt.xlabel("Time (sec.)")
    plt.ylabel("Objective")
    plt.grid()
    plt.legend()
    plt.show()



.. image-sg:: /examples/images/sphx_glr_plot_transfer_learning_for_hps_001.png
   :alt: plot transfer learning for hps
   :srcset: /examples/images/sphx_glr_plot_transfer_learning_for_hps_001.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  12.576 seconds)


.. _sphx_glr_download_examples_plot_transfer_learning_for_hps.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_transfer_learning_for_hps.py <plot_transfer_learning_for_hps.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_transfer_learning_for_hps.ipynb <plot_transfer_learning_for_hps.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
