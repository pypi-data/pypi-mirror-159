<!DOCTYPE html>
<html lang="en">
<head>
  <title>DyNeuSR (4D)</title>
  <style> body { margin: 0; } </style>
  <script src="https://unpkg.com/dat.gui"></script>
  <script src="https://unpkg.com/3d-force-graph"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>

  <!--<script src="../../dist/3d-force-graph.js"></script>-->

	<div id="json_graph" data-json='{"directed": false, "multigraph": false, "graph": {"labels": {"meta-column-0": ["-1 S.D.", "Mean (3.14)", "1 S.D."], "data_id": ["Group 1 (0.0, 24.75)", "Group 2 (24.75, 49.5)", "Group 3 (49.5, 74.25)", "Group 4 (74.25, 99.0)"], "uniform": [], "multiclass": ["meta-column-0"]}, "groups": {"meta-column-0": [1, 2, 3], "data_id": [0.0, 24.75, 49.5, 74.25, 99.0], "uniform": [0.0], "multiclass": [0]}, "color_by": "meta-column-0", "color": {"meta-column-0": ["#3182bd", "#a1d99b", "#d9d9d9"], "data_id": ["#3182bd", "#fd8d3c", "#a1d99b", "#dadaeb", "#d9d9d9"]}}, "nodes": [{"id": "cube0_cluster0", "name": "cube0_cluster0", "tooltip": "<b>cube0_cluster0</b> (<b>size:</b> 16)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>81.74</td>\n    </tr>\n  </tbody>\n</table>", "members": [78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 81.74487551158896, "row_count": 16}], "meta-column-0": [{"group": 3, "row_count": 16, "value": 10}, {"group": 2, "row_count": 16, "value": 6}], "data_id": [{"group": 99, "row_count": 16, "value": 16}], "uniform": [{"group": 0, "row_count": 16, "value": 16}]}, "group": {"meta-column-0": 3, "data_id": 99, "uniform": 0}, "size": 16, "degree": 2}, {"id": "cube1_cluster0", "name": "cube1_cluster0", "tooltip": "<b>cube1_cluster0</b> (<b>size:</b> 13)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>28.05</td>\n    </tr>\n  </tbody>\n</table>", "members": [33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 28.052201068417954, "row_count": 13}], "meta-column-0": [{"group": 2, "row_count": 13, "value": 13}], "data_id": [{"group": 49, "row_count": 13, "value": 13}], "uniform": [{"group": 0, "row_count": 13, "value": 13}]}, "group": {"meta-column-0": 2, "data_id": 49, "uniform": 0}, "size": 13, "degree": 2}, {"id": "cube1_cluster1", "name": "cube1_cluster1", "tooltip": "<b>cube1_cluster1</b> (<b>size:</b> 5)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>22.53</td>\n    </tr>\n  </tbody>\n</table>", "members": [74, 75, 76, 77, 78], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 22.530613980290436, "row_count": 5}], "meta-column-0": [{"group": 2, "row_count": 5, "value": 5}], "data_id": [{"group": 74, "row_count": 5, "value": 3}, {"group": 99, "row_count": 5, "value": 2}], "uniform": [{"group": 0, "row_count": 5, "value": 5}]}, "group": {"meta-column-0": 2, "data_id": 74, "uniform": 0}, "size": 5, "degree": 2}, {"id": "cube1_cluster2", "name": "cube1_cluster2", "tooltip": "<b>cube1_cluster2</b> (<b>size:</b> 4)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>22.72</td>\n    </tr>\n  </tbody>\n</table>", "members": [93, 94, 95, 96], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 22.72101353505345, "row_count": 4}], "meta-column-0": [{"group": 3, "row_count": 4, "value": 4}], "data_id": [{"group": 99, "row_count": 4, "value": 4}], "uniform": [{"group": 0, "row_count": 4, "value": 4}]}, "group": {"meta-column-0": 3, "data_id": 99, "uniform": 0}, "size": 4, "degree": 2}, {"id": "cube2_cluster0", "name": "cube2_cluster0", "tooltip": "<b>cube2_cluster0</b> (<b>size:</b> 5)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>29.51</td>\n    </tr>\n  </tbody>\n</table>", "members": [0, 96, 97, 98, 99], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 29.511930988267753, "row_count": 5}], "meta-column-0": [{"group": 3, "row_count": 5, "value": 5}], "data_id": [{"group": 99, "row_count": 5, "value": 4}, {"group": 0, "row_count": 5, "value": 1}], "uniform": [{"group": 0, "row_count": 5, "value": 5}]}, "group": {"meta-column-0": 3, "data_id": 99, "uniform": 0}, "size": 5, "degree": 2}, {"id": "cube2_cluster1", "name": "cube2_cluster1", "tooltip": "<b>cube2_cluster1</b> (<b>size:</b> 6)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>10.09</td>\n    </tr>\n  </tbody>\n</table>", "members": [29, 30, 31, 32, 33, 34], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 10.091176402439942, "row_count": 6}], "meta-column-0": [{"group": 2, "row_count": 6, "value": 6}], "data_id": [{"group": 49, "row_count": 6, "value": 4}, {"group": 24, "row_count": 6, "value": 2}], "uniform": [{"group": 0, "row_count": 6, "value": 6}]}, "group": {"meta-column-0": 2, "data_id": 49, "uniform": 0}, "size": 6, "degree": 2}, {"id": "cube2_cluster2", "name": "cube2_cluster2", "tooltip": "<b>cube2_cluster2</b> (<b>size:</b> 7)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>18.66</td>\n    </tr>\n  </tbody>\n</table>", "members": [44, 45, 46, 47, 48, 49, 50], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 18.659156366775743, "row_count": 7}], "meta-column-0": [{"group": 2, "row_count": 7, "value": 7}], "data_id": [{"group": 49, "row_count": 7, "value": 7}], "uniform": [{"group": 0, "row_count": 7, "value": 7}]}, "group": {"meta-column-0": 2, "data_id": 49, "uniform": 0}, "size": 7, "degree": 2}, {"id": "cube2_cluster3", "name": "cube2_cluster3", "tooltip": "<b>cube2_cluster3</b> (<b>size:</b> 5)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>21.26</td>\n    </tr>\n  </tbody>\n</table>", "members": [70, 71, 72, 73, 74], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 21.26128361520365, "row_count": 5}], "meta-column-0": [{"group": 2, "row_count": 5, "value": 5}], "data_id": [{"group": 74, "row_count": 5, "value": 5}], "uniform": [{"group": 0, "row_count": 5, "value": 5}]}, "group": {"meta-column-0": 2, "data_id": 74, "uniform": 0}, "size": 5, "degree": 2}, {"id": "cube3_cluster0", "name": "cube3_cluster0", "tooltip": "<b>cube3_cluster0</b> (<b>size:</b> 5)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>30.46</td>\n    </tr>\n  </tbody>\n</table>", "members": [0, 1, 2, 3, 99], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 30.46392876208284, "row_count": 5}], "meta-column-0": [{"group": 3, "row_count": 5, "value": 5}], "data_id": [{"group": 24, "row_count": 5, "value": 3}, {"group": 0, "row_count": 5, "value": 1}, {"group": 99, "row_count": 5, "value": 1}], "uniform": [{"group": 0, "row_count": 5, "value": 5}]}, "group": {"meta-column-0": 3, "data_id": 24, "uniform": 0}, "size": 5, "degree": 2}, {"id": "cube3_cluster1", "name": "cube3_cluster1", "tooltip": "<b>cube3_cluster1</b> (<b>size:</b> 5)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>6.98</td>\n    </tr>\n  </tbody>\n</table>", "members": [25, 26, 27, 28, 29], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 6.981317007977319, "row_count": 5}], "meta-column-0": [{"group": 2, "row_count": 5, "value": 4}, {"group": 1, "row_count": 5, "value": 1}], "data_id": [{"group": 24, "row_count": 5, "value": 5}], "uniform": [{"group": 0, "row_count": 5, "value": 5}]}, "group": {"meta-column-0": 2, "data_id": 24, "uniform": 0}, "size": 5, "degree": 2}, {"id": "cube3_cluster2", "name": "cube3_cluster2", "tooltip": "<b>cube3_cluster2</b> (<b>size:</b> 7)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>20.88</td>\n    </tr>\n  </tbody>\n</table>", "members": [49, 50, 51, 52, 53, 54, 55], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 20.880484505677614, "row_count": 7}], "meta-column-0": [{"group": 2, "row_count": 7, "value": 7}], "data_id": [{"group": 49, "row_count": 7, "value": 5}, {"group": 74, "row_count": 7, "value": 2}], "uniform": [{"group": 0, "row_count": 7, "value": 7}]}, "group": {"meta-column-0": 2, "data_id": 49, "uniform": 0}, "size": 7, "degree": 2}, {"id": "cube3_cluster3", "name": "cube3_cluster3", "tooltip": "<b>cube3_cluster3</b> (<b>size:</b> 6)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>23.80</td>\n    </tr>\n  </tbody>\n</table>", "members": [65, 66, 67, 68, 69, 70], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 23.79994434537722, "row_count": 6}], "meta-column-0": [{"group": 2, "row_count": 6, "value": 6}], "data_id": [{"group": 74, "row_count": 6, "value": 6}], "uniform": [{"group": 0, "row_count": 6, "value": 6}]}, "group": {"meta-column-0": 2, "data_id": 74, "uniform": 0}, "size": 6, "degree": 2}, {"id": "cube4_cluster0", "name": "cube4_cluster0", "tooltip": "<b>cube4_cluster0</b> (<b>size:</b> 4)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>12.57</td>\n    </tr>\n  </tbody>\n</table>", "members": [3, 4, 5, 6], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 12.566370614359172, "row_count": 4}], "meta-column-0": [{"group": 3, "row_count": 4, "value": 2}, {"group": 1, "row_count": 4, "value": 2}], "data_id": [{"group": 49, "row_count": 4, "value": 2}, {"group": 24, "row_count": 4, "value": 1}, {"group": 74, "row_count": 4, "value": 1}], "uniform": [{"group": 0, "row_count": 4, "value": 4}]}, "group": {"meta-column-0": 3, "data_id": 49, "uniform": 0}, "size": 4, "degree": 2}, {"id": "cube4_cluster1", "name": "cube4_cluster1", "tooltip": "<b>cube4_cluster1</b> (<b>size:</b> 5)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>5.71</td>\n    </tr>\n  </tbody>\n</table>", "members": [21, 22, 23, 24, 25], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 5.711986642890533, "row_count": 5}], "meta-column-0": [{"group": 1, "row_count": 5, "value": 5}], "data_id": [{"group": 24, "row_count": 5, "value": 5}], "uniform": [{"group": 0, "row_count": 5, "value": 5}]}, "group": {"meta-column-0": 1, "data_id": 24, "uniform": 0}, "size": 5, "degree": 2}, {"id": "cube4_cluster2", "name": "cube4_cluster2", "tooltip": "<b>cube4_cluster2</b> (<b>size:</b> 13)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>45.38</td>\n    </tr>\n  </tbody>\n</table>", "members": [54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 45.378560551852566, "row_count": 13}], "meta-column-0": [{"group": 2, "row_count": 13, "value": 13}], "data_id": [{"group": 74, "row_count": 13, "value": 13}], "uniform": [{"group": 0, "row_count": 13, "value": 13}]}, "group": {"meta-column-0": 2, "data_id": 74, "uniform": 0}, "size": 13, "degree": 2}, {"id": "cube5_cluster0", "name": "cube5_cluster0", "tooltip": "<b>cube5_cluster0</b> (<b>size:</b> 16)<br><br><table border=\"1\" class=\"dataframe\">\n  <tbody>\n    <tr>\n      <td>meta-column-0</td>\n      <td>8.63</td>\n    </tr>\n  </tbody>\n</table>", "members": [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21], "proportions": {"multiclass": [{"label": "meta-column-0", "group": 0, "value": 8.631446482590139, "row_count": 16}], "meta-column-0": [{"group": 1, "row_count": 16, "value": 16}], "data_id": [{"group": 24, "row_count": 16, "value": 12}, {"group": 74, "row_count": 16, "value": 2}, {"group": 99, "row_count": 16, "value": 2}], "uniform": [{"group": 0, "row_count": 16, "value": 16}]}, "group": {"meta-column-0": 1, "data_id": 24, "uniform": 0}, "size": 16, "degree": 2}], "links": [{"value": 1, "size": 1, "kind": "intersection", "n_directional": -1, "distance": 50.0, "strength": 0.0, "source": "cube0_cluster0", "target": "cube1_cluster1"}, {"value": 1, "size": 1, "kind": "intersection", "n_directional": 1, "distance": 50.0, "strength": 0.0, "source": "cube0_cluster0", "target": "cube1_cluster2"}, {"value": 2, "size": 2, "kind": "intersection", "n_directional": -1, "distance": 50.0, "strength": 0.0, "source": "cube1_cluster0", "target": "cube2_cluster1"}, {"value": 2, "size": 2, "kind": "intersection", "n_directional": 1, "distance": 50.0, "strength": 0.0, "source": "cube1_cluster0", "target": "cube2_cluster2"}, {"value": 1, "size": 1, "kind": "intersection", "n_directional": -1, "distance": 50.0, "strength": 0.0, "source": "cube1_cluster1", "target": "cube2_cluster3"}, {"value": 1, "size": 1, "kind": "intersection", "n_directional": 1, "distance": 50.0, "strength": 0.0, "source": "cube1_cluster2", "target": "cube2_cluster0"}, {"value": 2, "size": 2, "kind": "intersection", "n_directional": 1, "distance": 50.0, "strength": 0.0, "source": "cube2_cluster0", "target": "cube3_cluster0"}, {"value": 1, "size": 1, "kind": "intersection", "n_directional": -1, "distance": 50.0, "strength": 0.0, "source": "cube2_cluster1", "target": "cube3_cluster1"}, {"value": 2, "size": 2, "kind": "intersection", "n_directional": 1, "distance": 50.0, "strength": 0.0, "source": "cube2_cluster2", "target": "cube3_cluster2"}, {"value": 1, "size": 1, "kind": "intersection", "n_directional": -1, "distance": 50.0, "strength": 0.0, "source": "cube2_cluster3", "target": "cube3_cluster3"}, {"value": 1, "size": 1, "kind": "intersection", "n_directional": 1, "distance": 50.0, "strength": 0.0, "source": "cube3_cluster0", "target": "cube4_cluster0"}, {"value": 1, "size": 1, "kind": "intersection", "n_directional": -1, "distance": 50.0, "strength": 0.0, "source": "cube3_cluster1", "target": "cube4_cluster1"}, {"value": 2, "size": 2, "kind": "intersection", "n_directional": 1, "distance": 50.0, "strength": 0.0, "source": "cube3_cluster2", "target": "cube4_cluster2"}, {"value": 2, "size": 2, "kind": "intersection", "n_directional": -1, "distance": 50.0, "strength": 0.0, "source": "cube3_cluster3", "target": "cube4_cluster2"}, {"value": 1, "size": 1, "kind": "intersection", "n_directional": 1, "distance": 50.0, "strength": 0.0, "source": "cube4_cluster0", "target": "cube5_cluster0"}, {"value": 1, "size": 1, "kind": "intersection", "n_directional": -1, "distance": 50.0, "strength": 0.0, "source": "cube4_cluster1", "target": "cube5_cluster0"}]}' style="display:none"></div>

</head>

<body>
  <div id="3d-graph"></div>
</body>

  <script> 
    ///////////////////////////////////////////////
    // Helpers
    ///////////////////////////////////////////////
    if (!d3.select("#json_graph").empty()) {
        load_force_graphs();
    } else {
        load_force_graphs_csv("graphs/dyneusr4D_trefoil_knot.csv");
    }
      
    // Load a list of JSON files
    function load_force_graphs() {
        var data = JSON.parse(
            document.getElementById("json_graph").dataset.json
            );
        var inputs = {data:data, source:"default", total:1};
        console.log(inputs);
        draw_force(inputs);
    }

    // Load a list of JSON files
    function load_force_graphs_csv(csv) {
        d3.csv(csv, function(error, data) {
          data.forEach(function(d, i) {
            console.log(i, data.length, d);
            load_force_graph(d.json, data.length);
        }); 
      });
    }

    function load_force_graph(json, n) {
        d3.json(json, function(error, data) {
          var inputs = {data:data, source:json, total:n};
          console.log(inputs);
          draw_force(inputs);
      });
    }
    ///////////////////////////////////////////////
    // main
    ///////////////////////////////////////////////
    // var 
    function draw_force(inputs) {
      var data = inputs.data;
      var source = inputs.source;
      var color_by = 'data_id';

      // hack to load data
      // get some things
      console.log(data);
      var color = data.graph.colors;
      var color_by_options = d3.keys(data.graph.groups);
      var color_by = data.graph.color_by ? data.graph.color_by : color_by_options[0];
      console.log('color_by_options:', color_by_options);
      console.log('color_by:', color_by);
 
      // empty
      let highlightNodes = [];
      let highlightLinks = [];
      let highlightLink = null;

      // settings
      const Settings = function() {
        this.num_dimensions = 3;
        this.link_distance = 'default';
        this.link_width = 0.1;
        this.link_particles = 'net';
        this.color_by = color_by; 
      };
      const settings = new Settings();

      // init graph
      const force = ForceGraph3D()
        (document.getElementById('3d-graph'))
          .graphData(data)
          .nodeAutoColorBy(d => d.group[color_by])
          .nodeOpacity(1)
          .linkOpacity(.5)
          .linkWidth(link => {
            return highlightLinks.indexOf(link) !== -1 ? 1 : 0.1
          })
          .linkDirectionalParticles(link => {
            return highlightLinks.indexOf(link) !== -1 ? link.n_directional : 0;        
          })
          .linkDirectionalParticleWidth(link => {
            return highlightLinks.indexOf(link) !== -1 ? 3 : 1.2;        
          })
          .onNodeHover(node => {
            // no state change
            if ((!node && !highlightNodes.length) || (highlightNodes.length === 1 && highlightNodes[0] === node)) return;
            highlightNodes = node ? [node] : [];
            highlightLinks = data.links.map(link => { 
            if ((link.source === node) || (link.target === node)) 
              return link;
            })
            updateGeometries();
          })
          .onLinkHover(link => {
            // no state change
            if (highlightLink === link) return;
            highlightLink = link;
            highlightLinks = [link];
            highlightNodes = link ? [link.source, link.target] : [];
            updateGeometries();
          })
          .numDimensions(settings.num_dimensions); 

      function updateGeometries() {
        force.nodeRelSize(4); // trigger update of 3d objects in scene
      }

      const linkForce = force 
        .d3Force('link')
        .distance(link => link.distance ? link.distance : 1);
 
      
      //Define GUI
      const gui = new dat.GUI();
      const controller1 = gui.add(settings, 'num_dimensions',[0,1,2,3]);
      const controller2 = gui.add(settings, 'link_distance', [0,0.5,1,5,10,50,100, 'default']);
      const controller3 = gui.add(settings, 'link_width', 0.1, 3);
      const controller4 = gui.add(settings, 'link_particles',['net',0,1,2,3,4,5]);
      const controller5 = gui.add(settings, 'color_by', color_by_options);
      controller1.onChange(updateNumDimensions);
      controller2.onChange(updateLinkDistance);
      controller3.onChange(updateLinkWidth);
      controller4.onChange(updateLinkParticles);
      controller5.onChange(updateNodeColorBy);
      function updateNumDimensions() {
        force.numDimensions(settings.num_dimensions); // Re-heat simulation
      }
      function updateLinkDistance() {
        var ld = settings.link_distance;
        linkForce.distance(link => {
          if (ld === 'default') {
            return link.distance ? link.distance : 1;
          } 
          // assign constant link_distance
          return settings.link_distance;
        });
        force.numDimensions(settings.num_dimensions); // Re-heat simulation
      }
      function updateLinkWidth() {
        var lw = settings.link_width;
        var np = settings.link_particles;
        force.linkWidth(link => {
          return highlightLinks.indexOf(link) !== -1 ? lw*2+1 : lw;
        });
        force.linkDirectionalParticleWidth(link => {
          return highlightLinks.indexOf(link) !== -1 ? lw*2+1 : lw*2+1;
        });
        updateLinkParticles();
      }
      function updateLinkParticles() {
        var np = settings.link_particles;
        force.linkDirectionalParticles(link => {
          if (np === 'net') {
            return link.n_directional;
          }
          return highlightLinks.indexOf(link) !== -1 ? np*2+1 : np;
        });
        
      }
      function updateNodeColorBy() {
        color_by = settings.color_by;
        force.nodeColor(d => d.group[color_by] ? d.group[color_by] : 1);
      }

      // initialize force graph with settings
      function initialize() {
        console.log('Initializing ForceGraph3D...')
        console.log('settings:', settings);
        console.log('force (before):', force);
        updateNumDimensions();
        updateLinkDistance();
        updateLinkWidth();
        updateLinkParticles();
        console.log('force (after):', force);
      }
      initialize();
      
    };
  </script>
</html>

      