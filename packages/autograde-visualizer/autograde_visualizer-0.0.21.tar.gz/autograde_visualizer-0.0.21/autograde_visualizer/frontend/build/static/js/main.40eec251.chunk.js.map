{"version":3,"sources":["svg-pan-zoom-container/utils.ts","svg-pan-zoom-container/pan-on-drag.ts","svg-pan-zoom-container/zoom.ts","svg-pan-zoom-container/index.ts","svg-pan-zoom-container/pan.ts","svg-pan-zoom-container/zoom-on-wheel.ts","index.tsx"],"names":["DomMatrix","window","DOMMatrix","WebKitCSSMatrix","MSCSSMatrix","clamp","value","min","max","getScaleAndOffset","container","content","matrix","style","transform","a","scrollLeft","e","scrollTop","f","setScaleAndOffset","scale","offsetX","offsetY","scrollX","Math","round","scrollY","setAttribute","margin","marginRight","marginBottom","matches","Element","prototype","webkitMatchesSelector","msMatchesSelector","closest","element","selector","call","parentNode","parseOptions","optionsString","options","split","s","index","indexOf","slice","trim","replace","$0","toUpperCase","findTargetAndParseOptions","attributeName","target","HTMLElement","getAttribute","noop","passiveSupported","Object","defineProperty","get","addEventListener","removeEventListener","err","nonPassive","passive","undefined","defaultOptions","preventDefault","event","getScale","firstElementChild","zoom","ratio","minScale","maxScale","origin","previousScale","previousOffsetX","previousOffsetY","offsetScale","previousClientRect","getBoundingClientRect","centerOffsetX","clientX","left","clientY","top","setScale","button","modifier","getModifierState","isPanButtonPressed","previousClientX","onMouseMove","deltaX","deltaY","pan","onMouseUp","initializationOptions","noEmitStyle","document","head","body","documentElement","appendChild","createElement","textContent","zoomAmount","targets","querySelectorAll","i","length","zoomOnWheel","Streamlit","events","RENDER_EVENT","getElementById","c","firstChild","removeChild","svgNode","createElementNS","plotWidth","clientWidth","toString","data","detail","group","upperGroup","connectionGroup","lowerGroup","ticksGroup","upperHeight","lowerHeight","connectionPos","lowerPos","plotHeight","json_data","args","note_data","total_duration","noteEnd","addTicks","y","orientation","t","x","tickEl","textEl","dy","uppperBounds","lowerBounds","noteHeight","el","expectedBegin","expectedEnd","expectedNotePitches","noteBegin","notePitch","mistakes","beginX","endX","noteY","expectedBeginX","expectedEndX","expectedNotePitch","expectedNoteY","expectedNoteEl","bgEl","noteEl","onclick","setComponentValue","connectionEl","points","join","MutationObserver","mutations","forEach","mutation","removeTicks","observe","attributes","attributeFilter","translate","createSVGTransform","setTranslate","baseVal","insertItemBefore","setFrameHeight","setComponentReady"],"mappings":"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","file":"static/js/main.40eec251.chunk.js","sourcesContent":["const DomMatrix = window.DOMMatrix || window.WebKitCSSMatrix || (window as any).MSCSSMatrix\n\nexport function clamp(value: number, min: number, max: number): number {\n  return value < min ? min : value > max ? max : value\n}\n\nexport function getScaleAndOffset(container: Element, content: HTMLElement | SVGElement): [number, number, number] {\n  const matrix = new DomMatrix(content.style.transform)\n  return [matrix.a, container.scrollLeft - matrix.e, container.scrollTop - matrix.f]\n}\n\nexport function setScaleAndOffset(container: Element, content: HTMLElement | SVGElement, scale: number, offsetX: number, offsetY: number) {\n  const scrollX = Math.round(Math.max(offsetX, 0))\n  const scrollY = Math.round(Math.max(offsetY, 0))\n\n  // setAttribute for Chrome, style.transform for Firefox and Safari\n  // content.setAttribute('transform', content.style.transform = `matrix(${scale},0,0,${scale},${scrollX - offsetX},${scrollY - offsetY})`)\n  content.setAttribute('transform', content.style.transform = `matrix(${scale},0,0,1,${scrollX - offsetX},${scrollY - offsetY})`)\n  content.style.margin = 0 as number & string\n  container.scrollLeft = scrollX\n  container.scrollTop = scrollY\n  if (container.scrollLeft !== scrollX) {\n    content.style.marginRight = `${scrollX}px`\n    container.scrollLeft = scrollX\n  }\n  if (container.scrollTop !== scrollY) {\n    content.style.marginBottom = `${scrollY}px`\n    container.scrollTop = scrollY\n  }\n}\n\nconst matches =\n  Element.prototype.matches ||\n  Element.prototype.webkitMatchesSelector ||\n  Element.prototype.msMatchesSelector\n\nconst closest: (element: Element | null, selector: string) => Element | null =\n  !!Element.prototype.closest\n  ? (element, selector) => element && element.closest(selector)\n  : (element, selector) => {\n    while (element && !matches.call(element, selector)) {\n      element = element.parentNode instanceof Element ? element.parentNode : null\n    }\n    return element\n  }\n\nexport function parseOptions(optionsString: string | undefined | null): Record<string, string> {\n  const options: Record<string, string> = {}\n  if (optionsString) {\n    for (const s of optionsString.split(';')) {\n      const index = s.indexOf(':')\n      options[s.slice(0, index).trim().replace(/[a-zA-Z0-9_]-[a-z]/g, $0 => $0[0] + $0[2].toUpperCase())] = s.slice(index + 1).trim()\n    }\n  }\n  return options\n}\n\nexport function findTargetAndParseOptions(element: Element | null, attributeName: string): [HTMLElement, Record<string, string>] | [] {\n  const target = closest(element, `[${attributeName}]`)\n  return target instanceof HTMLElement ? [target, parseOptions(target.getAttribute(attributeName))] : []\n}\n\nfunction noop() {}\n\nlet passiveSupported = false;\n\ntry {\n  const options = Object.defineProperty({}, 'passive', {\n    get() {\n      passiveSupported = true;\n    }\n  })\n\n  window.addEventListener('t', noop, options);\n  window.removeEventListener('t', noop, options);\n} catch(err) {\n  passiveSupported = false;\n}\n\nexport const nonPassive: AddEventListenerOptions | undefined = passiveSupported ? { passive: false } : undefined;\n","import { pan } from './pan'\nimport { findTargetAndParseOptions } from './utils'\n\nexport interface PanOnDragOptions {\n  readonly button: 'left' | 'right'\n  readonly modifier?: 'Alt' | 'Control' | 'Meta' | 'Shift'\n}\n\nconst preventDefault = (event: Event) => event.preventDefault()\n\nexport function panOnDrag(attributeName: string, defaultOptions: PanOnDragOptions) {\n  window.addEventListener('mousedown', event => {\n    if (event.button !== 0 && event.button !== 2) {\n      return\n    }\n    const [target, options] = findTargetAndParseOptions(event.target as Element, attributeName)\n    if (!target || !options || !isPanButtonPressed(event, options, defaultOptions)) {\n      return\n    }\n    event.preventDefault()\n\n    let previousClientX = event.clientX\n    let previousClientY = event.clientY\n\n    const onMouseMove = (event: MouseEvent) => {\n      pan(\n        target,\n        previousClientX - event.clientX,\n        0//previousClientY - event.clientY,\n      )\n      previousClientX = event.clientX\n      previousClientY = event.clientY\n      event.preventDefault()\n    }\n\n    const onMouseUp = () => {\n      window.removeEventListener('mouseup', onMouseUp)\n      window.removeEventListener('mousemove', onMouseMove)\n      window.removeEventListener('contextmenu', preventDefault)\n    }\n\n    window.addEventListener('mouseup', onMouseUp)\n    window.addEventListener('mousemove', onMouseMove)\n    window.addEventListener('contextmenu', preventDefault)\n  })\n}\n\nfunction isPanButtonPressed(event: MouseEvent, options: Partial<PanOnDragOptions>, defaultOptions: PanOnDragOptions) {\n  return (\n    (!options.modifier || event.getModifierState(options.modifier)) &&\n    event.button === ((options.button || defaultOptions.button) === 'right' ? 2 : 0)\n  )\n}\n","import { clamp, getScaleAndOffset, setScaleAndOffset } from './utils'\n\nexport interface ZoomOptions {\n  readonly origin?: {\n    readonly clientX: number\n    readonly clientY: number\n  }\n  readonly minScale?: number\n  readonly maxScale?: number\n}\n\nexport function getScale(container: HTMLElement) {\n  return getScaleAndOffset(container, container.firstElementChild as SVGSVGElement)[0]\n}\n\nexport function setScale(container: HTMLElement, value: number, options: ZoomOptions = {}) {\n  const scale = clamp(value, options.minScale || 1, options.maxScale || 10)\n  const origin = options.origin\n  const content = container.firstElementChild as SVGSVGElement\n  const [previousScale, previousOffsetX, previousOffsetY] = getScaleAndOffset(container, content)\n  if (scale === previousScale) {\n    return\n  }\n  const offsetScale = scale / previousScale - 1\n  const previousClientRect = content.getBoundingClientRect()\n  const centerOffsetX = (origin && origin.clientX || 0) - previousClientRect.left\n  const centerOffsetY = (origin && origin.clientY || 0) - previousClientRect.top\n  const offsetX = previousOffsetX + offsetScale * centerOffsetX\n  // const offsetY = previousOffsetY + offsetScale * centerOffsetY\n  \n  const offsetY = previousOffsetY //+ offsetScale * centerOffsetY\n  setScaleAndOffset(container, content, scale, offsetX, offsetY)\n}\n\nexport function resetScale(container: HTMLElement) {\n  const content = container.firstElementChild as SVGSVGElement\n  content.style.margin = container.scrollLeft = container.scrollTop = 0 as number & string\n  content.removeAttribute('transform')\n  content.style.transform = ''\n}\n\nexport function zoom(container: HTMLElement, ratio: number, options?: ZoomOptions) {\n  setScale(container, getScale(container) * ratio, options)\n}\n","import { panOnDrag } from './pan-on-drag'\nimport { zoomOnWheel } from './zoom-on-wheel'\n\nexport * from './pan'\nexport * from './zoom'\n\npanOnDrag(\n  'data-pan-on-drag',\n  {\n    button: 'left',\n  },\n)\n\nzoomOnWheel(\n  'data-zoom-on-wheel',\n  {\n    minScale: 1,\n    maxScale: 10,\n    zoomAmount: .002,\n  },\n)\n","import { getScaleAndOffset, setScaleAndOffset } from './utils'\n\nexport function pan(container: HTMLElement, deltaX: number, deltaY: number) {\n  const content = container.firstElementChild as SVGSVGElement\n  const [scale, previousOffsetX, previousOffsetY] = getScaleAndOffset(container, content)\n  setScaleAndOffset(container, content, scale, previousOffsetX + deltaX, previousOffsetY + deltaY)\n}\n","import { zoom, ZoomOptions } from './zoom'\nimport { findTargetAndParseOptions, nonPassive, parseOptions } from './utils'\n\nexport interface ZoomOnWheelOptions extends ZoomOptions {\n  readonly zoomAmount: number\n}\n\nexport function zoomOnWheel(attributeName: string, defaultOptions: ZoomOnWheelOptions, initializationOptions: { readonly noEmitStyle?: boolean } = {}) {\n  if (!initializationOptions.noEmitStyle) {\n    (document.head || document.body || document.documentElement)\n      .appendChild(document.createElement('style'))\n      .textContent = `[${attributeName}]{overflow:scroll}[${attributeName}]>:first-child{width:100%;height:100%;vertical-align:middle;transform-origin:0 0}`\n  }\n\n  window.addEventListener('wheel', event => {\n    const [target, options] = findTargetAndParseOptions(event.target as Element, attributeName)\n    if (target instanceof HTMLElement) {\n      const zoomAmount = +options!.zoomAmount || defaultOptions.zoomAmount\n      zoom(target, (1 + zoomAmount) ** -event.deltaY, {\n        origin: event,\n        minScale: +options!.minScale || defaultOptions.minScale,\n        maxScale: +options!.maxScale || defaultOptions.maxScale,\n      })\n      event.preventDefault()\n    }\n  }, nonPassive)\n\n  window.addEventListener('resize', () => {\n    const targets = document.querySelectorAll(`[${attributeName}]`)\n    for (let i = 0; i < targets.length; i++) {\n      const target = targets[i]\n      if (target instanceof HTMLElement) {\n        const options = parseOptions(target.getAttribute(attributeName))\n        zoom(target, 1, options)\n      }\n    }\n  })\n}\n","import { Streamlit, RenderData } from \"streamlit-component-lib\"\nimport './svg-pan-zoom-container'\nimport { getScale, pan } from './svg-pan-zoom-container';\n\nfunction onRender(event: Event): void {\n  const container = document.getElementById('container')\n\n  const c = container!.firstChild\n  if (c !== null) {\n    container!.removeChild(c)\n  }\n\n  const svgNode = container!.appendChild(document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\"))\n\n  const plotWidth = document.body.clientWidth\n  \n  const plotHeight = 500\n  svgNode.setAttribute(\"width\", plotWidth.toString())\n  svgNode.setAttribute(\"height\", plotHeight.toString())\n\n  const data = (event as CustomEvent<RenderData>).detail\n\n  const group = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\")\n  const upperGroup = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\")\n  const connectionGroup = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\")\n  const lowerGroup = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\")\n  const ticksGroup = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\")\n\n  upperGroup.setAttribute('fill', 'white')\n  connectionGroup.setAttribute('stroke', 'white')\n  connectionGroup.setAttribute('stroke-width', '0.2')\n  lowerGroup.setAttribute('fill', 'white')\n\n  const connectionHeight = plotHeight / 8\n  \n  const upperHeight = (plotHeight-connectionHeight) / 2\n  const lowerHeight = (plotHeight-connectionHeight) / 2\n\n  const upperPos = 0\n  const connectionPos = upperPos + upperHeight\n  const lowerPos = connectionPos + connectionHeight\n\n  const json_data = data.args['json']\n  \n  const audioFilename = data.args['audioFilename']\n\n  const note_data = json_data['noteAnnotations']\n\n  const total_duration = note_data[note_data.length-1].noteEnd as number\n\n  const removeTicks = () => {\n    while (ticksGroup.firstChild) {\n        ticksGroup.removeChild(ticksGroup.firstChild)\n    }\n  }\n\n  const addTicks = (scale: number, y: number, orientation: boolean) => {\n    for (let t = 0; t < total_duration; t++) {\n      const x = t / total_duration * plotWidth\n  \n      const tickEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"line\")\n      tickEl.setAttribute('x1', x.toString())\n      tickEl.setAttribute('x2', x.toString())\n      tickEl.setAttribute('y1', y.toString())\n      if (orientation) {\n        tickEl.setAttribute('y2', (y-5).toString())\n      } else {\n        tickEl.setAttribute('y2', (y+5).toString())\n      }\n      tickEl.setAttribute('stroke-width', `${1.0/scale}`)\n      tickEl.setAttribute('stroke', 'white')\n  \n      const textEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"text\")\n      textEl.setAttribute('fill', 'white')\n      const dy = orientation ? 15 : -15\n      textEl.setAttribute('text-anchor', 'middle')\n      textEl.setAttribute('font-size', \"10\")\n      textEl.setAttribute('transform', `translate(${x}, ${y+dy}) scale(${1.0/scale}, 1) rotate(45)`)\n      textEl.textContent = t.toString()\n  \n      ticksGroup.appendChild(tickEl)\n      ticksGroup.appendChild(textEl)\n    }\n  }\n\n  addTicks(1, upperPos+upperHeight, true)\n  addTicks(1, lowerPos, false)\n\n\n  const uppperBounds = svgNode.appendChild(\n    document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\")\n  )\n  uppperBounds.setAttribute('x', \"0\")\n  uppperBounds.setAttribute('y', upperPos.toString())\n  uppperBounds.setAttribute('width', plotWidth.toString())\n  uppperBounds.setAttribute('height', upperHeight.toString())\n  uppperBounds.setAttribute('fill', 'none')\n  uppperBounds.setAttribute('stroke', '#fff')\n\n  const lowerBounds = svgNode.appendChild(\n    document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\")\n  )\n  lowerBounds.setAttribute('x', \"0\")\n  lowerBounds.setAttribute('y', lowerPos.toString())\n  lowerBounds.setAttribute('width', plotWidth.toString())\n  lowerBounds.setAttribute('height', lowerHeight.toString())\n  lowerBounds.setAttribute('fill', 'none')\n  lowerBounds.setAttribute('stroke', '#fff')\n\n  const noteHeight = upperHeight / 127.0\n  \n  for (const el of note_data) {\n      const expectedBegin = el['expectedNoteBegin'] as number\n      const expectedEnd = el['expectedNoteEnd'] as number\n      const expectedNotePitches = el['expectedNotePitch']\n\n      const noteBegin = el['noteBegin'] as number\n      const noteEnd = el['noteEnd'] as number\n      const notePitch = el['notePitch'] as number\n      const mistakes = el['mistakes']\n     \n      const beginX = noteBegin / total_duration * plotWidth\n      const endX = noteEnd / total_duration * plotWidth\n      const noteY = lowerPos + lowerHeight * (127-notePitch) / 127.0\n\n      const expectedBeginX = expectedBegin / total_duration * plotWidth\n      const expectedEndX = expectedEnd / total_duration * plotWidth\n\n      let rest1 = true\n\n      for (let expectedNotePitch of expectedNotePitches) {\n        const expectedNoteY = upperHeight * (127-expectedNotePitch) / 127.0\n\n        if (expectedNotePitch != 0) {\n          const expectedNoteEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\")\n          expectedNoteEl.setAttribute('x', expectedBeginX.toString())\n          expectedNoteEl.setAttribute('y', expectedNoteY.toString())\n          expectedNoteEl.setAttribute('width', (expectedEndX-expectedBeginX).toString())\n          expectedNoteEl.setAttribute('height', noteHeight.toString())\n          expectedNoteEl.setAttribute('stroke', 'none')\n          upperGroup.appendChild(expectedNoteEl)\n\n          const bgEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\")\n          bgEl.setAttribute('x', expectedBeginX.toString())\n          bgEl.setAttribute('y', upperPos.toString())\n          bgEl.setAttribute('width', (expectedEndX-expectedBeginX).toString())\n          bgEl.setAttribute('height', upperHeight.toString())\n          bgEl.setAttribute('fill', '#aaa1')\n          bgEl.setAttribute('stroke', '#aaa')\n          bgEl.setAttribute('stroke-width', '0.1')\n          upperGroup.appendChild(bgEl)\n\n          rest1 = false\n        }\n      }\n\n      let rest2 = true\n\n      if (notePitch != 0) {\n        \n        const noteEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\")\n        noteEl.setAttribute('x', beginX.toString())\n        noteEl.setAttribute('y', (noteY).toString())\n        noteEl.setAttribute('width', (endX-beginX).toString())\n        noteEl.setAttribute('height', noteHeight.toString())\n\n        if (mistakes === '') {\n          noteEl.setAttribute('fill', '#0f0f')\n          noteEl.setAttribute('stroke', 'none')\n        } else {\n          noteEl.setAttribute('fill', '#f00f')\n          noteEl.setAttribute('stroke', 'none')\n        }\n\n        lowerGroup.appendChild(noteEl)\n\n        const bgEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\")\n        bgEl.setAttribute('x', beginX.toString())\n        bgEl.setAttribute('y', lowerPos.toString())\n        bgEl.setAttribute('width', (endX-beginX).toString())\n        bgEl.setAttribute('height', lowerHeight.toString())\n\n        bgEl.setAttribute('fill', '#aaa1')\n        bgEl.setAttribute('stroke', '#aaa')\n\n        bgEl.setAttribute('stroke-width', '0.1')\n        lowerGroup.appendChild(bgEl)\n\n        rest2 = false\n\n        bgEl.onclick = () => {\n            Streamlit.setComponentValue(el)\n        }\n      } else {\n        const bgEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\")\n        bgEl.setAttribute('x', beginX.toString())\n        bgEl.setAttribute('y', lowerPos.toString())\n        bgEl.setAttribute('width', (endX-beginX).toString())\n        bgEl.setAttribute('height', lowerHeight.toString())\n\n        //bgEl.setAttribute('fill', 'none')\n\n        if (mistakes === '') {\n            bgEl.setAttribute('fill', '#afa1')\n            bgEl.setAttribute('stroke', '#0f0f')\n        } else {\n            bgEl.setAttribute('fill', '#faa1')\n            bgEl.setAttribute('stroke', '#f00f')\n        }\n        \n        bgEl.setAttribute('stroke-width', '0.1')\n        lowerGroup.appendChild(bgEl)\n      }\n\n      //if (! (rest1 || rest2)) {\n        const connectionEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"polygon\")\n\n        const points = [\n          expectedBeginX,\n          connectionPos,\n          beginX,\n          lowerPos,\n          endX,\n          lowerPos,\n          expectedEndX,\n          connectionPos\n        ]\n\n        connectionEl.setAttribute('points', points.join(','))\n        connectionEl.setAttribute('fill', '#aaa1')\n        connectionEl.setAttribute('stroke', '#aaa')\n\n        connectionGroup.appendChild(connectionEl)\n      //}\n  }\n\n  // {\n\n  //   let confidence = null\n\n  //   if (json_data['confidence']) {\n  //     confidence = json_data['confidence']\n  //   }\n\n  //   const polylineEl = document.createElementNS(\"http://www.w3.org/2000/svg\", \"polyline\")\n  //   let points = []\n  //   let x = 0\n  //   let deltaX = plotWidth / confidence.length\n\n  //   for (let c of confidence) {\n  //     points.push(x, lowerPos + (1-c)*lowerHeight)\n  //     x += deltaX\n  //   }\n  //   polylineEl.setAttribute('points', points.join(','))\n  //   polylineEl.setAttribute('stroke', '#aaa')\n  //   group.appendChild(polylineEl)\n  // }\n\n  group.appendChild(ticksGroup)\n  group.appendChild(upperGroup)\n  group.appendChild(connectionGroup)\n  group.appendChild(lowerGroup)\n\n  \n\n  svgNode.appendChild(group)\n\n  const observer = new MutationObserver(function (mutations) {\n    mutations.forEach(function (mutation) {\n      let scale = getScale(container!)\n      removeTicks()\n      addTicks(scale, upperPos+upperHeight, true)\n      addTicks(scale, lowerPos, false)\n    });\n  });\n  \n  observer.observe(container!.firstElementChild!, {\n    attributes: true,\n    attributeFilter: ['transform'],\n  });\n\n  let translate = svgNode.createSVGTransform()\n  translate.setTranslate(0, 0);\n  group.transform.baseVal.insertItemBefore(translate, 0);\n\n  Streamlit.setFrameHeight(plotHeight)\n}\n\n// Attach our `onRender` handler to Streamlit's render event.\nStreamlit.events.addEventListener(Streamlit.RENDER_EVENT, onRender)\n\n// Tell Streamlit we're ready to start receiving data. We won't get our\n// first RENDER_EVENT until we call this function.\nStreamlit.setComponentReady()\n\n// Finally, tell Streamlit to update our initial height. We omit the\n// `height` parameter here to have it default to our scrollHeight.\nStreamlit.setFrameHeight(1000)\n"],"sourceRoot":""}