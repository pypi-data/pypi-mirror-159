{"version":3,"sources":["utils.tsx","ImagePositionOverlays.tsx","index.tsx"],"names":["useDebounceEffect","fn","waitTime","deps","useEffect","t","setTimeout","apply","undefined","clearTimeout","withStreamlitConnection","args","initialCrop","initialPositions","unit","rootRef","useRef","imgRef","useState","crop","setCrop","completedCrop","setCompletedCrop","Streamlit","setFrameHeight","repositionOverlay","useCallback","node","collection","document","querySelectorAll","recreate","length","i","remove","createElement","src","overlays","width","height","ele","current","querySelector","prepend","JSON","stringify","onImageLoad","styles","parentElement","style","webkitBoxShadow","boxShadow","hasCrop","setComponentValue","x","y","className","ref","kwargs","onChange","_","onComplete","c","alt","background","onLoad","ReactDOM","render","StrictMode","getElementById"],"mappings":"0PAEO,SAASA,EACdC,EACAC,EACAC,GAEAC,qBAAU,WACR,IAAMC,EAAIC,YAAW,WAEnBL,EAAGM,WAAMC,EAAWL,KACnBD,GAEH,OAAO,WACLO,aAAaJ,MAGdF,G,UC+FUO,eAzGe,SAAC,GAAmB,IAAjBC,EAAgB,EAAhBA,KACzBC,EAAcD,EAAKE,iBAAiB,GACtCD,IACFA,EAAYE,KAAO,MAErB,IAAMC,EAAUC,iBAAuB,MACjCC,EAASD,iBAAyB,MACxC,EAAwBE,mBAAeN,GAAvC,mBAAOO,EAAP,KAAaC,EAAb,KACA,EAA0CF,mBAAgCN,GAA1E,mBAAOS,EAAP,KAAsBC,EAAtB,KAEAlB,qBAAU,kBAAMmB,IAAUC,oBAC1B,IAAMC,EAAoBC,uBACxB,SAACP,GACC,IAIIQ,EAJEC,EAAaC,SAASC,iBAC1B,kCAEIC,EAAiC,IAAtBH,EAAWI,OAE5B,GAAID,EAAU,CACZ,IAAK,IAAIE,EAAI,EAAGA,EAAIL,EAAWI,OAAQC,IACrCL,EAAWK,GAAGC,SAEhBP,EAAOE,SAASM,cAAc,YAE9BR,EAAOC,EAAW,GAKpB,GAHAD,EAAKS,IAAMzB,EAAK0B,SAAS,GACzBV,EAAKW,WAAiB9B,IAATW,EAAqB,EAAIA,EAAKmB,MAAQ,EACnDX,EAAKY,YAAkB/B,IAATW,EAAqB,EAAIA,EAAKoB,OAAS,EACjDR,EAAU,CAAC,IAAD,EACNS,EAAG,UAAGzB,EAAQ0B,eAAX,aAAG,EAAiBC,cAAc,8BAExC,OAAHF,QAAG,IAAHA,KAAKG,QAAQhB,MAIjB,CAACiB,KAAKC,UAAUlC,EAAK0B,YAEjBS,EAAcpB,uBAClB,gBACwBlB,IAAlBa,QAAwCb,IAATW,GACjCM,EAAkBN,GAEpBI,IAAUC,mBAEZ,CAACL,EAAME,EAAeI,IAqCxB,OAjCArB,qBAAU,WACR,GAAuB,OAAnBa,EAAOwB,QAAkB,CAAC,IAAD,MACrBM,GAAS,UAAC9B,EAAOwB,eAAR,iBAAC,EAAgBO,qBAAjB,iBAAC,EAA+BA,qBAAhC,aAAC,EAA8CN,cAAc,+BAAiDO,WAC9GzC,IAAXuC,IACFA,EAAOG,gBAAkB,QACzBH,EAAOI,UAAY,YAGtB,CAAClC,IAEJjB,GACE,WACE,IAAMoD,OAA4B5C,IAAlBa,GAAwD,IAAzBA,EAAckB,QAAwC,IAAxBlB,EAAciB,MAC3Fb,EAAkBJ,GAClBE,IAAU8B,kBAAkB,CAAC,UAAa,CAACD,QAA6B5C,IAAlBa,EAA8B,CAClFiC,EAAGjC,EAAciC,EACjBC,EAAGlC,EAAckC,EACjBjB,MAAOjB,EAAciB,MACrBC,OAAQlB,EAAckB,QACpB,UAEN,EACA,CAAClB,EAAeI,IAGlBzB,GACE,WACEyB,EAAkBN,KAEpB,EACA,CAACA,EAAMM,IAIP,yBAAK+B,UAAU,OACb,yBAAKA,UAAU,iBAAiBC,IAAK1C,GACnC,yBAAKyC,UAAU,kBACf,kBAAC,IAAD,eACEA,UAAU,0BACN7C,EAAK+C,OAFX,CAGEvC,KAAMA,EACNwC,SAAU,SAACxC,EAAMyC,GAAP,OAAaxC,EAAQD,IAC/B0C,WAAY,SAACC,GAAD,OAAOxC,EAAiBwC,MAEpC,yBACEL,IAAKxC,EACL8C,IAAI,aACJ3B,IAAKzB,EAAKqD,WACVC,OAAQnB,UCpGpBoB,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,EAAD,OAEFvC,SAASwC,eAAe,W","file":"static/js/main.90181713.chunk.js","sourcesContent":["import { useEffect, DependencyList } from \"react\";\n\nexport function useDebounceEffect(\n  fn: () => void,\n  waitTime: number,\n  deps?: DependencyList\n) {\n  useEffect(() => {\n    const t = setTimeout(() => {\n      // @ts-ignore\n      fn.apply(undefined, deps);\n    }, waitTime);\n\n    return () => {\n      clearTimeout(t);\n    };\n  // eslint-disable-next-line\n  }, deps);\n}\n","import React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport ReactCrop, { Crop, PixelCrop } from \"react-image-crop\";\nimport { Streamlit, withStreamlitConnection } from \"streamlit-component-lib\";\nimport { useDebounceEffect } from \"./utils\";\n\nimport \"react-image-crop/dist/ReactCrop.css\";\n\nconst ImagePositionOverlays = ({ args }: any) => {\n  const initialCrop = args.initialPositions[0];\n  if (initialCrop) {\n    initialCrop.unit = \"px\";\n  }\n  const rootRef = useRef<HTMLDivElement>(null);\n  const imgRef = useRef<HTMLImageElement>(null);\n  const [crop, setCrop] = useState<Crop>(initialCrop);\n  const [completedCrop, setCompletedCrop] = useState<PixelCrop | undefined>(initialCrop);\n\n  useEffect(() => Streamlit.setFrameHeight());\n  const repositionOverlay = useCallback(\n    (crop: PixelCrop | undefined) => {\n      const collection = document.querySelectorAll(\n        \".ReactCrop__crop-selection img\"\n      );\n      const recreate = collection.length !== 1;\n      var node: HTMLImageElement;\n      if (recreate) {\n        for (let i = 0; i < collection.length; i++) {\n          collection[i].remove();\n        }\n        node = document.createElement(\"img\");\n      } else {\n        node = collection[0] as HTMLImageElement;\n      }\n      node.src = args.overlays[0];\n      node.width = crop === undefined ? 0 : crop.width - 2;\n      node.height = crop === undefined ? 0 : crop.height - 2;\n      if (recreate) {\n        const ele = rootRef.current?.querySelector(\".ReactCrop__crop-selection\");\n        // @ts-ignore\n        ele?.prepend(node);\n      }\n    },\n    // eslint-disable-next-line\n    [JSON.stringify(args.overlays)]\n  );\n  const onImageLoad = useCallback(\n    () => {\n      if (completedCrop === undefined && crop !== undefined) {\n        repositionOverlay(crop as PixelCrop);\n      }\n      Streamlit.setFrameHeight();\n    },\n    [crop, completedCrop, repositionOverlay],\n  );\n\n  // HACK: Remove shadowed background\n  useEffect(() => {\n    if (imgRef.current !== null) {\n      const styles = (imgRef.current?.parentElement?.parentElement?.querySelector(\".ReactCrop__crop-selection\") as HTMLDivElement).style;\n      if (styles !== undefined) {\n        styles.webkitBoxShadow = 'unset';\n        styles.boxShadow = 'unset';\n      }\n    }\n  }, [imgRef]);\n\n  useDebounceEffect(\n    () => {\n      const hasCrop = completedCrop !== undefined && completedCrop.height !== 0 && completedCrop.width !== 0;\n      repositionOverlay(completedCrop);\n      Streamlit.setComponentValue({'positions': [hasCrop && completedCrop !== undefined ? {\n        x: completedCrop.x,\n        y: completedCrop.y,\n        width: completedCrop.width,\n        height: completedCrop.height,\n      } : null]});\n    },\n    1,\n    [completedCrop, repositionOverlay]\n  );\n\n  useDebounceEffect(\n    () => {\n      repositionOverlay(crop as PixelCrop);\n    },\n    0,\n    [crop, repositionOverlay]\n  );\n\n  return (\n    <div className=\"App\">\n      <div className=\"crop-container\" ref={rootRef}>\n        <div className=\"crop-controls\"></div>\n        <ReactCrop\n          className=\"gradient-border-canvas\"\n          {...args.kwargs}\n          crop={crop}\n          onChange={(crop, _) => setCrop(crop)}\n          onComplete={(c) => setCompletedCrop(c)}\n        >\n          <img\n            ref={imgRef}\n            alt=\"Background\"\n            src={args.background}\n            onLoad={onImageLoad}\n          />\n        </ReactCrop>\n      </div>\n    </div>\n  );\n};\n\nexport default withStreamlitConnection(ImagePositionOverlays);\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport ImagePositionOverlays from \"./ImagePositionOverlays\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <ImagePositionOverlays />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}