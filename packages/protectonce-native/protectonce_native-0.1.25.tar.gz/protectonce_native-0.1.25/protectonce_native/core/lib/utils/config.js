const os = require('os');
const coreVersion = require('../../package.json').version;
const uuid = require('uuid');
// TODO: read applicationId and agentId from config
const applicationId = "1234567890_sql_injection";
const agentId = uuid.v4();
class Config {
    set runtimeInfo(runtimeInfo) {
        this._agentRuntimeVersion = runtimeInfo.version || '';
        this._runtime = runtimeInfo.runtime || '';
        this._runtimeVersion = runtimeInfo.runtimeVersion || '';
        this._hostname = runtimeInfo.hostname || '';
        this._bom = runtimeInfo.bom || [];
        this._workLoadId = runtimeInfo.workLoadId || 'DEFAULT_WORKLOAD';
        this._appName = runtimeInfo.appName || '';
    }

    get info() {
        const info = {
            "os": os.platform(),
            "osVersion": os.release(),
            "agentCoreVersion": coreVersion,
            "timestamp": Date.now(),
            "applicationId": applicationId,
            "agentId": agentId,
            "autoGenerated": process.env.PROTECTONCE_WORKLOAD_ID ? 'configured' : 'auto'
        };

        info['agentRuntimeVersion'] = this._agentRuntimeVersion;
        info['agentCoreVersion'] = coreVersion;
        info['runtime'] = this._runtime;
        info['runtimeVersion'] = this._runtimeVersion;
        info['hostname'] = this._hostname;
        info['bom'] = this._bom;
        info['workLoadId'] = this._workLoadId;
        info['appName'] = this._appName;

        return info;
    }

    get syncInterval() {
        // TODO: Read this from rule or config
        return 20000; // 20 secs
    }

}

module.exports = new Config();
