{"version":3,"file":"chunks/app_components_modals_widgetBuilder_addToDashboardModal_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/modals/widgetBuilder/addToDashboardModal.tsx"],"sourcesContent":["import {Fragment, useEffect, useState} from 'react';\nimport {InjectedRouter} from 'react-router';\nimport {css} from '@emotion/react';\nimport styled from '@emotion/styled';\nimport {Query} from 'history';\n\nimport {\n  fetchDashboard,\n  fetchDashboards,\n  updateDashboard,\n} from 'sentry/actionCreators/dashboards';\nimport {addErrorMessage, addSuccessMessage} from 'sentry/actionCreators/indicator';\nimport {ModalRenderProps} from 'sentry/actionCreators/modal';\nimport Button from 'sentry/components/button';\nimport ButtonBar from 'sentry/components/buttonBar';\nimport SelectControl from 'sentry/components/forms/selectControl';\nimport {t, tct} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport {DateString, Organization, PageFilters, SelectValue} from 'sentry/types';\nimport handleXhrErrorResponse from 'sentry/utils/handleXhrErrorResponse';\nimport useApi from 'sentry/utils/useApi';\nimport {\n  DashboardListItem,\n  DisplayType,\n  MAX_WIDGETS,\n  Widget,\n} from 'sentry/views/dashboardsV2/types';\nimport {NEW_DASHBOARD_ID} from 'sentry/views/dashboardsV2/widgetBuilder/utils';\nimport WidgetCard from 'sentry/views/dashboardsV2/widgetCard';\n\ntype WidgetAsQueryParams = Query & {\n  defaultTableColumns: string[];\n  defaultTitle: string;\n  defaultWidgetQuery: string;\n  displayType: DisplayType;\n  environment: string[];\n  project: number[];\n  source: string;\n  end?: DateString;\n  start?: DateString;\n  statsPeriod?: string | null;\n};\n\nexport type AddToDashboardModalProps = {\n  organization: Organization;\n  router: InjectedRouter;\n  selection: PageFilters;\n  widget: Widget;\n  widgetAsQueryParams: WidgetAsQueryParams;\n};\n\ntype Props = ModalRenderProps & AddToDashboardModalProps;\n\nconst SELECT_DASHBOARD_MESSAGE = t('Select a dashboard');\n\nfunction AddToDashboardModal({\n  Header,\n  Body,\n  Footer,\n  closeModal,\n  organization,\n  router,\n  selection,\n  widget,\n  widgetAsQueryParams,\n}: Props) {\n  const api = useApi();\n  const [dashboards, setDashboards] = useState<DashboardListItem[] | null>(null);\n  const [selectedDashboardId, setSelectedDashboardId] = useState<string | null>(null);\n\n  useEffect(() => {\n    // Track mounted state so we dont call setState on unmounted components\n    let unmounted = false;\n\n    fetchDashboards(api, organization.slug).then(response => {\n      // If component has unmounted, dont set state\n      if (unmounted) {\n        return;\n      }\n\n      setDashboards(response);\n    });\n\n    return () => {\n      unmounted = true;\n    };\n  }, [api, organization.slug]);\n\n  function handleGoToBuilder() {\n    const pathname =\n      selectedDashboardId === NEW_DASHBOARD_ID\n        ? `/organizations/${organization.slug}/dashboards/new/widget/new/`\n        : `/organizations/${organization.slug}/dashboard/${selectedDashboardId}/widget/new/`;\n\n    router.push({\n      pathname,\n      query: widgetAsQueryParams,\n    });\n    closeModal();\n  }\n\n  async function handleAddAndStayInDiscover() {\n    if (selectedDashboardId === null || selectedDashboardId === NEW_DASHBOARD_ID) {\n      return;\n    }\n\n    let orderby = widget.queries[0].orderby;\n    if (!!!(DisplayType.AREA && widget.queries[0].columns.length)) {\n      orderby = ''; // Clear orderby if its not a top n visualization.\n    }\n    const query = widget.queries[0];\n\n    const newWidget = {\n      ...widget,\n      title: widget.title === '' ? t('All Events') : widget.title,\n      queries: [{...query, orderby}],\n    };\n\n    try {\n      const dashboard = await fetchDashboard(api, organization.slug, selectedDashboardId);\n      const newDashboard = {\n        ...dashboard,\n        widgets: [...dashboard.widgets, newWidget],\n      };\n\n      await updateDashboard(api, organization.slug, newDashboard);\n\n      closeModal();\n      addSuccessMessage(t('Successfully added widget to dashboard'));\n    } catch (e) {\n      const errorMessage = t('Unable to add widget to dashboard');\n      handleXhrErrorResponse(errorMessage)(e);\n      addErrorMessage(errorMessage);\n    }\n  }\n\n  const canSubmit = selectedDashboardId !== null;\n\n  return (\n    <Fragment>\n      <Header closeButton>\n        <h4>{t('Add to Dashboard')}</h4>\n      </Header>\n\n      <Body>\n        <SelectControlWrapper>\n          <SelectControl\n            disabled={dashboards === null}\n            menuPlacement=\"auto\"\n            name=\"dashboard\"\n            placeholder={t('Select Dashboard')}\n            value={selectedDashboardId}\n            options={\n              dashboards && [\n                {label: t('+ Create New Dashboard'), value: 'new'},\n                ...dashboards.map(({title, id, widgetDisplay}) => ({\n                  label: title,\n                  value: id,\n                  isDisabled: widgetDisplay.length >= MAX_WIDGETS,\n                  tooltip:\n                    widgetDisplay.length >= MAX_WIDGETS &&\n                    tct('Max widgets ([maxWidgets]) per dashboard reached.', {\n                      maxWidgets: MAX_WIDGETS,\n                    }),\n                  tooltipOptions: {position: 'right'},\n                })),\n              ]\n            }\n            onChange={(option: SelectValue<string>) => {\n              if (option.disabled) {\n                return;\n              }\n              setSelectedDashboardId(option.value);\n            }}\n          />\n        </SelectControlWrapper>\n        {t('This is a preview of how the widget will appear in your dashboard.')}\n        <WidgetCard\n          api={api}\n          organization={organization}\n          currentWidgetDragging={false}\n          isEditing={false}\n          isSorting={false}\n          widgetLimitReached={false}\n          selection={selection}\n          widget={widget}\n          showStoredAlert\n        />\n      </Body>\n\n      <Footer>\n        <StyledButtonBar gap={1.5}>\n          <Button\n            onClick={handleAddAndStayInDiscover}\n            disabled={!canSubmit || selectedDashboardId === NEW_DASHBOARD_ID}\n            title={canSubmit ? undefined : SELECT_DASHBOARD_MESSAGE}\n          >\n            {t('Add + Stay in Discover')}\n          </Button>\n          <Button\n            priority=\"primary\"\n            onClick={handleGoToBuilder}\n            disabled={!canSubmit}\n            title={canSubmit ? undefined : SELECT_DASHBOARD_MESSAGE}\n          >\n            {t('Open in Widget Builder')}\n          </Button>\n        </StyledButtonBar>\n      </Footer>\n    </Fragment>\n  );\n}\n\nexport default AddToDashboardModal;\n\nconst SelectControlWrapper = styled('div')`\n  margin-bottom: ${space(2)};\n`;\n\nconst StyledButtonBar = styled(ButtonBar)`\n  @media (max-width: ${props => props.theme.breakpoints.small}) {\n    grid-template-rows: repeat(2, 1fr);\n    gap: ${space(1.5)};\n    width: 100%;\n\n    > button {\n      width: 100%;\n    }\n  }\n`;\n\nexport const modalCss = css`\n  max-width: 700px;\n  margin: 70px auto;\n`;\n"],"names":["SELECT_DASHBOARD_MESSAGE","t","AddToDashboardModal","Header","Body","Footer","closeModal","organization","router","selection","widget","widgetAsQueryParams","api","useApi","dashboards","setDashboards","useState","selectedDashboardId","setSelectedDashboardId","useEffect","unmounted","fetchDashboards","slug","then","response","canSubmit","Fragment","closeButton","SelectControlWrapper","disabled","menuPlacement","name","placeholder","value","options","label","map","title","id","widgetDisplay","isDisabled","length","MAX_WIDGETS","tooltip","tct","maxWidgets","tooltipOptions","position","onChange","option","currentWidgetDragging","isEditing","isSorting","widgetLimitReached","showStoredAlert","StyledButtonBar","gap","onClick","async","NEW_DASHBOARD_ID","orderby","queries","DisplayType","columns","query","newWidget","dashboard","fetchDashboard","newDashboard","widgets","updateDashboard","addSuccessMessage","e","errorMessage","handleXhrErrorResponse","addErrorMessage","undefined","priority","pathname","push","space","ButtonBar","props","theme","breakpoints","small","modalCss"],"sourceRoot":""}