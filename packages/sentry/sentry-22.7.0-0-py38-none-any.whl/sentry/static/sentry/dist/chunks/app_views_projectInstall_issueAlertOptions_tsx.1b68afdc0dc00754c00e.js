"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_projectInstall_issueAlertOptions_tsx"],{"./app/views/alerts/rules/metric/presets.tsx":(e,t,n)=>{n.d(t,{g:()=>c});var s=n("./app/icons/index.tsx"),r=n("./app/locale.tsx"),i=n("./app/utils/guid.tsx"),a=n("./app/views/alerts/rules/metric/types.tsx");async function o(e,t,n){const s=(await e.requestPromise(`/organizations/${t}/events/`,{method:"GET",data:{statsPeriod:"7d",project:n,field:["count()","transaction"],sort:"-count",referrer:"alert.presets.highest-volume",query:"event.type:transaction",per_page:1}})).data[0];return s?[s.transaction,s["count()"]]:null}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return{label:a.F4.CRITICAL,alertThreshold:t,actions:e.teams.slice(0,4).map((e=>({type:a.Us.EMAIL,targetType:a.Lm.TEAM,targetIdentifier:e.id,unsavedDateCreated:(new Date).toISOString(),inputChannelId:null,options:null,unsavedId:(0,i.E)()})))}}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return{label:a.F4.WARNING,alertThreshold:e,actions:[]}}const c=[{id:"p95-highest-volume",title:(0,r.t)("Slow transactions"),description:"Get notified when important transactions are slower on average",Icon:s.TX,alertType:"trans_duration",makeUnqueriedContext:(e,t)=>({name:(0,r.t)("p95 Alert for %s",[e.slug]),aggregate:"p95(transaction.duration)",dataset:a.qz.TRANSACTIONS,eventTypes:[a.GM.TRANSACTION],timeWindow:60,comparisonDelta:1440,comparisonType:a.t6.CHANGE,thresholdType:a.lT.ABOVE,triggers:[l(e),d()]}),async makeContext(e,t,n){var s;const r=null===(s=await o(e,n.slug,t.id))||void 0===s?void 0:s[0];return{...this.makeUnqueriedContext(t,n),query:"transaction:"+r}}},{id:"throughput-highest-volume",title:(0,r.t)("Throttled throughput"),description:"Send an alert when transaction throughput drops significantly",Icon:s.TX,alertType:"throughput",makeUnqueriedContext:(e,t)=>({name:(0,r.t)("Throughput Alert for %s",[e.slug]),aggregate:"count()",dataset:a.qz.TRANSACTIONS,eventTypes:[a.GM.TRANSACTION],timeWindow:30,comparisonDelta:10080,comparisonType:a.t6.CHANGE,thresholdType:a.lT.BELOW,triggers:[l(e,500),d(300)]}),async makeContext(e,t,n){var s;const r=null===(s=await o(e,n.slug,t.id))||void 0===s?void 0:s[0];return{...this.makeUnqueriedContext(t,n),query:"transaction:"+r}}},{id:"apdex-highest-volume",title:(0,r.t)("Apdex Score"),description:"Learn when the ratio of satisfactory, tolerable, and frustrated requests drop",Icon:s.TX,alertType:"apdex",makeUnqueriedContext:(e,t)=>({name:(0,r.t)("Apdex regression for %s",[e.slug]),aggregate:"apdex(300)",dataset:a.qz.TRANSACTIONS,eventTypes:[a.GM.TRANSACTION],timeWindow:30,comparisonDelta:10080,comparisonType:a.t6.CHANGE,thresholdType:a.lT.BELOW,triggers:[l(e),d()]}),async makeContext(e,t,n){var s;const r=null===(s=await o(e,n.slug,t.id))||void 0===s?void 0:s[0];return{...this.makeUnqueriedContext(t,n),query:"transaction:"+r}}}]},"./app/views/projectInstall/issueAlertOptions.tsx":(e,t,n)=>{n.d(t,{r:()=>_,Z:()=>U});var s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(n("../node_modules/core-js/modules/es.error.cause.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/react/index.js")),i=n("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),a=n("../node_modules/@sentry/hub/esm/exports.js"),o=n("../node_modules/lodash/isEqual.js"),l=n.n(o),d=n("./app/components/asyncComponent.tsx"),c=n("./app/components/forms/controls/input.tsx"),u=n("./app/components/forms/controls/radioGroup.tsx"),p=n("./app/styles/space.tsx"),h=n("./app/components/checkboxFancy/checkboxFancy.tsx"),m=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function g(e){return(0,m.tZ)("div",{className:e.className,children:e.choices.map((t=>(0,m.BX)(v,{children:[(0,m.tZ)(h.Z,{size:e.size,isDisabled:t.disabled,isChecked:t.checked,isIndeterminate:t.intermediate,onClick:()=>{var n;null===(n=e.onClick)||void 0===n||n.call(e,t.value)}}),(0,m.tZ)(E,{children:t.title})]},t.value.toString())))})}g.displayName="MultipleCheckboxField";const v=(0,s.Z)("div",{target:"eoudbc51"})("margin-bottom:",(0,p.Z)(2),";display:flex;flex-direction:row;align-items:center;"),E=(0,s.Z)("span",{target:"eoudbc50"})("margin-left:",(0,p.Z)(1),";");var S,A,T=n("./app/components/forms/selectControl.tsx"),f=n("./app/components/pageHeading.tsx"),y=n("./app/locale.tsx"),R=n("./app/utils/withOrganization.tsx"),C=n("./app/views/alerts/rules/metric/presets.tsx");!function(e){e[e.ERRORS=0]="ERRORS",e[e.USERS=1]="USERS"}(S||(S={})),function(e){e[e.ALERT_ON_EVERY_ISSUE=0]="ALERT_ON_EVERY_ISSUE",e[e.CUSTOMIZED_ALERTS=1]="CUSTOMIZED_ALERTS",e[e.CREATE_ALERT_LATER=2]="CREATE_ALERT_LATER"}(A||(A={}));const x="sentry.rules.conditions.event_frequency.EventUniqueUserFrequencyCondition",b="sentry.rules.conditions.event_frequency.EventFrequencyCondition",_="sentry.rules.conditions.event_frequency.EventFrequencyPercentCondition",Z={[S.ERRORS]:b,[S.USERS]:x};function w(e,t,n){let s;switch(t){case S.ERRORS:s=b;break;case S.USERS:s=x;break;default:throw new RangeError("Supplied metric value is not handled")}return{interval:e,id:s,value:n}}class I extends d.Z{getDefaultState(){return{...super.getDefaultState(),conditions:[],intervalChoices:[],alertSetting:A.CREATE_ALERT_LATER.toString(),metric:S.ERRORS,interval:"",threshold:"",metricAlertPresets:new Set}}getAvailableMetricOptions(){return[{value:S.ERRORS,label:(0,y.t)("occurrences of")},{value:S.USERS,label:(0,y.t)("users affected by")}].filter((e=>{var t,n;let{value:s}=e;return null===(t=this.state.conditions)||void 0===t||null===(n=t.some)||void 0===n?void 0:n.call(t,(e=>(null==e?void 0:e.id)===Z[s]))}))}getIssueAlertsChoices(e){const t=[[A.CREATE_ALERT_LATER.toString(),(0,y.t)("I'll create my own alerts later")],[A.ALERT_ON_EVERY_ISSUE.toString(),(0,y.t)("Alert me on every new issue")]];var n;return e&&t.push([A.CUSTOMIZED_ALERTS.toString(),(0,m.BX)(k,{onClick:e=>{e.preventDefault();const t=A.CUSTOMIZED_ALERTS.toString();this.setStateAndUpdateParents({alertSetting:t})},children:[(0,y.t)("When there are more than"),(0,m.tZ)(L,{type:"number",min:"0",name:"",placeholder:"10",value:this.state.threshold,onChange:e=>this.setStateAndUpdateParents({threshold:e.target.value}),"data-test-id":"range-input"}),(0,m.tZ)(N,{value:this.state.metric,options:this.getAvailableMetricOptions(),onChange:e=>this.setStateAndUpdateParents({metric:e.value}),"data-test-id":"metric-select-control"}),(0,y.t)("a unique error in"),(0,m.tZ)(N,{value:this.state.interval,options:null===(n=this.state.intervalChoices)||void 0===n?void 0:n.map((e=>{let[t,n]=e;return{value:t,label:n}})),onChange:e=>this.setStateAndUpdateParents({interval:e.value}),"data-test-id":"interval-select-control"})]},A.CUSTOMIZED_ALERTS)]),t.map((e=>{let[t,n]=e;return[t,(0,m.tZ)(D,{children:n},t)]}))}getUpdatedData(){let e,t;switch(parseInt(this.state.alertSetting,10)){case A.ALERT_ON_EVERY_ISSUE:e=!0,t=!1;break;case A.CREATE_ALERT_LATER:e=!1,t=!1;break;case A.CUSTOMIZED_ALERTS:e=!1,t=!0;break;default:throw new RangeError("Supplied alert creation action is not handled")}return{defaultRules:e,shouldCreateCustomRule:t,name:"Send a notification for new issues",conditions:this.state.interval.length>0&&this.state.threshold.length>0?[w(this.state.interval,this.state.metric,this.state.threshold)]:void 0,actions:[{id:"sentry.rules.actions.notify_event.NotifyEventAction"}],actionMatch:"all",frequency:5,metricAlertPresets:Array.from(this.state.metricAlertPresets)}}setStateAndUpdateParents(e,t){this.setState(e,(()=>{null==t||t(),this.props.onChange(this.getUpdatedData())}))}getEndpoints(){return[["conditions",`/projects/${this.props.organization.slug}/rule-conditions/`]]}onLoadAllEndpointsSuccess(){var e,t;const n=null===(e=this.state.conditions)||void 0===e||null===(t=e.filter)||void 0===t?void 0:t.call(e,(e=>Object.values(Z).includes(null==e?void 0:e.id)));if(!n||0===n.length)return void this.setStateAndUpdateParents({conditions:void 0});const{intervalChoices:s,interval:r}=function(e){var t;const n=e.map((e=>{var t,n;return null===(t=e.formFields)||void 0===t||null===(n=t.interval)||void 0===n?void 0:n.choices})).reduce(((e,t)=>e&&t&&l()(e,t)?e:null));return{intervalChoices:n,interval:null==n||null===(t=n[0])||void 0===t?void 0:t[0]}}(n);if(!s||!r)return a.$e((e=>{e.setExtra("props",this.props),e.setExtra("state",this.state),a.Tb(new Error("Interval choices or sent from API endpoint is inconsistent or empty"))})),void this.setStateAndUpdateParents({conditions:void 0});this.setStateAndUpdateParents({conditions:n,intervalChoices:s,interval:r})}renderBody(){var e;const t=this.getIssueAlertsChoices((null===(e=this.state.conditions)||void 0===e?void 0:e.length)>0),n=!!this.props.organization.experiments.MetricAlertOnProjectCreationExperiment;return(0,m.BX)(r.Fragment,{children:[(0,m.tZ)(P,{withMargins:!0,children:(0,y.t)("Set your default alert settings")}),(0,m.BX)(O,{children:[n&&(0,m.tZ)(M,{children:(0,y.t)("Issue Alerts")}),(0,m.tZ)(j,{choices:t,label:(0,y.t)("Options for creating an alert"),onChange:e=>this.setStateAndUpdateParents({alertSetting:e}),value:this.state.alertSetting}),n&&(0,m.BX)(r.Fragment,{children:[(0,m.tZ)(M,{children:(0,y.t)("Performance Alerts")}),(0,m.tZ)(g,{size:"24px",choices:C.g.map((e=>({title:e.description,value:e.id,checked:this.state.metricAlertPresets.has(e.id)}))),css:q,onClick:e=>{const t=new Set(this.state.metricAlertPresets);t.has(e)?t.delete(e):t.add(e),this.setStateAndUpdateParents({metricAlertPresets:t})}})]})]})]})}}const U=(0,R.Z)(I),q=(0,i.iv)("margin-top:",(0,p.Z)(1),";",""),O=(0,s.Z)("div",{target:"e12p23qf7"})("padding-top:",(0,p.Z)(2),";padding-bottom:",(0,p.Z)(4),";"),k=(0,s.Z)("div",{target:"e12p23qf6"})("display:grid;grid-template-columns:repeat(5, max-content);gap:",(0,p.Z)(1),";align-items:center;"),L=(0,s.Z)(c.Z,{target:"e12p23qf5"})({name:"m0jwvv",styles:"width:80px"}),N=(0,s.Z)(T.Z,{target:"e12p23qf4"})({name:"efbx4f",styles:"width:160px"}),j=(0,s.Z)(u.Z,{target:"e12p23qf3"})("margin-bottom:",(0,p.Z)(2),";"),P=(0,s.Z)(f.Z,{target:"e12p23qf2"})("margin-top:65px;margin-bottom:0;padding-bottom:",(0,p.Z)(3),";border-bottom:1px solid rgba(0, 0, 0, 0.1);"),D=(0,s.Z)("div",{target:"e12p23qf1"})({name:"p9mutn",styles:"min-height:35px;display:flex;flex-direction:column;justify-content:center"}),M=(0,s.Z)("b",{target:"e12p23qf0"})({name:"4zleql",styles:"display:block"})}}]);
//# sourceMappingURL=../sourcemaps/app_views_projectInstall_issueAlertOptions_tsx.0b31ea37d2125231270556c1d17fdac5.js.map