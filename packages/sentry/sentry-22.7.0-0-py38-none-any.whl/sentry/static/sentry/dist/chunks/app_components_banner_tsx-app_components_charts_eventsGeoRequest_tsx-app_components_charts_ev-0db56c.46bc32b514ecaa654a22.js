"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_banner_tsx-app_components_charts_eventsGeoRequest_tsx-app_components_charts_ev-0db56c"],{"./app/components/banner.tsx":(e,t,r)=>{r.d(t,{Z:()=>y});var s=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/react/index.js")),i=r("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),o=r("./app/components/button.tsx"),n=r("./app/components/buttonBar.tsx"),l=r("./app/icons/index.tsx"),d=r("./app/locale.tsx"),m=r("./app/styles/space.tsx"),u=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const c=e=>`${e}-banner-dismissed`;function p(e){localStorage.setItem(c(e),"true")}const g=e=>{let{title:t,subtitle:r,isDismissable:s=!0,dismissKey:i="generic-banner",className:o,backgroundImg:n,backgroundComponent:l,children:m}=e;const[g,y]=function(e){const t=c(e),[r,s]=(0,a.useState)(localStorage.getItem(t));return["true"===r,()=>{s("true"),p(e)}]}(i);return g?null:(0,u.BX)(h,{backgroundImg:n,className:o,children:[l,s?(0,u.tZ)(x,{onClick:y,"aria-label":(0,d.t)("Close")}):null,(0,u.BX)(v,{children:[(0,u.tZ)(D,{children:t}),(0,u.tZ)(b,{children:r}),(0,u.tZ)(f,{gap:1,children:m})]})]})};g.displayName="Banner",g.dismiss=p;const h=(0,s.Z)("div",{target:"e8az5815"})((e=>e.backgroundImg?(0,i.iv)("background:url(",e.backgroundImg,");background-repeat:no-repeat;background-size:cover;background-position:center center;",""):(0,i.iv)("background-color:",e.theme.gray500,";",""))," display:flex;overflow:hidden;align-items:center;justify-content:center;position:relative;margin-bottom:",(0,m.Z)(2),";box-shadow:",(e=>e.theme.dropShadowLight),";border-radius:",(e=>e.theme.borderRadius),";height:180px;color:",(e=>e.theme.white),";@media (min-width: ",(e=>e.theme.breakpoints.small),"){height:220px;}"),v=(0,s.Z)("div",{target:"e8az5814"})("position:absolute;display:grid;justify-items:center;grid-template-rows:repeat(3, max-content);text-align:center;padding:",(0,m.Z)(4),";"),D=(0,s.Z)("h1",{target:"e8az5813"})("margin:0;@media (min-width: ",(e=>e.theme.breakpoints.small),"){font-size:40px;}"),b=(0,s.Z)("div",{target:"e8az5812"})("margin:0;@media (min-width: ",(e=>e.theme.breakpoints.small),"){font-size:",(e=>e.theme.fontSizeExtraLarge),";}"),f=(0,s.Z)(n.ZP,{target:"e8az5811"})("margin-top:",(0,m.Z)(2),";width:fit-content;"),x=(0,s.Z)(o.ZP,{target:"e8az5810"})("position:absolute;display:block;top:",(0,m.Z)(2),";right:",(0,m.Z)(2),";color:",(e=>e.theme.white),";cursor:pointer;z-index:1;");x.defaultProps={icon:(0,u.tZ)(l.bM,{}),"aria-label":(0,d.t)("Close"),priority:"link",borderless:!0,size:"xs"};const y=g},"./app/components/charts/eventsGeoRequest.tsx":(e,t,r)=>{r.d(t,{Z:()=>n}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=r("../node_modules/react/index.js"),a=r("./app/utils/dates.tsx"),i=r("./app/utils/discover/eventView.tsx"),o=r("./app/utils/discover/genericDiscoverQuery.tsx");const n=e=>{let{api:t,organization:r,yAxis:n,query:l,orderby:d,projects:m,period:u,start:c,end:p,environments:g,referrer:h,children:v}=e;const D=i.ZP.fromSavedQuery({id:void 0,name:"",version:2,fields:Array.isArray(n)?n:[n],query:l,orderby:null!=d?d:"",projects:m,range:null!=u?u:"",start:c?(0,a.v5)(c):void 0,end:p?(0,a.v5)(p):void 0,environment:g}),[b,f]=(0,s.useState)(void 0),[x,y]=(0,s.useState)(!1),[Z,j]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{let e=!0;return j(!1),b&&y(!0),(0,o.AA)(t,`/organizations/${r.slug}/events-geo/`,{...D.generateQueryStringObject(),referrer:h}).then((t=>{e&&(f([t[0]]),y(!1))})).catch((()=>{e&&(j(!0),y(!1))})),()=>{e=!1}}),[l,n,c,p,u,g,m]),v({errored:Z,loading:!b&&!Z,reloading:x,tableData:b})}},"./app/components/charts/eventsRequest.tsx":(e,t,r)=>{r.d(t,{Z:()=>x});var s=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=(r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/react/index.js")),i=r("../node_modules/lodash/isEqual.js"),o=r.n(i),n=r("../node_modules/lodash/omitBy.js"),l=r.n(n),d=r("./app/actionCreators/events.tsx"),m=r("./app/actionCreators/indicator.tsx"),u=r("./app/components/charts/loadingPanel.tsx"),c=r("./app/components/charts/utils.tsx"),p=r("./app/locale.tsx"),g=r("./app/utils.tsx"),h=r("./app/utils/discover/fields.tsx"),v=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const D=["api","children","organization","loading","queryBatching","generatePathname"],b=e=>l()(e,((e,t)=>D.includes(t)));class f extends a.PureComponent{constructor(){super(...arguments),(0,s.Z)(this,"state",{reloading:!!this.props.loading,errored:!1,timeseriesData:null,fetchedWithPrevious:!1}),(0,s.Z)(this,"unmounting",!1),(0,s.Z)(this,"fetchData",(async()=>{const{api:e,confirmedQuery:t,onError:r,expired:s,name:a,hideError:i,...o}=this.props;let n,l=null;if(!1!==t){if(this.setState((e=>({reloading:null!==e.timeseriesData,errored:!1,errorMessage:void 0}))),s)n=(0,p.t)("%s has an invalid date range. Please try a more recent date range.",a),(0,m.Iw)(n,{append:!0}),this.setState({errored:!0,errorMessage:n});else try{e.clear(),l=await(0,d.lI)(e,o)}catch(e){n=e&&e.responseJSON&&e.responseJSON.detail?e.responseJSON.detail:(0,p.t)("Error loading chart data"),i||(0,m.Iw)(n),r&&r(n),this.setState({errored:!0,errorMessage:n})}this.unmounting||this.setState({reloading:!1,timeseriesData:l,fetchedWithPrevious:o.includePrevious})}})),(0,s.Z)(this,"getData",(e=>{const{fetchedWithPrevious:t}=this.state,{period:r,includePrevious:s}=this.props,a=t||(0,c.Sw)(s,r),i=Math.floor(e.length/2);return{current:a?e.slice(i):e,previous:a?e.slice(0,i):null}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){o()(b(e),b(this.props))||this.fetchData()}componentWillUnmount(){this.unmounting=!0}calculateTotalsPerTimestamp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>1e3*e;return e.map(((e,r)=>{let[s,a]=e;return{name:t(s,a,r),value:a.reduce(((e,t)=>{let{count:r}=t;return e+r}),0)}}))}transformPreviousPeriodData(e,t,r){return t?{seriesName:null!=r?r:"Previous",data:this.calculateTotalsPerTimestamp(t,((t,r,s)=>1e3*e[s][0])),stack:"previous"}:null}transformAggregatedTimeseries(e){return{seriesName:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",data:this.calculateTotalsPerTimestamp(e)}}transformTimeseriesData(e,t){return[{seriesName:t||"Current",data:e.map((e=>{let[t,r]=e;return{name:1e3*t,value:r.reduce(((e,t)=>{let{count:r}=t;return e+r}),0)}}))}]}transformComparisonTimeseriesData(e){return[{seriesName:"comparisonCount()",data:e.map((e=>{let[t,r]=e;return{name:1e3*t,value:r.reduce(((e,t)=>{let{comparisonCount:r}=t;return e+(null!=r?r:0)}),0)}}))}]}processData(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;const{data:a,isMetricsData:i,totals:o}=e,{includeTransformedData:n,includeTimeAggregation:l,timeAggregationSeriesName:d,currentSeriesNames:m,previousSeriesNames:u,comparisonDelta:p}=this.props,{current:g,previous:h}=this.getData(a);return{data:n?this.transformTimeseriesData(g,null!=s?s:null==m?void 0:m[r]):[],comparisonData:n&&p?this.transformComparisonTimeseriesData(g):[],allData:a,originalData:g,totals:o,isMetricsData:i,originalPreviousData:h,previousData:n?this.transformPreviousPeriodData(g,h,null!==(t=s?(0,c.TE)(s):void 0)&&void 0!==t?t:null==u?void 0:u[r]):null,timeAggregatedData:l?this.transformAggregatedTimeseries(g,d||""):{},timeframe:e.start&&e.end?h?{start:500*(e.start+e.end),end:1e3*e.end}:{start:1e3*e.start,end:1e3*e.end}:void 0}}render(){const{children:e,showLoading:t,...r}=this.props,{topEvents:s}=this.props,{timeseriesData:a,reloading:i,errored:o,errorMessage:n}=this.state,l=this.props.loading||null===a;if(t&&l)return(0,v.tZ)(u.Z,{"data-test-id":"events-request-loading"});if((0,c.Xe)(a,(0,g.ri)(s))){let t;const s={},d=Object.keys(a).map(((e,r)=>{const i=a[e],o=this.processData(i,r,(0,h.bQ)(e));return t||(t=o.timeframe),o.isMetricsData&&(s[e]={isMetricsData:o.isMetricsData}),[i.order||0,o.data[0],o.previousData,{isMetricsData:o.isMetricsData}]})).sort(((e,t)=>e[0]-t[0])),m=d.map((e=>e[1])),u=d.some((e=>null===e[2]))?void 0:d.map((e=>e[2]));return e({loading:l,reloading:i,errored:o,errorMessage:n,results:m,timeframe:t,previousTimeseriesData:u,seriesAdditionalInfo:s,...r})}if(a){var d,m;const{data:t,comparisonData:s,allData:u,originalData:c,totals:p,originalPreviousData:g,previousData:h,timeAggregatedData:v,timeframe:D,isMetricsData:b}=this.processData(a);return e({loading:l,reloading:i,errored:o,errorMessage:n,seriesAdditionalInfo:{[null!==(d=null===(m=this.props.currentSeriesNames)||void 0===m?void 0:m[0])&&void 0!==d?d:"current"]:{isMetricsData:b}},timeseriesData:t,comparisonTimeseriesData:s,allTimeseriesData:u,originalTimeseriesData:c,timeseriesTotals:p,originalPreviousTimeseriesData:g,previousTimeseriesData:h?[h]:h,timeAggregatedData:v,timeframe:D,...r})}return e({loading:l,reloading:i,errored:o,errorMessage:n,...r})}}f.displayName="EventsRequest",(0,s.Z)(f,"defaultProps",{period:void 0,start:null,end:null,interval:"1d",comparisonDelta:void 0,limit:15,query:"",includePrevious:!0,includeTransformedData:!0});const x=f}}]);
//# sourceMappingURL=../sourcemaps/app_components_banner_tsx-app_components_charts_eventsGeoRequest_tsx-app_components_charts_ev-0db56c.57e1422433deaee0de263a12e403d5f2.js.map