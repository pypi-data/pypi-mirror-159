"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_versionHoverCard_tsx"],{"./app/actionCreators/release.tsx":(e,s,t)=>{t.d(s,{VE:()=>c,aQ:()=>h,dF:()=>p,o7:()=>d});var o=t("../node_modules/@sentry/hub/esm/exports.js"),r=t("./app/actionCreators/indicator.tsx"),i=t("./app/actions/releaseActions.tsx"),a=t("./app/locale.tsx"),n=t("./app/stores/releaseStore.tsx"),l=t("./app/types/index.tsx");function d(e,s){const{orgSlug:t,projectSlug:r,releaseVersion:a}=s,l=`/projects/${t}/${r}/releases/${encodeURIComponent(a)}/`;return n.Z.state.releaseLoading[(0,n.p)(r,a)]=!0,i.Z.loadRelease(t,r,a),e.requestPromise(l,{method:"GET"}).then((e=>{i.Z.loadReleaseSuccess(r,a,e)})).catch((e=>{404!==e.status?(i.Z.loadReleaseError(r,a,e),o.$e((s=>{s.setLevel("warning"),s.setFingerprint(["getRelease-action-creator"]),o.Tb(e)}))):i.Z.loadReleaseSuccess(r,a,null)}))}function p(e,s){const{orgSlug:t,projectSlug:r,releaseVersion:a}=s,l=`/organizations/${t}/releases/${encodeURIComponent(a)}/deploys/`;return n.Z.state.deploysLoading[(0,n.p)(r,a)]=!0,i.Z.loadDeploys(t,r,a),e.requestPromise(l,{method:"GET"}).then((e=>{i.Z.loadDeploysSuccess(r,a,e)})).catch((e=>{404!==e.status?(i.Z.loadDeploysError(r,a,e),o.$e((s=>{s.setLevel("warning"),s.setFingerprint(["getReleaseDeploys-action-creator"]),o.Tb(e)}))):i.Z.loadDeploysSuccess(r,a,null)}))}function c(e,s){const{orgSlug:t,projectSlug:o,releaseVersion:n}=s;return i.Z.loadRelease(t,o,n),(0,r.E3)((0,a.t)("Archiving Release…")),e.requestPromise(`/organizations/${t}/releases/`,{method:"POST",data:{status:l.dE.Archived,projects:[],version:n}}).then((e=>{i.Z.loadReleaseSuccess(o,n,e),(0,r.S9)((0,a.t)("Release was successfully archived."))})).catch((e=>{var s,t;throw i.Z.loadReleaseError(o,n,e),(0,r.Iw)(null!==(s=null===(t=e.responseJSON)||void 0===t?void 0:t.detail)&&void 0!==s?s:(0,a.t)("Release could not be be archived.")),e}))}function h(e,s){const{orgSlug:t,projectSlug:o,releaseVersion:n}=s;return i.Z.loadRelease(t,o,n),(0,r.E3)((0,a.t)("Restoring Release…")),e.requestPromise(`/organizations/${t}/releases/`,{method:"POST",data:{status:l.dE.Active,projects:[],version:n}}).then((e=>{i.Z.loadReleaseSuccess(o,n,e),(0,r.S9)((0,a.t)("Release was successfully restored."))})).catch((e=>{var s,t;throw i.Z.loadReleaseError(o,n,e),(0,r.Iw)(null!==(s=null===(t=e.responseJSON)||void 0===t?void 0:t.detail)&&void 0!==s?s:(0,a.t)("Release could not be be restored.")),e}))}},"./app/actions/releaseActions.tsx":(e,s,t)=>{t.d(s,{Z:()=>o});const o=(0,t("../node_modules/reflux/src/index.js").createActions)(["loadRelease","loadReleaseError","loadReleaseSuccess","loadDeploys","loadDeploysError","loadDeploysSuccess"])},"./app/actions/repositoryActions.tsx":(e,s,t)=>{t.d(s,{Z:()=>o});const o=(0,t("../node_modules/reflux/src/index.js").createActions)(["resetRepositories","loadRepositories","loadRepositoriesError","loadRepositoriesSuccess"])},"./app/components/versionHoverCard.tsx":(e,s,t)=>{t.d(s,{Z:()=>_});var o=t("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=t("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(t("../node_modules/core-js/modules/web.dom-collections.iterator.js"),t("../node_modules/react/index.js")),a=t("./app/components/avatar/avatarList.tsx"),n=t("./app/components/button.tsx"),l=t("./app/components/clipboard.tsx"),d=t("./app/components/hovercard.tsx"),p=t("./app/components/avatar/userAvatar.tsx"),c=t("./app/components/timeSince.tsx"),h=t("./app/locale.tsx"),u=t("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const g={id:"",name:"",username:"??",email:"",avatarUrl:"",avatar:{avatarUuid:"",avatarType:"letter_avatar"},ip_address:""};function m(e){let{commit:s,headerClass:t}=e;const o=null==s?void 0:s.author;return(0,u.BX)("div",{children:[(0,u.tZ)("h6",{className:t,children:"Last commit"}),(0,u.BX)("div",{className:"commit",children:[(0,u.tZ)("div",{className:"commit-avatar",children:(0,u.tZ)(p.Z,{user:o||g})}),(0,u.tZ)("div",{className:"commit-message truncate",children:function(e){if(!e)return(0,h.t)("No message provided");const s=e.split(/\n/)[0];if(s.length>100){let e=s.substr(0,90);const t=e.split(/ /);return t.length>1&&(t.pop(),e=t.join(" ")),`${e}…`}return s}(s.message)}),(0,u.BX)("div",{className:"commit-meta",children:[(0,u.tZ)("strong",{children:(null==o?void 0:o.name)||(0,h.t)("Unknown Author")})," ",(0,u.tZ)(c.Z,{date:s.dateCreated})]})]})]})}m.displayName="LastCommit";const v=m;var y=t("./app/components/loadingError.tsx"),Z=t("./app/components/loadingIndicator.tsx");const x=(0,r.Z)("span",{target:"eut5h770"})("font-weight:700;color:",(e=>e.theme.white),";text-align:center;white-space:nowrap;border-radius:0.25em;",(e=>e.theme.overflowEllipsis),";display:inline-block;vertical-align:text-bottom;line-height:1;background:",(e=>e.theme.gray200),";padding:3px;max-width:86px;font-size:",(e=>e.theme.fontSizeSmall),";");var S=t("./app/components/version.tsx"),b=t("./app/icons/index.tsx"),R=t("./app/styles/space.tsx"),j=t("./app/utils.tsx"),E=t("./app/utils/withApi.tsx"),f=t("./app/actionCreators/release.tsx"),w=t("./app/stores/releaseStore.tsx"),L=t("./app/utils/getDisplayName.tsx");var N=t("./app/utils/withRepositories.tsx");class C extends i.Component{constructor(){super(...arguments),(0,o.Z)(this,"state",{visible:!1})}toggleHovercard(){this.setState({visible:!0})}getRepoLink(){const{organization:e}=this.props,s=e.slug;return{header:null,body:(0,u.BX)(D,{children:[(0,u.tZ)("h5",{children:(0,h.t)("Releases are better with commit data!")}),(0,u.tZ)("p",{children:(0,h.t)("Connect a repository to see commit info, files changed, and authors involved in future releases.")}),(0,u.tZ)(n.ZP,{href:`/organizations/${s}/repos/`,priority:"primary",children:(0,h.t)("Connect a repository")})]})}}getBody(){const{releaseVersion:e,release:s,deploys:t}=this.props;if(void 0===s||!(0,j.ri)(t))return{header:null,body:null};const{lastCommit:o}=s,r=t.reduce((function(e,s){const{dateFinished:t,environment:o}=s;return e.hasOwnProperty(o)||(e[o]=t),e}),{});let i=Object.keys(r);return Object.keys(r).length>3&&(i=Object.keys(r).slice(0,3)),{header:(0,u.BX)(k,{children:[(0,h.t)("Release"),(0,u.BX)(A,{children:[(0,u.tZ)(B,{version:e,truncate:!0,anchor:!1}),(0,u.tZ)(l.Z,{value:e,children:(0,u.tZ)(M,{children:(0,u.tZ)(b.vU,{size:"xs"})})})]})]}),body:(0,u.BX)("div",{children:[(0,u.BX)("div",{className:"row",children:[(0,u.BX)("div",{className:"col-xs-4",children:[(0,u.tZ)("h6",{children:(0,h.t)("New Issues")}),(0,u.tZ)("div",{className:"count-since",children:s.newGroups})]}),(0,u.BX)("div",{className:"col-xs-8",children:[(0,u.BX)("h6",{style:{textAlign:"right"},children:[s.commitCount," ",1!==s.commitCount?(0,h.t)("commits "):(0,h.t)("commit ")," ",(0,h.t)("by ")," ",s.authors.length," ",1!==s.authors.length?(0,h.t)("authors"):(0,h.t)("author")," "]}),(0,u.tZ)(a.Z,{users:s.authors,avatarSize:25,tooltipOptions:{container:"body"},typeMembers:"authors"})]})]}),o&&(0,u.tZ)(v,{commit:o,headerClass:"commit-heading"}),t.length>0&&(0,u.BX)("div",{children:[(0,u.tZ)("div",{className:"divider",children:(0,u.tZ)("h6",{className:"deploy-heading",children:(0,h.t)("Deploys")})}),i.map(((e,s)=>{const t=r[e];return(0,u.tZ)("div",{className:"deploy",children:(0,u.BX)("div",{className:"deploy-meta",style:{position:"relative"},children:[(0,u.tZ)(z,{children:e}),t&&(0,u.tZ)($,{date:t})]})},s)}))]})]})}}render(){var e;const{deploysLoading:s,deploysError:t,release:o,releaseLoading:r,releaseError:i,repositories:a,repositoriesLoading:n,repositoriesError:l}=this.props;let p=null,c=null;const h=!!(s||r||n),g=null!==(e=null!=t?t:i)&&void 0!==e?e:l,m=a&&a.length>0;if(h)c=(0,u.tZ)(Z.Z,{mini:!0});else if(g)c=(0,u.tZ)(y.Z,{});else{const e=m&&o?this.getBody():this.getRepoLink();p=e.header,c=e.body}return(0,u.tZ)(d.uI,{...this.props,header:p,body:c,children:this.props.children})}}C.displayName="VersionHoverCard";const _=(0,E.Z)(function(e){class s extends i.Component{constructor(e,s){super(e,s),(0,o.Z)(this,"unsubscribe",w.Z.listen((()=>this.onStoreUpdate()),void 0));const{projectSlug:t,releaseVersion:r}=this.props,i=w.Z.get(t,r);this.state={...i}}componentDidMount(){this.fetchRelease(),this.fetchDeploys()}componentWillUnmount(){this.unsubscribe()}fetchRelease(){const{api:e,organization:s,projectSlug:t,releaseVersion:o}=this.props,r=w.Z.get(t,o),i=s.slug;(!r.release&&!r.releaseLoading||r.releaseError)&&(0,f.o7)(e,{orgSlug:i,projectSlug:t,releaseVersion:o})}fetchDeploys(){const{api:e,organization:s,projectSlug:t,releaseVersion:o}=this.props,r=w.Z.get(t,o),i=s.slug;(!r.deploys&&!r.deploysLoading||r.deploysError)&&(0,f.dF)(e,{orgSlug:i,projectSlug:t,releaseVersion:o})}onStoreUpdate(){const{projectSlug:e,releaseVersion:s}=this.props,t=w.Z.get(e,s);this.setState({...t})}render(){return(0,u.tZ)(e,{...this.props,...this.state})}}return s.displayName="WithRelease",(0,o.Z)(s,"displayName",`withRelease(${(0,L.Z)(e)})`),s}((0,N.Z)(C))),D=(0,r.Z)("div",{target:"ejgji4u6"})("padding:",(0,R.Z)(2),";text-align:center;"),z=(0,r.Z)(x,{target:"ejgji4u5"})({name:"1uxsuq0",styles:"width:86px"}),$=(0,r.Z)(c.Z,{target:"ejgji4u4"})("color:",(e=>e.theme.gray300),";position:absolute;left:98px;width:50%;padding:3px 0;"),k=(0,r.Z)("div",{target:"ejgji4u3"})({name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"}),A=(0,r.Z)("div",{target:"ejgji4u2"})({name:"8nnmo9",styles:"display:flex;flex:1;align-items:center;justify-content:flex-end"}),B=(0,r.Z)(S.Z,{target:"ejgji4u1"})("margin-right:",(0,R.Z)(.5),";max-width:190px;"),M=(0,r.Z)("span",{target:"ejgji4u0"})({name:"1p3qk0r",styles:"&:hover{cursor:pointer;}"})},"./app/stores/releaseStore.tsx":(e,s,t)=>{t.d(s,{Z:()=>d,p:()=>n}),t("../node_modules/core-js/modules/web.dom-collections.iterator.js");var o=t("../node_modules/reflux/src/index.js"),r=t("./app/actions/organizationActions.tsx"),i=t("./app/actions/releaseActions.tsx"),a=t("./app/utils/makeSafeRefluxStore.ts");const n=(e,s)=>`${e}${s}`,l={state:{orgSlug:void 0,release:new Map,releaseLoading:new Map,releaseError:new Map,deploys:new Map,deploysLoading:new Map,deploysError:new Map},listenables:i.Z,unsubscribeListeners:[],init(){this.unsubscribeListeners.push(this.listenTo(r.Z.update,this.updateOrganization)),this.reset()},reset(){this.state={orgSlug:void 0,release:new Map,releaseLoading:new Map,releaseError:new Map,deploys:new Map,deploysLoading:new Map,deploysError:new Map},this.trigger(this.state)},updateOrganization(e){this.reset(),this.state.orgSlug=e.slug,this.trigger(this.state)},loadRelease(e,s,t){this.orgSlug&&this.orgSlug===e||(this.reset(),this.orgSlug=e);const o=n(s,t),{releaseLoading:r,releaseError:i,...a}=this.state;this.state={...a,releaseLoading:{...r,[o]:!0},releaseError:{...i,[o]:void 0}},this.trigger(this.state)},loadReleaseError(e,s,t){const o=n(e,s),{releaseLoading:r,releaseError:i,...a}=this.state;this.state={...a,releaseLoading:{...r,[o]:!1},releaseError:{...i,[o]:t}},this.trigger(this.state)},loadReleaseSuccess(e,s,t){const o=n(e,s),{release:r,releaseLoading:i,releaseError:a,...l}=this.state;this.state={...l,release:{...r,[o]:t},releaseLoading:{...i,[o]:!1},releaseError:{...a,[o]:void 0}},this.trigger(this.state)},loadDeploys(e,s,t){this.orgSlug&&this.orgSlug===e||(this.reset(),this.orgSlug=e);const o=n(s,t),{deploysLoading:r,deploysError:i,...a}=this.state;this.state={...a,deploysLoading:{...r,[o]:!0},deploysError:{...i,[o]:void 0}},this.trigger(this.state)},loadDeploysError(e,s,t){const o=n(e,s),{deploysLoading:r,deploysError:i,...a}=this.state;this.state={...a,deploysLoading:{...r,[o]:!1},deploysError:{...i,[o]:t}},this.trigger(this.state)},loadDeploysSuccess(e,s,t){const o=n(e,s),{deploys:r,deploysLoading:i,deploysError:a,...l}=this.state;this.state={...l,deploys:{...r,[o]:t},deploysLoading:{...i,[o]:!1},deploysError:{...a,[o]:void 0}},this.trigger(this.state)},get(e,s){const t=n(e,s);return{release:this.state.release[t],releaseLoading:this.state.releaseLoading[t],releaseError:this.state.releaseError[t],deploys:this.state.deploys[t],deploysLoading:this.state.deploysLoading[t],deploysError:this.state.deploysError[t]}}},d=(0,o.createStore)((0,a.Y)(l))},"./app/utils/withRepositories.tsx":(e,s,t)=>{t.d(s,{Z:()=>g});var o=t("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=t("../node_modules/react/index.js"),i=t("../node_modules/@sentry/hub/esm/exports.js"),a=t("./app/actions/repositoryActions.tsx"),n=t("../node_modules/reflux/src/index.js"),l=t("./app/utils/makeSafeRefluxStore.ts");const d={listenables:a.Z,state:{orgSlug:void 0,repositories:void 0,repositoriesLoading:void 0,repositoriesError:void 0},init(){this.resetRepositories()},resetRepositories(){this.state={orgSlug:void 0,repositories:void 0,repositoriesLoading:void 0,repositoriesError:void 0},this.trigger(this.state)},loadRepositories(e){this.state={orgSlug:e,repositories:e===this.state.orgSlug?this.state.repositories:void 0,repositoriesLoading:!0,repositoriesError:void 0},this.trigger(this.state)},loadRepositoriesError(e){this.state={...this.state,repositories:void 0,repositoriesLoading:!1,repositoriesError:e},this.trigger(this.state)},loadRepositoriesSuccess(e){this.state={...this.state,repositories:e,repositoriesLoading:!1,repositoriesError:void 0},this.trigger(this.state)},get(){return{...this.state}}},p=(0,n.createStore)((0,l.Y)(d));var c=t("./app/utils/getDisplayName.tsx"),h=t("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const u={repositories:void 0,repositoriesLoading:void 0,repositoriesError:void 0},g=function(e){class s extends r.Component{constructor(e,s){super(e,s),(0,o.Z)(this,"unsubscribe",p.listen((()=>this.onStoreUpdate()),void 0));const{organization:t}=this.props,r=t.slug,i=p.get();i.orgSlug!==r&&a.Z.resetRepositories(),this.state=i.orgSlug===r?{...u,...i}:{...u}}componentDidMount(){this.fetchRepositories()}componentWillUnmount(){this.unsubscribe()}fetchRepositories(){const{api:e,organization:s}=this.props,t=s.slug,o=p.get();(!o.repositories&&!o.repositoriesLoading||o.repositoriesError)&&function(e,s){const{orgSlug:t}=s,o=`/organizations/${t}/repos/`;p.state.repositoriesLoading=!0,a.Z.loadRepositories(t),e.requestPromise(o,{method:"GET"}).then((e=>{a.Z.loadRepositoriesSuccess(e)})).catch((e=>{a.Z.loadRepositoriesError(e),i.$e((s=>{s.setLevel("warning"),s.setFingerprint(["getRepositories-action-creator"]),i.Tb(e)}))}))}(e,{orgSlug:t})}onStoreUpdate(){const e=p.get();this.setState({...e})}render(){return(0,h.tZ)(e,{...this.props,...this.state})}}return s.displayName="WithRepositories",(0,o.Z)(s,"displayName",`withRepositories(${(0,c.Z)(e)})`),s}}}]);
//# sourceMappingURL=../sourcemaps/app_components_versionHoverCard_tsx.2872f2784b96b911db730c9b43147b7f.js.map