"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_organizationStats_index_tsx"],{"./app/components/charts/errorPanel.tsx":(t,e,a)=>{a.d(e,{Z:()=>r});const r=(0,a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js").Z)("div",{target:"e1six6h50"})("display:flex;flex-direction:column;justify-content:center;align-items:center;flex:1;flex-shrink:0;overflow:hidden;height:",(t=>t.height||"200px"),";position:relative;border-color:transparent;margin-bottom:0;color:",(t=>t.theme.gray300),";font-size:",(t=>t.theme.fontSizeExtraLarge),";")},"./app/components/charts/optionSelector.tsx":(t,e,a)=>{a.d(e,{Z:()=>u});var r=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(a("../node_modules/core-js/modules/es.array.includes.js"),a("../node_modules/react/index.js")),o=a("./app/components/featureBadge.tsx"),n=a("./app/components/forms/compactSelect.tsx"),i=a("./app/components/truncate.tsx"),l=a("./app/utils.tsx"),d=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function c(t){let{options:e,onChange:a,selected:r,title:o,featureType:c,multiple:u,...h}=t;const m=(0,s.useMemo)((()=>e.map((t=>({...t,label:(0,d.tZ)(i.Z,{value:String(t.label),maxLength:60,expandDirection:"left"})})))),[e]);return(0,d.tZ)(n.Z,{options:m,value:r,onChange:function(t){a(u?t.map((t=>t.value)):t.value)},isOptionDisabled:function(t){return t.disabled||u&&3===r.length&&!r.includes(t.value)},multiple:u,triggerProps:{size:"sm",borderless:!0,prefix:(0,d.BX)(s.Fragment,{children:[o,(0,l.ri)(c)?(0,d.tZ)(p,{type:c}):null]})},placement:"bottom right",...h})}c.displayName="OptionSelector";const p=(0,r.Z)(o.Z,{target:"e1a4edto0"})({name:"6og82r",styles:"margin-left:0px"}),u=c},"./app/components/featureFeedback/index.tsx":(t,e,a)=>{a.d(e,{z:()=>l}),a("../node_modules/core-js/modules/web.dom-collections.iterator.js");var r=a("./app/actionCreators/modal.tsx"),s=a("./app/components/button.tsx"),o=a("./app/icons/index.tsx"),n=a("./app/locale.tsx"),i=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(t){let{feedbackTypes:e,featureName:l,buttonProps:d={}}=t;return(0,i.tZ)(s.ZP,{icon:(0,i.tZ)(o.I8,{}),onClick:async function(){const t=await a.e("app_components_featureFeedback_feedbackModal_tsx").then(a.bind(a,"./app/components/featureFeedback/feedbackModal.tsx")),{FeedbackModal:s,modalCss:o}=t;(0,r.openModal)((t=>(0,i.tZ)(s,{...t,featureName:l,feedbackTypes:e})),{modalCss:o})},...d,children:(0,n.t)("Give Feedback")})}l.displayName="FeatureFeedback"},"./app/components/gridEditable/sortLink.tsx":(t,e,a)=>{a.d(e,{Z:()=>h});var r=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=a("../node_modules/lodash/omit.js"),o=a.n(s),n=a("./app/components/links/link.tsx"),i=a("./app/icons/index.tsx"),l=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(t){let{align:e,title:a,canSort:r,generateSortLink:s,onClick:o,direction:n}=t;const i=s();if(!i||!r)return(0,l.tZ)(p,{align:e,children:a});const d=n?(0,l.tZ)(u,{size:"xs",direction:"desc"===n?"down":"up"}):null;return(0,l.BX)(c,{align:e,to:i,onClick:o,children:[a," ",d]})}d.displayName="SortLink";const c=(0,r.Z)((t=>{const e=o()(t,["align"]);return(0,l.tZ)(n.Z,{...e})}),{target:"e1xb2te62"})("display:block;width:100%;white-space:nowrap;color:inherit;&:hover,&:active,&:focus,&:visited{color:inherit;}",(t=>t.align?`text-align: ${t.align};`:""),";"),p=(0,r.Z)("div",{target:"e1xb2te61"})("display:block;width:100%;white-space:nowrap;",(t=>t.align?`text-align: ${t.align};`:""),";"),u=(0,r.Z)(i.CC,{target:"e1xb2te60"})({name:"40f4ru",styles:"vertical-align:top"}),h=d},"./app/components/notAvailable.tsx":(t,e,a)=>{a.d(e,{Z:()=>l});var r=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=a("./app/components/tooltip.tsx"),o=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function n(t){let{tooltip:e,className:a}=t;return(0,o.tZ)(s.Z,{title:e,skipWrapper:!0,disabled:void 0===e,children:(0,o.tZ)(i,{className:a,children:"â€”"})})}n.displayName="NotAvailable";const i=(0,r.Z)("div",{target:"e1ickyb10"})("color:",(t=>t.theme.gray200),";"),l=n},"./app/components/pageTimeRangeSelector.tsx":(t,e,a)=>{a.d(e,{Z:()=>u});var r=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=a("./app/components/organizations/timeRangeSelector/index.tsx"),o=a("./app/components/panels/index.tsx"),n=a("./app/locale.tsx"),i=a("./app/styles/space.tsx"),l=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(t){let{className:e,...a}=t;return(0,l.tZ)(c,{className:e,children:(0,l.tZ)(s.Z,{label:(0,l.tZ)(p,{children:(0,n.t)("Date Range:")}),detached:!0,...a},`period:${a.relative}-start:${a.start}-end:${a.end}-utc:${a.utc}-defaultPeriod:${a.defaultPeriod}`)})}d.displayName="PageTimeRangeSelector";const c=(0,r.Z)(o.s_,{target:"e1hsuxgy1"})("padding:0;margin:0;display:flex;justify-content:center;align-items:center;height:42px;background:",(t=>t.theme.background),";border:1px solid ",(t=>t.theme.border),";border-radius:",(t=>t.theme.borderRadius),";font-size:",(t=>t.theme.fontSizeMedium),";color:",(t=>t.theme.textColor),";>div{width:100%;align-self:stretch;}>div>div:first-child>div{padding:0 ",(0,i.Z)(2),";}>div>div:last-child:not(:first-child){min-width:calc(100% + 2px);transform:translateX(-1px);right:auto;}"),p=(0,r.Z)("span",{target:"e1hsuxgy0"})("text-align:left;font-weight:600;color:",(t=>t.theme.textColor),";>span:last-child{font-weight:400;}"),u=d},"./app/views/organizationStats/header.tsx":(t,e,a)=>{a.d(e,{Z:()=>p});var r=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=a("./app/components/featureFeedback/index.tsx"),o=a("./app/components/layouts/thirds.tsx"),n=a("./app/components/links/link.tsx"),i=a("./app/locale.tsx"),l=a("./app/styles/space.tsx"),d=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function c(t){let{organization:e,activeTab:a}=t;return(0,d.BX)(o.h4,{children:[(0,d.tZ)(o.oB,{children:(0,d.tZ)(u,{children:(0,i.t)("Stats")})}),(0,d.tZ)(o.kP,{children:"stats"!==a&&(0,d.tZ)(s.z,{featureName:"team-stats"})}),(0,d.BX)(o.mL,{underlined:!0,children:[(0,d.tZ)("li",{className:"stats"===a?"active":"",children:(0,d.tZ)(n.Z,{to:`/organizations/${e.slug}/stats/`,children:(0,i.t)("Usage")})}),(0,d.tZ)("li",{className:"issues"===a?"active":"",children:(0,d.tZ)(n.Z,{to:`/organizations/${e.slug}/stats/issues/`,children:(0,i.t)("Issues")})}),(0,d.tZ)("li",{className:"health"===a?"active":"",children:(0,d.tZ)(n.Z,{to:`/organizations/${e.slug}/stats/health/`,children:(0,i.t)("Health")})})]})]})}c.displayName="StatsHeader";const p=c,u=(0,r.Z)(o.Dx,{target:"e8yr0f60"})("margin-top:",(0,l.Z)(.5),";")},"./app/views/organizationStats/index.tsx":(t,e,a)=>{a.r(e),a.d(e,{OrganizationStats:()=>vt,default:()=>Zt});var r=a("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/core-js/modules/es.array.includes.js"),a("../node_modules/react/index.js")),n=a("../node_modules/lodash/omit.js"),i=a.n(n),l=a("../node_modules/lodash/pick.js"),d=a.n(l),c=a("../node_modules/moment/moment.js"),p=a.n(c),u=a("./app/components/errorBoundary.tsx"),h=a("./app/components/forms/compactSelect.tsx"),m=a("./app/components/hookOrDefault.tsx"),g=a("./app/components/layouts/thirds.tsx"),y=a("./app/components/organizations/pageFilters/parse.tsx"),b=a("./app/components/pageHeading.tsx"),C=a("./app/components/pageTimeRangeSelector.tsx"),x=a("./app/components/sentryDocumentTitle.tsx"),f=a("./app/constants/index.tsx"),v=a("./app/locale.tsx"),Z=a("./app/styles/organization.tsx"),D=a("./app/styles/space.tsx"),S=a("./app/types/index.tsx"),E=a("./app/utils/withOrganization.tsx"),k=a("./app/views/organizationStats/header.tsx"),T=a("./app/views/organizationStats/usageChart/index.tsx"),j=(a("../node_modules/core-js/modules/es.error.cause.js"),a("../node_modules/@sentry/hub/esm/exports.js")),P=a("./app/components/asyncComponent.tsx"),w=a("./app/components/charts/optionSelector.tsx"),_=a("./app/components/charts/styles.tsx"),z=a("./app/components/charts/utils.tsx"),A=a("./app/components/notAvailable.tsx"),R=a("./app/components/scoreCard.tsx"),L=a("./app/utils/dates.tsx"),O=a("./app/views/organizationStats/usageChart/utils.tsx"),N=a("./app/views/organizationStats/types.tsx"),I=a("./app/views/organizationStats/utils.tsx"),U=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class q extends P.Z{getEndpoints(){return[["orgStats",this.endpointPath,{query:this.endpointQuery}]]}get endpointPath(){const{organization:t}=this.props;return`/organizations/${t.slug}/stats_v2/`}get endpointQuery(){return{statsPeriod:"5m",interval:"1m",groupBy:["category","outcome"],field:["sum(quantity)"]}}get minuteData(){const{dataCategory:t}=this.props,{loading:e,error:a,orgStats:r}=this.state;if(e||a||!r||0===r.intervals.length)return;const{intervals:s,groups:o}=r,n=Math.max(s.length-2,0),i=o.reduce(((e,a)=>{const{outcome:r,category:s}=a.by;return t.includes(`${s}`)&&r===N.k.ACCEPTED?e+=a.series["sum(quantity)"][n]:e}),0);return(0,I.C_)(i,t,(0,I.H6)(t))}renderComponent(){return this.minuteData?(0,U.BX)($,{children:[this.minuteData," ",(0,v.t)("in last min")]}):null}}const F=q,$=(0,s.Z)("div",{target:"e2asf1f0"})("display:inline-block;color:",(t=>t.theme.success),";font-size:",(t=>t.theme.fontSizeMedium),";");class B extends P.Z{constructor(){super(...arguments),(0,r.Z)(this,"renderChartFooter",(()=>{const{handleChangeState:t}=this.props,{loading:e,error:a}=this.state,{chartDateInterval:r,chartTransform:s,chartDateStartDisplay:o,chartDateEndDisplay:n,chartDateTimezoneDisplay:i}=this.chartData;return(0,U.BX)(H,{children:[(0,U.tZ)(_.m2,{children:(0,U.BX)(G,{children:[(0,U.tZ)(_.OT,{children:(0,v.t)("Date Range:")}),(0,U.tZ)("span",{children:e||a?(0,U.tZ)(A.Z,{}):(0,v._N)("[start] â€” [end] ([timezone] UTC, [interval] interval)",{start:o,end:n,timezone:i,interval:r})})]})}),(0,U.tZ)(_.m2,{children:(0,U.tZ)(w.Z,{title:(0,v.t)("Type"),selected:s,options:T.ux,onChange:e=>t({transform:e})})})]})}))}componentDidUpdate(t){const{dataDatetime:e}=t,{dataDatetime:a}=this.props;e.start===a.start&&e.end===a.end&&e.period===a.period&&e.utc===a.utc||this.reloadData()}getEndpoints(){return[["orgStats",this.endpointPath,{query:this.endpointQuery}]]}get endpointPath(){const{organization:t}=this.props;return`/organizations/${t.slug}/stats_v2/`}get endpointQuery(){const{dataDatetime:t}=this.props;return{...t.start&&t.end?{start:t.start,end:t.end,utc:t.utc}:{statsPeriod:t.period||f.GY},interval:(0,z.EX)(t),groupBy:["category","outcome"],field:["sum(quantity)"]}}get chartData(){const{orgStats:t}=this.state;return{...this.mapSeriesToChart(t),...this.chartDateRange,...this.chartTransform}}get chartTransform(){const{chartTransform:t}=this.props;switch(t){case T.$$.CUMULATIVE:case T.$$.PERIODIC:return{chartTransform:t};default:return{chartTransform:T.$$.PERIODIC}}}get chartDateRange(){const{orgStats:t}=this.state,{dataDatetime:e}=this.props,a=(0,z.EX)(e);if(!t||!t.intervals)return{chartDateInterval:a,chartDateStart:"",chartDateEnd:"",chartDateUtc:!0,chartDateStartDisplay:"",chartDateEndDisplay:"",chartDateTimezoneDisplay:""};const{intervals:r}=t,s=(0,L.YJ)(a),o=p()(r[0]).utc(),n=r.length<2?p()(o):p()(r[r.length-1]).utc(),i=(0,I.pl)(e),l=s>=24?O.iS:O.CG,d=p()(o),c=p()(n),u=i?p()(o).utc():p()(o).local(),h=i?p()(n).utc():p()(n).local();return s<24&&h.add(s,"h"),{chartDateInterval:a,chartDateStart:d.format(),chartDateEnd:c.format(),chartDateUtc:i,chartDateStartDisplay:u.format(l),chartDateEndDisplay:h.format(l),chartDateTimezoneDisplay:u.format("Z")}}mapSeriesToChart(t){const e={total:void 0,accepted:void 0,dropped:void 0,filtered:void 0},a={accepted:[],dropped:[],projected:[],filtered:[]};if(!t)return{cardStats:e,chartStats:a};try{const{dataCategory:e}=this.props,{chartDateInterval:r,chartDateUtc:s}=this.chartDateRange,o=t.intervals.map((t=>{const e=p()(t);return{date:(0,O.Fb)(e,r,s),total:0,accepted:0,filtered:0,dropped:{total:0}}})),n={total:0,[N.k.ACCEPTED]:0,[N.k.FILTERED]:0,[N.k.DROPPED]:0,[N.k.INVALID]:0,[N.k.RATE_LIMITED]:0,[N.k.CLIENT_DISCARD]:0};return t.groups.forEach((t=>{const{outcome:a,category:r}=t.by;e.includes(`${r}`)&&(a!==N.k.CLIENT_DISCARD&&(n.total+=t.totals["sum(quantity)"]),n[a]+=t.totals["sum(quantity)"],t.series["sum(quantity)"].forEach(((t,e)=>{switch(a){case N.k.ACCEPTED:case N.k.FILTERED:return void(o[e][a]+=t);case N.k.DROPPED:case N.k.RATE_LIMITED:case N.k.INVALID:return void(o[e].dropped.total+=t);default:return}})))})),n[N.k.DROPPED]+=n[N.k.INVALID],n[N.k.DROPPED]+=n[N.k.RATE_LIMITED],o.forEach((t=>{var e;t.total=t.accepted+t.filtered+t.dropped.total,a.accepted.push({value:[t.date,t.accepted]}),a.dropped.push({value:[t.date,t.dropped.total]}),null===(e=a.filtered)||void 0===e||e.push({value:[t.date,t.filtered]})})),{cardStats:{total:(0,I.C_)(n.total,e,(0,I.H6)(e)),accepted:(0,I.C_)(n[N.k.ACCEPTED],e,(0,I.H6)(e)),filtered:(0,I.C_)(n[N.k.FILTERED],e,(0,I.H6)(e)),dropped:(0,I.C_)(n[N.k.DROPPED],e,(0,I.H6)(e))},chartStats:a}}catch(r){return j.$e((e=>{e.setContext("query",this.endpointQuery),e.setContext("body",t),j.Tb(r)})),{cardStats:e,chartStats:a,dataError:new Error("Failed to parse stats data")}}}renderCards(){const{dataCategory:t,dataCategoryName:e,organization:a}=this.props,{loading:r}=this.state,{total:s,accepted:o,dropped:n,filtered:i}=this.chartData.cardStats;return[{title:(0,v._N)("Total [dataCategory]",{dataCategory:e}),value:s},{title:(0,v.t)("Accepted"),help:(0,v._N)("Accepted [dataCategory] were successfully processed by Sentry",{dataCategory:t}),value:o,secondaryValue:(0,U.tZ)(F,{organization:a,dataCategory:t})},{title:(0,v.t)("Filtered"),help:(0,v._N)("Filtered [dataCategory] were blocked due to your inbound data filter rules",{dataCategory:t}),value:i},{title:(0,v.t)("Dropped"),help:(0,v._N)("Dropped [dataCategory] were discarded due to invalid data, rate-limits, quota limits, or spike protection",{dataCategory:t}),value:n}].map(((t,e)=>(0,U.tZ)(X,{title:t.title,score:r?void 0:t.value,help:t.help,trend:t.secondaryValue},e)))}renderChart(){const{dataCategory:t}=this.props,{error:e,errors:a,loading:r}=this.state,{chartStats:s,dataError:o,chartDateInterval:n,chartDateStart:i,chartDateEnd:l,chartDateUtc:d,chartTransform:c}=this.chartData,p=e||!!o,u=o?{...a,data:o}:a;return(0,U.tZ)(T.ZP,{isLoading:r,isError:p,errors:u,title:" ",footer:this.renderChartFooter(),dataCategory:t,dataTransform:c,usageDateStart:i,usageDateEnd:l,usageDateShowUtc:d,usageDateInterval:n,usageStats:s})}renderComponent(){return(0,U.BX)(o.Fragment,{children:[this.renderCards(),(0,U.tZ)(Q,{children:this.renderChart()})]})}}const M=B,X=(0,s.Z)(R.ZP,{target:"e2z08b03"})({name:"14rqsjo",styles:"grid-column:auto/span 1;margin:0"}),Q=(0,s.Z)("div",{target:"e2z08b02"})({name:"18iuzk9",styles:"grid-column:1/-1"}),H=(0,s.Z)("div",{target:"e2z08b01"})("display:flex;flex-direction:row;justify-content:space-between;padding:",(0,D.Z)(1)," ",(0,D.Z)(3),";border-top:1px solid ",(t=>t.theme.border),";"),G=(0,s.Z)("div",{target:"e2z08b00"})("display:flex;flex-direction:row;align-items:center;>",_.OT,"{margin-right:",(0,D.Z)(1.5),";}>span:last-child{font-weight:400;font-size:",(t=>t.theme.fontSizeMedium),";}");var J=a("./app/components/gridEditable/sortLink.tsx"),V=a("./app/components/pagination.tsx"),W=a("./app/components/searchBar.tsx"),Y=a("./app/utils/withProjects.tsx"),K=a("./app/components/charts/errorPanel.tsx"),tt=a("./app/components/idBadge/index.tsx"),et=a("./app/components/links/externalLink.tsx"),at=a("./app/components/links/link.tsx"),rt=a("./app/components/organizations/headerItem.tsx"),st=a("./app/components/panels/index.tsx"),ot=a("./app/components/panels/panelTable.tsx"),nt=a("./app/icons/index.tsx"),it=a("./app/utils/theme.tsx"),lt=a("./app/views/settings/components/emptyMessage.tsx");class dt extends o.Component{constructor(){super(...arguments),(0,r.Z)(this,"getErrorMessage",(t=>"No projects available"===t.projectStats.responseJSON.detail?(0,U.tZ)(lt.Z,{icon:(0,U.tZ)(nt.FC,{color:"gray300",size:"48"}),title:(0,v.t)("You don't have access to any projects, or your organization has no projects."),description:(0,v._N)("Learn more about [link:Project Access]",{link:(0,U.tZ)(et.Z,{href:"https://docs.sentry.io/product/accounts/membership/#restricting-access"})})}):(0,U.tZ)(nt.FC,{color:"gray300",size:"48"})))}get formatUsageOptions(){const{dataCategory:t}=this.props;return{isAbbreviated:t!==S.cn.ATTACHMENTS,useUnitScaling:t===S.cn.ATTACHMENTS}}renderTableRow(t){const{dataCategory:e}=this.props,{project:a,total:r,accepted:s,filtered:o,dropped:n}=t;return[(0,U.BX)(ht,{children:[(0,U.tZ)(at.Z,{to:t.projectLink,children:(0,U.tZ)(mt,{avatarSize:16,disableLink:!0,hideOverflow:!0,project:a,displayName:a.slug})}),(0,U.tZ)(rt.c,{to:t.projectSettingsLink,children:(0,U.tZ)(nt.iC,{size:it.ZP.iconSizes.sm})})]},0),(0,U.tZ)(ut,{children:(0,I.C_)(r,e,this.formatUsageOptions)},1),(0,U.tZ)(ut,{children:(0,I.C_)(s,e,this.formatUsageOptions)},2),(0,U.tZ)(ut,{children:(0,I.C_)(o,e,this.formatUsageOptions)},3),(0,U.tZ)(ut,{children:(0,I.C_)(n,e,this.formatUsageOptions)},4)]}render(){const{isEmpty:t,isLoading:e,isError:a,errors:r,headers:s,usageStats:o}=this.props;return a?(0,U.tZ)(st.s_,{children:(0,U.tZ)(K.Z,{height:"256px",children:this.getErrorMessage(r)})}):(0,U.tZ)(pt,{isLoading:e,isEmpty:t,headers:s,children:o.map((t=>this.renderTableRow(t)))})}}dt.displayName="UsageTable";const ct=dt,pt=(0,s.Z)(ot.Z,{target:"e5qzo7m3"})("grid-template-columns:repeat(5, auto);@media (min-width: ",(t=>t.theme.breakpoints.small),"){grid-template-columns:1fr repeat(4, minmax(0, auto));}"),ut=(0,s.Z)("div",{target:"e5qzo7m2"})({name:"10jfpq4",styles:"flex-shrink:1;text-align:right;font-variant-numeric:tabular-nums"}),ht=(0,s.Z)(ut,{target:"e5qzo7m1"})({name:"1axuxrw",styles:"display:flex;align-items:center;text-align:left"}),mt=(0,s.Z)(tt.Z,{target:"e5qzo7m0"})({name:"ri00hy",styles:"overflow:hidden;white-space:nowrap;flex-shrink:1"});let gt;!function(t){t.PROJECT="project",t.TOTAL="total",t.ACCEPTED="accepted",t.FILTERED="filtered",t.DROPPED="dropped",t.INVALID="invalid",t.RATE_LIMITED="rate_limited"}(gt||(gt={}));class yt extends P.Z{constructor(){super(...arguments),(0,r.Z)(this,"handleChangeSort",(t=>{const{handleChangeState:e}=this.props,{key:a,direction:r}=this.tableSort;let s=1;return a===t?s=-1*r:t===gt.PROJECT&&(s=-1),e({sort:`${s>0?"-":""}${t}`},{willUpdateRouter:!1})})),(0,r.Z)(this,"handleSearch",(t=>{const{handleChangeState:e,tableQuery:a}=this.props;t!==a&&e(t?{query:t,cursor:void 0}:{query:void 0,cursor:void 0})}))}componentDidUpdate(t){const{dataDatetime:e,dataCategory:a}=t,{dataDatetime:r,dataCategory:s}=this.props;e.start===r.start&&e.end===r.end&&e.period===r.period&&e.utc===r.utc&&s===a||this.reloadData()}getEndpoints(){return[["projectStats",this.endpointPath,{query:this.endpointQuery}]]}get endpointPath(){const{organization:t}=this.props;return`/organizations/${t.slug}/stats_v2/`}get endpointQuery(){const{dataDatetime:t,dataCategory:e}=this.props;return{...t.start&&t.end?{start:t.start,end:t.end,utc:t.utc}:{statsPeriod:t.period||f.GY},interval:(0,z.EX)(t),groupBy:["outcome","project"],field:["sum(quantity)"],project:"-1",category:e.slice(0,-1)}}get tableData(){const{projectStats:t}=this.state;return{headers:this.tableHeader,...this.mapSeriesToTable(t)}}get tableSort(){const{tableSort:t}=this.props;if(!t)return{key:gt.TOTAL,direction:1};let e=t,a=-1;switch("-"===t.charAt(0)&&(e=e.slice(1),a=1),e){case gt.PROJECT:case gt.TOTAL:case gt.ACCEPTED:case gt.FILTERED:case gt.DROPPED:return{key:e,direction:a};default:return{key:gt.ACCEPTED,direction:-1}}}get tableCursor(){const{tableCursor:t}=this.props,e=Number(null==t?void 0:t.split(":")[1]);return isNaN(e)?0:e}get pageLink(){const t=this.filteredProjects.length,e=this.tableCursor,a=e-yt.MAX_ROWS_USAGE_TABLE,r=e+yt.MAX_ROWS_USAGE_TABLE;return`<link>; rel="previous"; results="${a>=0}"; cursor="0:${Math.max(0,a)}:1", <link>; rel="next"; results="${r<t}"; cursor="0:${r}:0"`}get filteredProjects(){const{projects:t,tableQuery:e}=this.props;return e?t.filter((t=>t.slug.includes(e)&&t.hasAccess)):t.filter((t=>t.hasAccess))}get tableHeader(){const{key:t,direction:e}=this.tableSort,a=a=>{if(a===t)return e>0?"desc":"asc"};return[{key:gt.PROJECT,title:(0,v.t)("Project"),align:"left",direction:a(gt.PROJECT),onClick:()=>this.handleChangeSort(gt.PROJECT)},{key:gt.TOTAL,title:(0,v.t)("Total"),align:"right",direction:a(gt.TOTAL),onClick:()=>this.handleChangeSort(gt.TOTAL)},{key:gt.ACCEPTED,title:(0,v.t)("Accepted"),align:"right",direction:a(gt.ACCEPTED),onClick:()=>this.handleChangeSort(gt.ACCEPTED)},{key:gt.FILTERED,title:(0,v.t)("Filtered"),align:"right",direction:a(gt.FILTERED),onClick:()=>this.handleChangeSort(gt.FILTERED)},{key:gt.DROPPED,title:(0,v.t)("Dropped"),align:"right",direction:a(gt.DROPPED),onClick:()=>this.handleChangeSort(gt.DROPPED)}].map((t=>{const e=t.key===gt.PROJECT?ht:ut;return(0,U.tZ)(e,{children:(0,U.tZ)(J.Z,{canSort:!0,title:t.title,align:t.align,direction:t.direction,generateSortLink:t.onClick})},t.key)}))}getProjectLink(t){const{dataCategory:e,getNextLocations:a,organization:r}=this.props,{performance:s,projectDetail:o,settings:n}=a(t);return e===S.cn.TRANSACTIONS&&r.features.includes("performance-view")?{projectLink:s,projectSettingsLink:n}:{projectLink:o,projectSettingsLink:n}}mapSeriesToTable(t){if(!t)return{tableStats:[]};const e={};try{const a={[gt.TOTAL]:0,[gt.ACCEPTED]:0,[gt.FILTERED]:0,[gt.DROPPED]:0},r=this.filteredProjects,s=new Set(r.map((t=>t.id)));t.groups.forEach((t=>{const{outcome:r,project:o}=t.by;s.has(o.toString())&&(e[o]||(e[o]={...a}),r!==N.k.CLIENT_DISCARD&&(e[o].total+=t.totals["sum(quantity)"]),r===N.k.ACCEPTED||r===N.k.FILTERED?e[o][r]+=t.totals["sum(quantity)"]:r!==N.k.RATE_LIMITED&&r!==N.k.INVALID&&r!==N.k.DROPPED||(e[o][gt.DROPPED]+=t.totals["sum(quantity)"]))}));const o=r.map((t=>{var r;const s=null!==(r=e[t.id])&&void 0!==r?r:{...a};return{project:{...t},...this.getProjectLink(t),...s}})),{key:n,direction:i}=this.tableSort;o.sort(((t,e)=>n===gt.PROJECT?e.project.slug.localeCompare(t.project.slug)*i:t[n]!==e[n]?(e[n]-t[n])*i:t.project.slug.localeCompare(e.project.slug)));const l=this.tableCursor;return{tableStats:o.slice(l,l+yt.MAX_ROWS_USAGE_TABLE)}}catch(e){return j.$e((a=>{a.setContext("query",this.endpointQuery),a.setContext("body",t),j.Tb(e)})),{tableStats:[],error:e}}}renderComponent(){const{error:t,errors:e,loading:a}=this.state,{dataCategory:r,loadingProjects:s,tableQuery:n}=this.props,{headers:i,tableStats:l}=this.tableData;return(0,U.BX)(o.Fragment,{children:[(0,U.tZ)(Ct,{children:(0,U.tZ)(W.Z,{defaultQuery:"",query:n,placeholder:(0,v.t)("Filter your projects"),onSearch:this.handleSearch})}),(0,U.BX)(Ct,{children:[(0,U.tZ)(ct,{isLoading:a||s,isError:t,errors:e,isEmpty:0===l.length,headers:i,dataCategory:r,usageStats:l}),(0,U.tZ)(V.Z,{pageLinks:this.pageLink})]})]})}}(0,r.Z)(yt,"MAX_ROWS_USAGE_TABLE",25);const bt=(0,Y.Z)(yt),Ct=(0,s.Z)("div",{target:"e1ii6wy90"})("margin-bottom:",(0,D.Z)(2),";"),xt=(0,m.Z)({hookName:"component:org-stats-banner"}),ft=["pageStatsPeriod","pageStart","pageEnd","pageUtc","dataCategory","transform","sort","query","cursor"];class vt extends o.Component{constructor(){var t;super(...arguments),t=this,(0,r.Z)(this,"getNextLocations",(t=>{const{location:e,organization:a}=this.props,r={...e,query:{...e.query,project:t.id}};return r.query=i()(r.query,ft),{performance:{...r,pathname:`/organizations/${a.slug}/performance/`},projectDetail:{...r,pathname:`/organizations/${a.slug}/projects/${t.slug}/`},issueList:{...r,pathname:`/organizations/${a.slug}/issues/`},settings:{pathname:`/settings/${a.slug}/projects/${t.slug}/`}}})),(0,r.Z)(this,"handleUpdateDatetime",(t=>{const{start:e,end:a,relative:r,utc:s}=t;if(e&&a){const t=s?p().utc:p();return this.setStateOnUrl({pageStatsPeriod:void 0,pageStart:t(e).format(),pageEnd:t(a).format(),pageUtc:null!=s?s:void 0})}return this.setStateOnUrl({pageStatsPeriod:r||void 0,pageStart:void 0,pageEnd:void 0,pageUtc:void 0})})),(0,r.Z)(this,"setStateOnUrl",(function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{willUpdateRouter:!0};const{location:r,router:s}=t.props,o=d()(e,ft),n={...r,query:{...null==r?void 0:r.query,...o}};return a.willUpdateRouter&&s.push(n),n})),(0,r.Z)(this,"renderPageControl",(()=>{const{organization:t}=this.props,{start:e,end:a,period:r,utc:s}=this.dataDatetime;return(0,U.BX)(o.Fragment,{children:[(0,U.tZ)(St,{triggerProps:{prefix:(0,v.t)("Category")},value:this.dataCategory,options:T.Ez,onChange:t=>this.setStateOnUrl({dataCategory:t.value})}),(0,U.tZ)(Et,{organization:t,relative:null!=r?r:"",start:null!=e?e:null,end:null!=a?a:null,utc:null!=s?s:null,onUpdate:this.handleUpdateDatetime,relativeOptions:i()(f.wh,["1h"])})]})}))}get dataCategory(){var t,e;const a=null===(t=this.props.location)||void 0===t||null===(e=t.query)||void 0===e?void 0:e.dataCategory;switch(a){case S.cn.ERRORS:case S.cn.TRANSACTIONS:case S.cn.ATTACHMENTS:return a;default:return S.cn.ERRORS}}get dataCategoryName(){var t;const e=this.dataCategory;return null!==(t=f.K[e])&&void 0!==t?t:(0,v.t)("Unknown Data Category")}get dataDatetime(){var t,e;const a=null!==(t=null===(e=this.props.location)||void 0===e?void 0:e.query)&&void 0!==t?t:{},{start:r,end:s,statsPeriod:o,utc:n}=(0,y.fK)(a,{allowEmptyPeriod:!0,allowAbsoluteDatetime:!0,allowAbsolutePageDatetime:!0});if(!o&&!r&&!s)return{period:f.GY};if(o)return{period:o};const i="true"===n;return r&&s?i?{start:p().utc(r).format(),end:p().utc(s).format(),utc:i}:{start:p()(r).utc().format(),end:p()(s).utc().format(),utc:i}:{period:f.GY}}get chartTransform(){var t,e;return null===(t=this.props.location)||void 0===t||null===(e=t.query)||void 0===e?void 0:e.transform}get tableSort(){var t,e;return null===(t=this.props.location)||void 0===t||null===(e=t.query)||void 0===e?void 0:e.sort}get tableQuery(){var t,e;return null===(t=this.props.location)||void 0===t||null===(e=t.query)||void 0===e?void 0:e.query}get tableCursor(){var t,e;return null===(t=this.props.location)||void 0===t||null===(e=t.query)||void 0===e?void 0:e.cursor}render(){const{organization:t}=this.props,e=t.features.includes("team-insights");return(0,U.tZ)(x.Z,{title:"Usage Stats",children:(0,U.BX)(o.Fragment,{children:[e&&(0,U.tZ)(k.Z,{organization:t,activeTab:"stats"}),(0,U.tZ)(kt,{children:(0,U.BX)(g.or,{fullWidth:!0,children:[!e&&(0,U.BX)(o.Fragment,{children:[(0,U.tZ)(Z.mr,{children:(0,U.tZ)(b.Z,{children:(0,v.t)("Organization Usage Stats")})}),(0,U.tZ)("p",{children:(0,v.t)("We collect usage metrics on three categories: errors, transactions, and attachments. The charts below reflect data that Sentry has received across your entire organization. You can also find them broken down by project in the table.")})]}),(0,U.tZ)(xt,{organization:t}),(0,U.BX)(Dt,{children:[this.renderPageControl(),(0,U.tZ)(u.Z,{mini:!0,children:(0,U.tZ)(M,{organization:t,dataCategory:this.dataCategory,dataCategoryName:this.dataCategoryName,dataDatetime:this.dataDatetime,chartTransform:this.chartTransform,handleChangeState:this.setStateOnUrl})})]}),(0,U.tZ)(u.Z,{mini:!0,children:(0,U.tZ)(bt,{organization:t,dataCategory:this.dataCategory,dataCategoryName:this.dataCategoryName,dataDatetime:this.dataDatetime,tableSort:this.tableSort,tableQuery:this.tableQuery,tableCursor:this.tableCursor,handleChangeState:this.setStateOnUrl,getNextLocations:this.getNextLocations})})]})})]})})}}vt.displayName="OrganizationStats";const Zt=(0,E.Z)(vt),Dt=(0,s.Z)("div",{target:"eonnbv93"})("display:grid;grid-template-columns:1fr;gap:",(0,D.Z)(2),";@media (min-width: ",(t=>t.theme.breakpoints.small),"){grid-template-columns:repeat(2, 1fr);}@media (min-width: ",(t=>t.theme.breakpoints.large),"){grid-template-columns:repeat(4, 1fr);}"),St=(0,s.Z)(h.Z,{target:"eonnbv92"})("grid-column:auto/span 1;button[aria-haspopup='listbox']{width:100%;height:100%;}@media (min-width: ",(t=>t.theme.breakpoints.small),"){grid-column:auto/span 2;}@media (min-width: ",(t=>t.theme.breakpoints.large),"){grid-column:auto/span 1;}"),Et=(0,s.Z)(C.Z,{target:"eonnbv91"})("grid-column:auto/span 1;@media (min-width: ",(t=>t.theme.breakpoints.small),"){grid-column:auto/span 2;}@media (min-width: ",(t=>t.theme.breakpoints.large),"){grid-column:auto/span 3;}"),kt=(0,s.Z)(g.uT,{target:"eonnbv90"})("@media (min-width: ",(t=>t.theme.breakpoints.medium),"){display:block;}")}}]);
//# sourceMappingURL=../sourcemaps/app_views_organizationStats_index_tsx.7f9feae8361e7099f6ad1002e771cd6b.js.map