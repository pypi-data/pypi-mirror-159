"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_organizationStats_types_tsx-app_views_organizationStats_usageChart_index_tsx"],{"./app/views/organizationStats/types.tsx":(t,e,a)=>{let s;a.d(e,{k:()=>s}),function(t){t.ACCEPTED="accepted",t.FILTERED="filtered",t.INVALID="invalid",t.DROPPED="dropped",t.RATE_LIMITED="rate_limited",t.CLIENT_DISCARD="client_discard"}(s||(s={}))},"./app/views/organizationStats/usageChart/index.tsx":(t,e,a)=>{a.d(e,{$$:()=>_,Ez:()=>R,Hp:()=>Z,ZP:()=>F,ux:()=>O,xt:()=>P});var s=a("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/core-js/modules/es.error.cause.js"),a("../node_modules/react/index.js")),i=a("../node_modules/@emotion/react/dist/emotion-element-cbed451f.browser.esm.js"),o=a("../node_modules/color/index.js"),l=a.n(o),c=a("./app/components/charts/baseChart.tsx"),d=a("./app/components/charts/components/legend.tsx"),p=a("./app/components/charts/components/xAxis.tsx"),u=a("./app/components/charts/series/barSeries.tsx"),h=a("./app/components/charts/styles.tsx"),g=a("./app/components/loadingIndicator.tsx"),x=a("./app/components/panels/panel.tsx"),m=a("./app/components/placeholder.tsx"),v=a("./app/constants/index.tsx"),f=a("./app/icons/index.tsx"),E=a("./app/locale.tsx"),A=a("./app/styles/space.tsx"),T=a("./app/types/index.tsx"),b=a("./app/utils/dates.tsx"),C=a("./app/utils/getDynamicText.tsx"),D=a("./app/utils/theme.tsx"),S=a("./app/views/organizationStats/utils.tsx"),L=a("./app/views/organizationStats/usageChart/utils.tsx"),I=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const y=l()(D.ZP.dataCategory.errors).lighten(.25).string(),Z=l()(D.ZP.dataCategory.transactions).lighten(.35).string(),M=l()(D.ZP.dataCategory.attachments).lighten(.65).string(),P=D.ZP.red300,w=D.ZP.pink100,R=[{label:v.K[T.cn.ERRORS],value:T.cn.ERRORS,disabled:!1,yAxisMinInterval:100},{label:v.K[T.cn.TRANSACTIONS],value:T.cn.TRANSACTIONS,disabled:!1,yAxisMinInterval:100},{label:v.K[T.cn.ATTACHMENTS],value:T.cn.ATTACHMENTS,disabled:!1,yAxisMinInterval:.5*S.GS}];let _;!function(t){t.CUMULATIVE="cumulative",t.PERIODIC="periodic"}(_||(_={}));const O=[{label:(0,E.t)("Cumulative"),value:_.CUMULATIVE,disabled:!1},{label:(0,E.t)("Periodic"),value:_.PERIODIC,disabled:!1}];let k;!function(t){t.ACCEPTED="Accepted",t.DROPPED="Dropped",t.PROJECTED="Projected",t.FILTERED="Filtered"}(k||(k={}));class j extends n.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{xAxisDates:[]})}static getDerivedStateFromProps(t,e){const{usageDateStart:a,usageDateEnd:s,usageDateShowUtc:r,usageDateInterval:n}=t;return{...e,xAxisDates:(0,L.E8)(a,s,r,n)}}get chartColors(){const{dataCategory:t,theme:e}=this.props,a=e.chartOther;return t===T.cn.ERRORS?[y,w,P,a]:t===T.cn.ATTACHMENTS?[M,w,P,a]:[Z,w,P,a]}get chartMetadata(){const{categoryOptions:t,usageDateStart:e,usageDateEnd:a}=this.props,{usageDateInterval:s,usageStats:r,dataCategory:n,dataTransform:i,handleDataTransformation:o}=this.props,{xAxisDates:l}=this.state,c=t.find((t=>t.value===n));if(!c)throw new Error("Selected item is not supported");const d={...o(r,i)};Object.keys(d).forEach((t=>{const e=t===k.PROJECTED;d[t]=d[t].map((t=>({...t,tooltip:{show:!1},itemStyle:{opacity:e?.6:1}})))}));const p=24*(0,b.Ri)(void 0,e,a),u=(0,b.YJ)(s);if(p<0||u<0)throw new Error("UsageChart: Unable to parse data time period");const{xAxisTickInterval:h,xAxisLabelInterval:g}=(0,L.op)(p,p/u),{label:x,yAxisMinInterval:m}=c;return{chartLabel:x,chartData:d,xAxisData:l,xAxisTickInterval:h,xAxisLabelInterval:g,yAxisMinInterval:m,yAxisFormatter:t=>(0,S.C_)(t,n,{isAbbreviated:!0,useUnitScaling:!0}),tooltipValueFormatter:(0,L.tL)(n)}}get chartSeries(){const{chartSeries:t}=this.props,{chartData:e}=this.chartMetadata;let a=[(0,u.Z)({name:k.ACCEPTED,data:e.accepted,barMinHeight:1,stack:"usage",legendHoverLink:!1}),(0,u.Z)({name:k.FILTERED,data:e.filtered,barMinHeight:1,stack:"usage",legendHoverLink:!1}),(0,u.Z)({name:k.DROPPED,data:e.dropped,stack:"usage",legendHoverLink:!1}),(0,u.Z)({name:k.PROJECTED,data:e.projected,barMinHeight:1,stack:"usage",legendHoverLink:!1})];return t&&(a=a.concat(t)),a}get chartLegend(){const{chartData:t}=this.chartMetadata,e=[{name:k.ACCEPTED}];return t.filtered&&t.filtered.length>0&&e.push({name:k.FILTERED}),t.dropped.length>0&&e.push({name:k.DROPPED}),t.projected.length>0&&e.push({name:k.PROJECTED}),e}get chartTooltip(){const{chartTooltip:t}=this.props;if(t)return t;const{tooltipValueFormatter:e}=this.chartMetadata;return{trigger:"axis",valueFormatter:e}}renderChart(){const{theme:t,title:e,isLoading:a,isError:s,errors:r}=this.props;if(a)return(0,I.tZ)(m.Z,{height:"200px",children:(0,I.tZ)(g.Z,{mini:!0})});if(s)return(0,I.BX)(m.Z,{height:"200px",children:[(0,I.tZ)(f.FC,{size:t.fontSizeExtraLarge}),(0,I.tZ)(U,{children:r&&Object.keys(r).map((t=>{var e;return(0,I.tZ)("span",{children:null===(e=r[t])||void 0===e?void 0:e.message},t)}))})]});const{xAxisData:i,xAxisTickInterval:o,xAxisLabelInterval:l,yAxisMinInterval:u,yAxisFormatter:x}=this.chartMetadata;return(0,I.BX)(n.Fragment,{children:[(0,I.tZ)(h.ws,{children:e||(0,E.t)("Current Usage Period")}),(0,C.Z)({value:(0,I.tZ)(c.Z,{colors:this.chartColors,grid:{bottom:"3px",left:"0px",right:"10px",top:"40px"},xAxis:(0,p.Z)({show:!0,type:"category",name:"Date",data:i,axisTick:{interval:o,alignWithLabel:!0},axisLabel:{interval:l,formatter:t=>t.slice(0,6)},theme:t}),yAxis:{min:0,minInterval:u,axisLabel:{formatter:x,color:t.chartLabel}},series:this.chartSeries,tooltip:this.chartTooltip,onLegendSelectChanged:()=>{},legend:(0,d.Z)({right:10,top:5,data:this.chartLegend,theme:t})}),fixed:(0,I.tZ)(m.Z,{height:"200px"})})]})}render(){const{footer:t}=this.props;return(0,I.BX)(x.Z,{id:"usage-chart",children:[(0,I.tZ)(h.BO,{children:this.renderChart()}),t]})}}j.displayName="UsageChart",(0,s.Z)(j,"defaultProps",{categoryOptions:R,usageDateShowUtc:!0,usageDateInterval:"1d",handleDataTransformation:(t,e)=>{const a={accepted:[],dropped:[],projected:[],filtered:[]},s=e===_.CUMULATIVE;return Object.keys(t).forEach((e=>{let r=0;a[e]=t[e].map((t=>{const[e,a]=t.value;return r=s?r+a:a,{...t,value:[e,r]}}))})),a}});const F=(0,i.d)(j),U=(0,r.Z)("div",{target:"erx9nbs0"})("display:flex;flex-direction:column;margin-top:",(0,A.Z)(1),";font-size:",(t=>t.theme.fontSizeSmall),";")},"./app/views/organizationStats/usageChart/utils.tsx":(t,e,a)=>{a.d(e,{CG:()=>c,E8:()=>p,Fb:()=>d,iS:()=>l,op:()=>h,tL:()=>u}),a("../node_modules/core-js/modules/es.error.cause.js");var s=a("../node_modules/moment/moment.js"),r=a.n(s),n=a("./app/components/organizations/pageFilters/parse.tsx"),i=a("./app/utils/dates.tsx"),o=a("./app/views/organizationStats/utils.tsx");const l="MMM D",c="MMM D LT";function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1d",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=(0,i.YJ)(e)/24;if(s>=1)return a?r().utc(t).format(l):t.format(l);const o=(0,n.su)(e),d=a?r()(t).utc():r()(t).local();return o?`${d.format(c)} - ${d.add(o.period,o.periodLength).format("LT (Z)")}`:d.format(c)}function p(t,e){var a;let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"1d";const o=[],l=r()(t).startOf("h"),c=r()(e).startOf("h");if(!l.isValid()||!c.isValid())return o;const{period:p,periodLength:u}=null!==(a=(0,n.su)(i))&&void 0!==a?a:{period:1,periodLength:"d"};for(;!l.isAfter(c);)o.push(d(l,i,s)),l.add(p,u);return o}function u(t){return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,o.C_)(e,t,{useUnitScaling:!0})}}function h(t,e){return t>168?function(t,e){const a=t/24;if(a<=7)throw new Error("This method should be used for periods > 7 days");let s=a,r=s;const n=[2,4,7,14],i=[1,2,7,7];for(let t=0;t<n.length&&r>10;t++)r=s/n[t],s=a/i[t];return{xAxisTickInterval:e/s-1,xAxisLabelInterval:e/r-1}}(t,e):function(t,e){const a=t/24;if(a>7)throw new Error("This method should be used for periods <= 7 days");const s=e/a;return{xAxisTickInterval:s-1,xAxisLabelInterval:s-1}}(t,e)}},"./app/views/organizationStats/utils.tsx":(t,e,a)=>{a.d(e,{C_:()=>d,GS:()=>c,H6:()=>p,pl:()=>h});var s=a("./app/components/charts/utils.tsx"),r=a("./app/types/index.tsx"),n=a("./app/utils.tsx"),i=a("./app/utils/dates.tsx");const o=10**6,l=10**9,c=10**9;function d(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isAbbreviated:!1,useUnitScaling:!1};if(e!==r.cn.ATTACHMENTS)return a.isAbbreviated?u(t):t.toLocaleString();if(a.useUnitScaling)return(0,n.E9)(t);const s=t/c;return a.isAbbreviated?`${u(s)} GB`:`${s.toLocaleString(void 0,{maximumFractionDigits:2})} GB`}function p(t){return{isAbbreviated:t!==r.cn.ATTACHMENTS,useUnitScaling:t===r.cn.ATTACHMENTS}}function u(t){return t>=l?(t/l).toLocaleString(void 0,{maximumFractionDigits:2})+"B":t>=o?(t/o).toLocaleString(void 0,{maximumFractionDigits:1})+"M":t>=1e3?(t/1e3).toFixed().toLocaleString()+"K":t.toFixed().toLocaleString()}function h(t){if(t.utc)return!0;const e=(0,s.EX)(t);return(0,i.YJ)(e)>=24}}}]);
//# sourceMappingURL=../sourcemaps/app_views_organizationStats_types_tsx-app_views_organizationStats_usageChart_index_tsx.283971928dad810c884e6da58f40fd2b.js.map