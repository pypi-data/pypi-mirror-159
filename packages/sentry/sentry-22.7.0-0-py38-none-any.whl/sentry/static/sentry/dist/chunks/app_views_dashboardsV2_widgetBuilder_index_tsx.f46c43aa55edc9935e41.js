"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_dashboardsV2_widgetBuilder_index_tsx"],{"./app/components/featureFeedback/index.tsx":(e,t,i)=>{i.d(t,{z:()=>d}),i("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=i("./app/actionCreators/modal.tsx"),r=i("./app/components/button.tsx"),a=i("./app/icons/index.tsx"),n=i("./app/locale.tsx"),o=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(e){let{feedbackTypes:t,featureName:d,buttonProps:l={}}=e;return(0,o.tZ)(r.ZP,{icon:(0,o.tZ)(a.I8,{}),onClick:async function(){const e=await i.e("app_components_featureFeedback_feedbackModal_tsx").then(i.bind(i,"./app/components/featureFeedback/feedbackModal.tsx")),{FeedbackModal:r,modalCss:a}=e;(0,s.openModal)((e=>(0,o.tZ)(r,{...e,featureName:d,feedbackTypes:t})),{modalCss:a})},...l,children:(0,n.t)("Give Feedback")})}d.displayName="FeatureFeedback"},"./app/views/dashboardsV2/widgetBuilder/index.tsx":(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ft});var s=i("./app/components/acl/feature.tsx"),r=i("./app/components/alert.tsx"),a=i("./app/locale.tsx"),n=i("./app/styles/organization.tsx"),o=i("./app/utils/useOrganization.tsx"),d=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),l=(i("../node_modules/core-js/modules/es.array.includes.js"),i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/react/index.js")),u=i("../node_modules/lodash/cloneDeep.js"),c=i.n(u),p=i("../node_modules/lodash/isEmpty.js"),g=i.n(p),m=i("../node_modules/lodash/omit.js"),h=i.n(m),y=i("../node_modules/lodash/set.js"),f=i.n(y),b=i("./app/actionCreators/dashboards.tsx"),v=i("./app/actionCreators/indicator.tsx"),w=i("./app/actionCreators/members.tsx"),Z=i("./app/actionCreators/tags.tsx"),x=i("./app/components/dashboards/widgetQueriesForm.tsx"),T=i("./app/components/datePageFilter.tsx"),S=i("./app/components/environmentPageFilter.tsx"),E=i("./app/components/layouts/thirds.tsx"),O=i("./app/components/list/index.tsx"),C=i("./app/components/list/listItem.tsx"),q=i("./app/components/loadingError.tsx"),F=i("./app/components/organizations/pageFilterBar.tsx"),k=i("./app/components/organizations/pageFilters/container.tsx"),_=i("./app/components/projectPageFilter.tsx"),A=i("./app/components/sentryDocumentTitle.tsx"),B=i("./app/styles/space.tsx"),N=i("./app/utils.tsx"),D=i("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),R=i("./app/components/organizations/pageFilters/parse.tsx"),L=i("./app/utils/handleXhrErrorResponse.tsx"),z=i("./app/utils/useApi.tsx");const I=(0,l.createContext)(void 0);var j=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function P(e){let{children:t,organization:i,selection:s}=e;const r=(0,z.Z)(),[n,o]=(0,l.useState)({customMeasurements:{}});return(0,l.useEffect)((()=>{let e=!1;return i.features.includes("dashboard-custom-measurement-widgets")&&function(e,t,i){const s=null!=i&&i.datetime?{...(0,R.fK)(i.datetime)}:{};return null!=i&&i.projects&&(s.project=i.projects.map(String)),e.requestPromise(`/organizations/${t.slug}/measurements-meta/`,{method:"GET",query:s})}(r,i,s).then((t=>{if(e)return;const i=Object.keys(t).reduce(((e,i)=>(e[i]={key:i,name:i,functions:t[i].functions},e)),{});o({customMeasurements:i})})).catch((t=>{var i;if(e)return;const s=null!==(i=null==t?void 0:t.responseJSON)&&void 0!==i?i:(0,a.t)("Unable to fetch custom measurements");(0,v.Iw)(s),(0,L.Z)(s)(t)})),()=>{e=!0}}),[s,r,i]),(0,j.tZ)(I.Provider,{value:n,children:"function"==typeof t?t(n):t})}P.displayName="CustomMeasurementsProvider";var M=i("./app/utils/discover/fields.tsx"),V=i("./app/utils/withPageFilters.tsx"),W=i("./app/utils/withTags.tsx"),U=i("./app/views/dashboardsV2/layoutUtils.tsx"),H=i("./app/views/dashboardsV2/types.tsx"),X=i("./app/views/dashboardsV2/utils.tsx"),$=i("./app/views/dashboardsV2/data.tsx"),G=i("./app/views/dashboardsV2/datasetConfig/base.tsx"),Q=i("./app/views/dashboardsV2/widgetCard/dashboardsMEPContext.tsx"),Y=i("./app/components/links/externalLink.tsx");function J(){const e=(0,l.useContext)(I);if(!e)throw new Error("useCustomMeasurements was called outside of CustomMeasurementsProvider");return e}i("../node_modules/core-js/modules/es.error.cause.js");var K=i("./app/views/dashboardsV2/widgetBuilder/utils.tsx"),ee=i("./app/views/dashboardsV2/widgetBuilder/buildSteps/buildStep.tsx"),te=i("./app/components/forms/field/index.tsx"),ie=i("./app/views/eventsV2/table/columnEditCollection.tsx");function se(e){var t;let{displayType:i,fieldOptions:s,widgetType:r,fields:a,organization:n,errors:o,onChange:d,filterAggregateParameters:l,filterPrimaryOptions:u,noFieldsMessage:c}=e;return(0,j.tZ)(te.Z,{inline:!1,error:null==o||null===(t=o.find((e=>null==e?void 0:e.fields)))||void 0===t?void 0:t.fields,flexibleControlStateSize:!0,stacked:!0,children:i===H.FO.TABLE?(0,j.tZ)(re,{columns:a,onChange:d,fieldOptions:s,organization:n,source:r,showAliasField:n.features.includes("new-widget-builder-experience-design"),filterAggregateParameters:l,filterPrimaryOptions:u,noFieldsMessage:c}):(0,j.tZ)(re,{columns:a.slice(0,a.length-1),onChange:e=>{d([...e,a[a.length-1]])},fieldOptions:s,organization:n,source:r,filterPrimaryOptions:u,noFieldsMessage:c})})}se.displayName="ColumnFields";const re=(0,d.Z)(ie.Z,{target:"e2w4m990"})("margin-top:",(0,B.Z)(1),";");function ae(e){let{dataSet:t,displayType:i,organization:s,widgetType:r,handleColumnFieldChange:n,queryErrors:o,explodedFields:d,tags:l}=e;const{customMeasurements:u}=J(),c=(0,G.v)(r);return(0,j.tZ)(ee.F,{title:(0,a.t)("Choose your columns"),description:t===K.qg.ISSUES?(0,a._N)("[fieldTagLink: Field and tag] columns will help you view more details about the issues (e.g., title).",{fieldTagLink:(0,j.tZ)(Y.Z,{href:"https://docs.sentry.io/product/sentry-basics/search/searchable-properties/#event-properties"})}):t===K.qg.RELEASES?(0,a._N)("To stack sessions, add [functionLink: functions] f(x) that may take in additional parameters. [fieldTagLink: Field and tag] columns will help you view more details about the sessions (e.g., releases).",{functionLink:(0,j.tZ)(Y.Z,{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns"}),fieldTagLink:(0,j.tZ)(Y.Z,{href:"https://docs.sentry.io/product/sentry-basics/search/searchable-properties/#release-properties"})}):(0,a._N)("To stack events, add [functionLink: functions] f(x) that may take in additional parameters. [fieldTagLink: Field and tag] columns will help you view more details about the events (e.g., title).",{functionLink:(0,j.tZ)(Y.Z,{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns"}),fieldTagLink:(0,j.tZ)(Y.Z,{href:"https://docs.sentry.io/product/sentry-basics/search/searchable-properties/#event-properties"})}),children:(0,j.tZ)(se,{displayType:i,organization:s,widgetType:r,fields:d,errors:o,fieldOptions:c.getTableFieldOptions(s,l,u),filterAggregateParameters:c.filterAggregateParams,filterPrimaryOptions:c.filterTableOptions,onChange:n})})}ae.displayName="ColumnsStep";var ne=i("./app/components/featureBadge.tsx"),oe=i("./app/components/forms/controls/radioGroup.tsx");const de=[[K.qg.EVENTS,(0,a.t)("Errors and Transactions")],[K.qg.ISSUES,(0,a.t)("Issues (States, Assignment, Time, etc.)")]];function le(e){let{dataSet:t,onChange:i,hasReleaseHealthFeature:s,displayType:r}=e;const n=[];return r!==H.FO.TABLE&&(n.push([K.qg.ISSUES,(0,a.t)("This dataset is restricted to tabular visualization.")]),r===H.FO.WORLD_MAP&&n.push([K.qg.RELEASES,(0,a.t)("This dataset is restricted to big number, tabular and time series visualizations.")])),(0,j.tZ)(ee.F,{title:(0,a.t)("Choose your dataset"),description:(0,a._N)("This reflects the type of information you want to use. To learn more, [link: read the docs].",{link:(0,j.tZ)(Y.Z,{href:"https://docs.sentry.io/product/dashboards/custom-dashboards/#data-set-selection"})}),children:(0,j.tZ)(ue,{label:"dataSet",value:t,choices:s?[...de,[K.qg.RELEASES,(0,j.BX)(l.Fragment,{children:[(0,a.t)("Releases (sessions, crash rates)")," ",(0,j.tZ)(ne.Z,{type:"beta"})]},"releases-dataset")]]:de,disabledChoices:n,onChange:e=>{i(e)}})})}le.displayName="DataSetStep";const ue=(0,d.Z)(oe.Z,{target:"e1eujfdx0"})("display:flex;flex-wrap:wrap;gap:",(0,B.Z)(2),";");var ce=i("./app/components/button.tsx"),pe=i("./app/components/forms/controls/input.tsx"),ge=i("./app/icons/index.tsx");function me(e){let{canAddSearchConditions:t,queries:i,onQueryRemove:s,onAddSearchConditions:r,onQueryChange:n,organization:o,hideLegendAlias:d,queryErrors:u,widgetType:c,selection:p}=e;const g=(0,l.useRef)(void 0);(0,l.useEffect)((()=>()=>{window.clearTimeout(g.current)}),[]);const m=(0,l.useCallback)((e=>t=>{window.clearTimeout(g.current),g.current=window.setTimeout((()=>{g.current=void 0}),200);const s={...i[e],conditions:t};n(e,s)}),[n,i]),h=(0,l.useCallback)((e=>t=>{if(!g.current){const s={...i[e],conditions:t};n(e,s)}}),[n,i]),y=(0,G.v)(c);return(0,j.tZ)(ee.F,{title:(0,a.t)("Filter your results"),description:t?(0,a.t)("This is how you filter down your search. You can add multiple queries to compare data for each overlay."):(0,a.t)("This is how you filter down your search."),children:(0,j.BX)("div",{children:[i.map(((e,t)=>{var r;return(0,j.tZ)(ye,{inline:!1,flexibleControlStateSize:!0,stacked:!0,error:null==u||null===(r=u[t])||void 0===r?void 0:r.conditions,children:(0,j.BX)(fe,{children:[(0,j.tZ)(y.SearchBar,{organization:o,pageFilters:p,onBlur:h(t),onSearch:m(t),widgetQuery:e}),!d&&(0,j.tZ)(he,{type:"text",name:"name",value:e.name,placeholder:(0,a.t)("Legend Alias"),onChange:e=>{const s={...i[t],name:e.target.value};n(t,s)}}),i.length>1&&(0,j.tZ)(ce.ZP,{size:"zero",borderless:!0,onClick:()=>s(t),icon:(0,j.tZ)(ge.Fz,{}),title:(0,a.t)("Remove query"),"aria-label":(0,a.t)("Remove query")})]})},t)})),t&&(0,j.tZ)(ce.ZP,{size:"sm",icon:(0,j.tZ)(ge.N_,{isCircled:!0}),onClick:r,children:(0,a.t)("Add Query")})]})})}me.displayName="FilterResultsStep";const he=(0,d.Z)(pe.Z,{target:"e12061i92"})({name:"1f6lq61",styles:"width:33%"}),ye=(0,d.Z)(te.Z,{target:"e12061i91"})("padding-bottom:",(0,B.Z)(1),";"),fe=(0,d.Z)("div",{target:"e12061i90"})("display:flex;align-items:center;>*+*{margin-left:",(0,B.Z)(1),";}");var be=i("../node_modules/@dnd-kit/core/dist/core.esm.js"),ve=i("../node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),we=i("./app/views/eventsV2/table/types.tsx"),Ze=i("./app/views/eventsV2/table/queryField.tsx");function xe(e){let{onDelete:t,onChange:i,fieldOptions:s,value:r,forwardRef:n,listeners:o,attributes:d,canDelete:u,canDrag:c,style:p,isDragging:g}=e;return(0,j.tZ)(Se,{ref:n,style:p,children:g?null:(0,j.BX)(l.Fragment,{children:[c&&(0,j.tZ)(Te,{...o,...d,"aria-label":(0,a.t)("Drag to reorder"),icon:(0,j.tZ)(ge.LS,{size:"xs"}),size:"zero",borderless:!0}),(0,j.tZ)(Ze.q,{placeholder:(0,a.t)("Select group"),fieldValue:r,fieldOptions:s,onChange:i,filterPrimaryOptions:e=>e.value.kind!==we.L.FUNCTION}),u&&(0,j.tZ)(ce.ZP,{size:"zero",borderless:!0,onClick:t,icon:(0,j.tZ)(ge.Fz,{}),title:(0,a.t)("Remove group"),"aria-label":(0,a.t)("Remove group")})]})})}xe.displayName="QueryField";const Te=(0,d.Z)(ce.ZP,{target:"epp8h3j1"})({name:"1k18kha",styles:"height:40px"}),Se=(0,d.Z)("div",{target:"epp8h3j0"})("display:flex;align-items:center;justify-content:space-between;width:100%;>*+*{margin-left:",(0,B.Z)(1),";}");var Ee=i("../node_modules/@dnd-kit/utilities/dist/utilities.esm.js"),Oe=i("../node_modules/@emotion/react/dist/emotion-element-cbed451f.browser.esm.js");function Ce(e){let{dragId:t,...i}=e;const s=(0,Oe.a)(),{listeners:r,setNodeRef:a,transform:n,transition:o,attributes:d,isDragging:l}=(0,ve.nB)({id:t,transition:null});let u={transform:Ee.ux.Transform.toString(n),transition:o,zIndex:"auto"};return l&&(u={...u,zIndex:100,height:"40px",border:`2px dashed ${s.border}`,borderRadius:s.borderRadius}),(0,j.tZ)(xe,{forwardRef:a,listeners:r,attributes:d,isDragging:l,style:u,...i})}Ce.displayName="SortableQueryField";const qe={kind:we.L.FIELD,field:""};function Fe(e){var t;let{fieldOptions:i,columns:s=[],onChange:r}=e;const[n,o]=(0,l.useState)(null);function d(e,t){const i=[...s];0===s.length?i.push(e):(0,N.ri)(t)&&(i[t]=e),r(i)}const u=1===s.length&&s[0].kind===we.L.FIELD&&""!==(null===(t=s[0])||void 0===t?void 0:t.field),c=s.length>1,p=c||u,g=s.map(M.sN),{filteredFieldOptions:m,columnsAsFieldOptions:h}=(0,l.useMemo)((()=>Object.keys(i).reduce(((e,t)=>{const s=i[t],r=g.findIndex((e=>e===s.value.meta.name));return-1===r?(e.filteredFieldOptions[t]=s,e):(e.columnsAsFieldOptions[r]={[t]:s},e)}),{filteredFieldOptions:{},columnsAsFieldOptions:[]})),[i,s]),y=(0,l.useMemo)((()=>s.reduce(((e,t,i)=>(e.push(String(i)),e)),[])),[s]);return(0,j.BX)(l.Fragment,{children:[(0,j.tZ)(ke,{inline:!1,flexibleControlStateSize:!0,stacked:!0,children:0===s.length?(0,j.tZ)(xe,{value:qe,fieldOptions:m,onChange:e=>d(e,0),canDelete:p}):(0,j.BX)(be.LB,{collisionDetection:be.pE,onDragStart:e=>{let{active:t}=e;o(t.id)},onDragEnd:e=>{let{over:t,active:i}=e;if(o(null),t){const e=y.indexOf.bind(y),a=e(i.id),n=e(t.id);a!==n&&r((0,ve.Rp)(s,a,n))}},onDragCancel:()=>{o(null)},children:[(0,j.tZ)(ve.Fo,{items:y,strategy:ve.qw,children:(0,j.tZ)(Ae,{children:s.map(((e,t)=>(0,j.tZ)(Ce,{dragId:y[t],value:e,fieldOptions:{...m,...h[t]},onChange:e=>d(e,t),onDelete:()=>function(e){const t=[...s];t.splice(e,1),r(t)}(t),canDrag:c,canDelete:p},y[t])))})}),(0,j.tZ)(be.y9,{dropAnimation:null,children:n?(0,j.tZ)(Be,{children:(0,j.tZ)(xe,{value:s[Number(n)],fieldOptions:{...m,...h[Number(n)]},onChange:e=>d(e,Number(n)),canDrag:c,canDelete:p})}):null})]})}),s.length<20&&(0,j.tZ)(_e,{size:"sm",icon:(0,j.tZ)(ge.N_,{isCircled:!0}),onClick:function(){const e=0===s.length?[{...qe},{...qe}]:[...s,{...qe}];r(e)},children:(0,a.t)("Add Group")})]})}Fe.displayName="GroupBySelector";const ke=(0,d.Z)(te.Z,{target:"esrd23w3"})("padding-bottom:",(0,B.Z)(1),";"),_e=(0,d.Z)(ce.ZP,{target:"esrd23w2"})({name:"b9l38d",styles:"width:min-content"}),Ae=(0,d.Z)("div",{target:"esrd23w1"})("display:grid;grid-auto-flow:row;gap:",(0,B.Z)(1),";"),Be=(0,d.Z)("div",{target:"esrd23w0"})("position:absolute;background:",(e=>e.theme.background),";padding:",(0,B.Z)(.5),";border-radius:",(e=>e.theme.borderRadius),";box-shadow:0 0 15px rgba(0, 0, 0, 0.15);opacity:0.8;cursor:grabbing;padding-right:",(0,B.Z)(2),";width:100%;button{cursor:grabbing;}@media (min-width: ",(e=>e.theme.breakpoints.small),"){width:710px;}");function Ne(e){let{dataSet:t,columns:i,onGroupByChange:s,organization:r,tags:n}=e;const o=(0,G.v)(bt[t]);return(0,j.tZ)(ee.F,{title:(0,a.t)("Group your results"),description:(0,a.t)("This is how you can group your data result by field or tag."),children:(0,j.tZ)(Fe,{columns:i,fieldOptions:o.getGroupByFieldOptions?o.getGroupByFieldOptions(r,n):{},onChange:s})})}Ne.displayName="GroupByStep";var De=i("./app/views/dashboardsV2/widgetBuilder/buildSteps/sortByStep/index.tsx"),Re=i("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),Le=i("../node_modules/lodash/debounce.js"),ze=i.n(Le),Ie=i("../node_modules/lodash/isEqual.js"),je=i.n(Ie),Pe=i("./app/components/charts/simpleTableChart.tsx"),Me=i("./app/components/forms/selectControl.tsx"),Ve=i("./app/components/panels/index.tsx"),We=i("./app/constants/index.tsx"),Ue=i("./app/utils/usePrevious.tsx"),He=i("./app/views/dashboardsV2/widgetCard/index.tsx");function Xe(e){let{organization:t,pageFilters:i,displayType:s,error:r,onChange:n,widget:o,noDashboardsMEPProvider:d}=e;const[u,c]=(0,l.useState)(o),p=(0,Ue.Z)(o),g=(0,l.useCallback)(ze()(((e,t)=>{t||c(e)}),We.Dk),[]);(0,l.useEffect)((()=>{let e=!1;return je()(p,o)||g(o,e),()=>{e=!0}}),[o,p,g]);const m=Object.keys(K.hV).map((e=>({label:K.hV[e],value:e})));return(0,j.BX)(ee.F,{title:(0,a.t)("Choose your visualization"),description:(0,a.t)("This is a preview of how your widget will appear in the dashboard."),children:[(0,j.tZ)(te.Z,{error:r,inline:!1,flexibleControlStateSize:!0,stacked:!0,children:(0,j.tZ)(Me.Z,{name:"displayType",options:m,value:s,onChange:e=>{n(e.value)},styles:{singleValue:e=>({...e,width:`calc(100% - ${(0,B.Z)(1)})`})}})}),(0,j.tZ)($e,{displayType:s,children:(0,j.tZ)(He.Z,{organization:t,selection:i,widget:u,isEditing:!1,widgetLimitReached:!1,renderErrorMessage:e=>"string"==typeof e&&(0,j.tZ)(Ve.aU,{type:"error",children:e}),isSorting:!1,currentWidgetDragging:!1,noLazyLoad:!0,showStoredAlert:!0,noDashboardsMEPProvider:d})})]})}Xe.displayName="VisualizationStep";const $e=(0,d.Z)("div",{target:"e1huhsf60"})("padding-right:",(0,B.Z)(2),";",He._,"{height:initial;}",(e=>e.displayType===H.FO.TABLE&&(0,Re.iv)("overflow:hidden;",Pe.p,"{height:41px;}",He._,"{height:301px;}","")),";");var Ge=i("./app/components/buttonBar.tsx");function Qe(e){let{title:t,onAdd:i}=e;return(0,j.tZ)(ce.ZP,{size:"sm",onClick:i,icon:(0,j.tZ)(ge.N_,{isCircled:!0}),children:t})}function Ye(e){let{onDelete:t}=e;return(0,j.tZ)(ce.ZP,{size:"zero",borderless:!0,onClick:t,icon:(0,j.tZ)(ge.Fz,{}),title:(0,a.t)("Remove this Y-Axis"),"aria-label":(0,a.t)("Remove this Y-Axis")})}function Je(e){var t;let{displayType:i,widgetType:s,aggregates:r,tags:n,onChange:d,errors:l,noFieldsMessage:u}=e;const c=(0,o.Z)(),p=(0,G.v)(s),{customMeasurements:g}=J(),m=null==l||null===(t=l.find((e=>null==e?void 0:e.aggregates)))||void 0===t?void 0:t.aggregates,h=r.length>1,y=[H.FO.WORLD_MAP,H.FO.BIG_NUMBER].includes(i)&&1===r.length||[H.FO.LINE,H.FO.AREA,H.FO.BAR].includes(i)&&3===r.length;return(0,j.BX)(te.Z,{inline:!1,flexibleControlStateSize:!0,error:m,stacked:!0,children:[r.map(((e,t)=>{var s,a;return(0,j.BX)(Ke,{children:[(0,j.tZ)(Ze.q,{fieldValue:e,fieldOptions:p.getTableFieldOptions(c,n,g),onChange:e=>function(e,t){const i=[...r];i[t]=e,d(i)}(e,t),filterPrimaryOptions:null===(s=p.filterYAxisOptions)||void 0===s?void 0:s.call(p,i),filterAggregateParameters:null===(a=p.filterYAxisAggregateParams)||void 0===a?void 0:a.call(p,e,i),otherColumns:r,noFieldsMessage:u}),r.length>1&&(h||e.kind===we.L.EQUATION)&&(0,j.tZ)(Ye,{onDelete:e=>function(e,t){e.preventDefault();const i=[...r];i.splice(t,1),d(i)}(e,t)})]},`${e}:${t}`)})),!y&&(0,j.BX)(et,{gap:1,children:[(0,j.tZ)(Qe,{title:(0,a.t)("Add Overlay"),onAdd:function(e){e.preventDefault();const t=[...r,{kind:we.L.FIELD,field:""}];d(t)}}),p.enableEquations&&(0,j.tZ)(Qe,{title:(0,a.t)("Add an Equation"),onAdd:function(e){e.preventDefault();const t=[...r,{kind:we.L.EQUATION,field:""}];d(t)}})]})]})}Qe.displayName="AddButton",Ye.displayName="DeleteButton",Je.displayName="YAxisSelector";const Ke=(0,d.Z)("div",{target:"ew36myz1"})("display:flex;align-items:center;justify-content:space-between;:not(:last-child){margin-bottom:",(0,B.Z)(1),";}>*+*{margin-left:",(0,B.Z)(1),";}"),et=(0,d.Z)(Ge.ZP,{target:"ew36myz0"})({name:"11g6mpt",styles:"justify-content:flex-start"});function tt(e){let{displayType:t,queryErrors:i,aggregates:s,onYAxisChange:r,tags:n,widgetType:o}=e;return(0,j.tZ)(ee.F,{title:t===H.FO.BIG_NUMBER?(0,a.t)("Choose what to plot"):(0,a.t)("Choose what to plot in the y-axis"),description:[H.FO.AREA,H.FO.BAR,H.FO.LINE].includes(t)?(0,a.t)("This is the data you'd be visualizing in the display. If the overlay units conflict, the charts will always base it off of the first line."):(0,a.t)("This is the data you'd be visualizing in the display."),children:(0,j.tZ)(Je,{widgetType:o,displayType:t,aggregates:s,onChange:r,tags:n,errors:i})})}tt.displayName="YAxisStep";var it=i("./app/components/confirm.tsx");function st(e){let{goBackLocation:t,onSave:i,onDelete:s,invalidForm:r,isEditing:n}=e;return(0,j.tZ)(at,{children:(0,j.BX)(rt,{gap:1,children:[(0,j.tZ)(ce.ZP,{to:t,children:(0,a.t)("Cancel")}),n&&s&&(0,j.tZ)(it.Z,{priority:"danger",message:(0,a.t)("Are you sure you want to delete this widget?"),onConfirm:s,children:(0,j.tZ)(ce.ZP,{priority:"danger",children:(0,a.t)("Delete")})}),(0,j.tZ)(ce.ZP,{priority:"primary",onClick:i,disabled:r,title:r?(0,a.t)("Required fields must be filled out"):void 0,children:n?(0,a.t)("Update Widget"):(0,a.t)("Add Widget")})]})})}st.displayName="Footer";const rt=(0,d.Z)(Ge.ZP,{target:"e1golk021"})("justify-content:flex-end;max-width:1000px;padding:",(0,B.Z)(4)," ",(0,B.Z)(2),";padding-right:calc(",(0,B.Z)(2)," + ",(0,B.Z)(2),");@media (min-width: ",(e=>e.theme.breakpoints.medium),"){padding:",(0,B.Z)(4),";padding-right:calc(",(0,B.Z)(4)," + ",(0,B.Z)(2),");}"),at=(0,d.Z)("div",{target:"e1golk020"})("background:",(e=>e.theme.background),";border-top:1px solid ",(e=>e.theme.gray200),";");var nt=i("./app/components/breadcrumbs.tsx"),ot=i("./app/components/editableText.tsx"),dt=i("./app/components/featureFeedback/index.tsx");function lt(e){let{title:t,orgSlug:i,goBackLocation:s,dashboardTitle:r,onChangeTitle:n}=e;return(0,j.BX)(E.h4,{children:[(0,j.BX)(E.oB,{children:[(0,j.tZ)(nt.Z,{crumbs:[{to:`/organizations/${i}/dashboards/`,label:(0,a.t)("Dashboards")},{to:s,label:r},{label:(0,a.t)("Widget Builder")}]}),(0,j.tZ)(E.Dx,{children:(0,j.tZ)(ot.Z,{"aria-label":(0,a.t)("Widget title"),value:t,onChange:n,errorMessage:(0,a.t)("Widget title is required"),maxLength:255})})]}),(0,j.tZ)(E.kP,{children:(0,j.BX)(Ge.ZP,{gap:1,children:[(0,j.tZ)(dt.z,{featureName:"widget-builder"}),(0,j.tZ)(ce.ZP,{external:!0,href:"https://docs.sentry.io/product/dashboards/custom-dashboards/#widget-builder",children:(0,a.t)("Read the docs")})]})})]})}lt.displayName="Header";var ut=i("./app/actionCreators/modal.tsx"),ct=i("./app/views/dashboardsV2/widgetLibrary/data.tsx"),pt=i("./app/views/dashboardsV2/widgetBuilder/widgetLibrary/card.tsx");function gt(e){let{bypassOverwriteModal:t,onWidgetSelect:i,widgetBuilderNewDesign:s,organization:r,selectedWidgetId:n}=e;const o=(0,Oe.a)();let d=(0,ct.P)();function u(e,s){return function(){t?i(e):(0,ut.openWidgetBuilderOverwriteModal)({onConfirm:()=>i(e),widget:e,iconColor:s})}}return r.features.includes("dashboards-releases")||(d=d.filter((e=>!(e.widgetType===H.l9.RELEASE)))),(0,j.BX)(l.Fragment,{children:[(0,j.tZ)(ht,{children:(0,a.t)("Widget Library")}),(0,j.tZ)(mt,{children:d.map(((e,t)=>{const i=o.charts.getColorPalette(d.length-2)[t],r=s&&e.displayType===H.FO.TOP_N?H.FO.TABLE:e.displayType,a=(0,K.Zi)({displayType:r,queries:e.queries,widgetBuilderNewDesign:s,widgetType:e.widgetType}),l={...e,displayType:r,queries:a};return(0,j.tZ)(yt,{selected:n===e.id,onClick:u(l,i),children:(0,j.tZ)(pt.Z,{widget:l,iconColor:i})},e.title)}))})]})}gt.displayName="WidgetLibrary";const mt=(0,d.Z)("div",{target:"ess72gf2"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"}),ht=(0,d.Z)("h5",{target:"ess72gf1"})("padding-left:calc(",(0,B.Z)(2)," - ",(0,B.Z)(.25),");"),yt=(0,d.Z)("div",{target:"ess72gf0"})("padding:calc(",(0,B.Z)(2)," - 3px);border:1px solid transparent;border-radius:",(e=>e.theme.borderRadius),";transition:border-color 0.3s ease;cursor:pointer;&:hover{border-color:",(e=>e.theme.gray100),";}",(e=>e.selected&&`border-color: ${e.theme.gray200};`),";"),ft={[H.l9.DISCOVER]:K.qg.EVENTS,[H.l9.ISSUE]:K.qg.ISSUES,[H.l9.RELEASE]:K.qg.RELEASES},bt={[K.qg.EVENTS]:H.l9.DISCOVER,[K.qg.ISSUES]:H.l9.ISSUE,[K.qg.RELEASES]:H.l9.RELEASE};function vt(e){var t,i,s,r,o,d,u;let{dashboard:p,params:m,location:y,organization:E,selection:O,start:C,end:F,statsPeriod:B,onSave:R,route:I,router:V,tags:W}=e;const{widgetIndex:Y,orgId:J,dashboardId:ee}=m,{source:te,displayType:ie,defaultTitle:se,limit:re}=y.query,ne=(0,K.eQ)(y.query.defaultWidgetQuery);let{defaultTableColumns:oe}=y.query;"string"==typeof oe&&(oe=[oe]);const de=E.features.includes("new-widget-builder-experience-design"),ue=E.features.includes("dashboards-releases"),ce=p.widgets.filter((e=>{let{widgetType:t}=e;return t!==H.l9.RELEASE||ue})),pe=(0,N.ri)(Y),ge=Number(Y),he=ge>=0&&ge<ce.length&&Number.isInteger(ge),ye=E.slug,fe=B?{...O,datetime:{start:null,end:null,period:B,utc:null}}:C&&F?{...O,datetime:{start:C,end:F,period:null,utc:null}}:O,be=[H.EN.DISCOVERV2,H.EN.ISSUE_DETAILS].includes(te),ve=(0,z.Z)(),[we,Ze]=(0,l.useState)(!1),[xe,Te]=(0,l.useState)((0,G.v)(H.l9.DISCOVER)),[Se,Ee]=(0,l.useState)((()=>{var e;const t={title:null!=se?se:(0,a.t)("Custom Widget"),displayType:null!==(e=de&&ie===H.FO.TOP_N?H.FO.AREA:ie)&&void 0!==e?e:H.FO.TABLE,interval:"5m",queries:[],limit:re?Number(re):void 0,errors:void 0,loading:!!be,dashboards:[],userHasModified:!1,prebuiltWidgetId:null,dataSet:K.qg.EVENTS};return ne?(t.queries=de?[{...ne,orderby:ne.orderby||(xe.getTableSortOptions?xe.getTableSortOptions(E,ne)[0].value:"")}]:[{...ne}],[H.FO.TABLE,H.FO.TOP_N].includes(t.displayType)||(0,K.V0)(t.displayType)&&t.queries[0].columns.length||(t.queries[0].orderby="")):t.queries=[{...xe.defaultWidgetQuery}],t})),[Oe,Ce]=(0,l.useState)(null),[qe,Fe]=(0,l.useState)(null);(0,l.useEffect)((()=>{if((0,D.Z)("dashboards_views.widget_builder.opened",{organization:E,new_widget:!pe}),(0,N.z)(W)&&(0,Z.QK)(ve,E.slug,O),pe&&he){const i=ce[ge];let s,r=i.displayType,a=i.limit;var e,t;i.displayType===H.FO.TOP_N?(a=K._k,r=H.FO.AREA,s=(0,K.Zi)({displayType:r,queries:i.queries,widgetType:null!==(e=i.widgetType)&&void 0!==e?e:H.l9.DISCOVER,widgetBuilderNewDesign:de}).map((e=>({...e,aggregates:e.aggregates.length?[e.aggregates[e.aggregates.length-1]]:[]})))):s=(0,K.Zi)({displayType:r,queries:i.queries,widgetType:null!==(t=i.widgetType)&&void 0!==t?t:H.l9.DISCOVER,widgetBuilderNewDesign:de}),Ee({title:i.title,displayType:r,interval:i.interval,queries:s,errors:void 0,loading:!1,dashboards:[],userHasModified:!1,dataSet:i.widgetType?ft[i.widgetType]:K.qg.EVENTS,limit:a,prebuiltWidgetId:null}),Te((0,G.v)(i.widgetType)),Ce(i)}}),[]),(0,l.useEffect)((()=>{be&&async function(){const e=ve.requestPromise(`/organizations/${E.slug}/dashboards/`,{method:"GET",query:{sort:"myDashboardsAndRecentlyViewed"}});try{const t=await e;Ee((e=>({...e,dashboards:t,loading:!1})))}catch(e){const t=(0,a.t)("Unable to fetch dashboards");(0,v.Iw)(t),(0,L.Z)(t)(e),Ee((e=>({...e,loading:!1})))}}(),de&&Ee((e=>({...e,selectedDashboard:{label:p.title,value:p.id||K.i0}})))}),[ve,p.id,p.title,be,E.slug,te,de]),(0,l.useEffect)((()=>{var e;(0,w.MA)(ve,E.slug,null===(e=O.projects)||void 0===e?void 0:e.map(String))}),[O.projects,ve,E.slug]),(0,l.useEffect)((()=>{V.setRouteLeaveHook(I,(()=>{if(!we&&Se.userHasModified)return(0,a.t)("You have unsaved changes, are you sure you want to leave?")}))}),[we,Se.userHasModified,I,V]);const ke=Se.dataSet===K.qg.EVENTS?H.l9.DISCOVER:Se.dataSet===K.qg.ISSUES?H.l9.ISSUE:H.l9.RELEASE,_e={title:Se.title,displayType:Se.displayType,interval:Se.interval,queries:Se.queries,limit:Se.limit,widgetType:ke},Ae=null!==(t=null===(i=Se.selectedDashboard)||void 0===i?void 0:i.value)&&void 0!==t?t:ee,Be=h()(y.query,"source"),Re={pathname:(0,N.ri)(Ae)&&Ae!==K.i0?`/organizations/${J}/dashboard/${Ae}/`:`/organizations/${J}/dashboards/${K.i0}/`,query:g()(Be)?void 0:Be},Le=(0,K.V0)(Se.displayType),ze=[H.FO.TABLE,H.FO.TOP_N].includes(Se.displayType);function Ie(){return Oe?p.widgets.findIndex((e=>(0,N.ri)(e.id)?e.id===Oe.id:!!(0,N.ri)(e.tempId)&&e.tempId===Oe.tempId)):-1}function je(e,t){var i;(0,D.Z)("dashboards_views.widget_builder.change",{from:te,field:e,value:t,widget_type:ke,organization:E,new_widget:!pe}),Ee((i=>{const s=c()(i);return f()(s,e,t),"title"===e&&f()(s,"userHasModified",!0),{...s,errors:void 0}})),"displayType"===e&&t!==Se.displayType&&(i=t,Ee((e=>{const t=c()(e);if(!xe.supportedDisplayTypes.includes(i))return f()(t,"queries",(0,K.Zi)({displayType:i,queries:[{...(0,G.v)(H.l9.DISCOVER).defaultWidgetQuery}],widgetType:H.l9.DISCOVER,widgetBuilderNewDesign:de})),f()(t,"dataSet",K.qg.EVENTS),Te((0,G.v)(H.l9.DISCOVER)),{...t,errors:void 0};const s=(0,K.Zi)({displayType:i,queries:e.queries,widgetType:bt[e.dataSet],widgetBuilderNewDesign:de});var r;return i===H.FO.TOP_N&&s.splice(1),e.userHasModified||ne&&oe&&(i===H.FO.TABLE?s.forEach((e=>{var t;const i=(0,M.n0)(oe);e.columns=[...i.columns],e.aggregates=[...i.aggregates],e.fields=[...oe],e.orderby=null!==(t=ne.orderby)&&void 0!==t?t:e.fields.length?`${e.fields[0]}`:"-"})):i===ie&&s.forEach((e=>{e.fields=[...ne.columns,...ne.aggregates],e.aggregates=[...ne.aggregates],e.columns=[...ne.columns],ne.orderby&&(ie===H.FO.TOP_N||ne.columns.length)&&(e.orderby=ne.orderby)}))),f()(t,"queries",s),de&&((0,K.V0)(i)&&s[0].columns.filter((e=>!!e)).length?t.limit=null!==(r=e.limit)&&void 0!==r?r:Math.min((0,K.oA)(s.length,s[0].columns.length),K._k):t.limit=void 0),f()(t,"userHasModified",!0),{...t,errors:void 0}})))}function Pe(e,t){Ee((i=>{const s=c()(i);return f()(s,`queries.${e}`,t),f()(s,"userHasModified",!0),{...s,errors:void 0}}))}function Me(){if(!pe)return;Ze(!0);let e=[...p.widgets];const t=Ie();e.splice(t,1),e=(0,U.Bb)(e),R(e),V.push(Re)}async function Ve(){var e;const t=(0,U.TE)(_e);if(Oe&&(t.layout=null==Oe?void 0:Oe.layout),de||ze||t.queries.forEach((e=>{e.orderby=""})),de||t.queries.forEach((e=>h()(e,"fieldAliases"))),de&&!Le&&(t.limit=void 0),await async function(e){if(be&&(!Se.selectedDashboard||!Se.dashboards.find((e=>{var t,i;let{title:s,id:r}=e;return s===(null===(t=Se.selectedDashboard)||void 0===t?void 0:t.label)&&r===(null===(i=Se.selectedDashboard)||void 0===i?void 0:i.value)}))&&Se.selectedDashboard.value!==K.i0))return Ee({...Se,errors:{...Se.errors,dashboard:(0,a.t)("This field may not be blank")}}),!1;Ee({...Se,loading:!0});try{return await(0,b.QL)(ve,E.slug,e),!0}catch(e){var t;return Ee({...Se,loading:!1,errors:{...Se.errors,...(0,K.wc)(null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:{},{})}}),!1}}(t))if(qe&&(0,D.Z)("dashboards_views.widget_library.add_widget",{organization:E,title:qe}),Ze(!0),be)!function(e){var t;if(!Se.selectedDashboard)return;const i={queryNames:[],queryConditions:[],queryFields:[...e.queries[0].columns,...e.queries[0].aggregates],queryOrderby:e.queries[0].orderby};e.queries.forEach((e=>{i.queryNames.push(e.name),i.queryConditions.push(e.conditions)}));const s={displayType:e.displayType,interval:e.interval,title:e.title,...i,project:fe.projects,environment:fe.environments,...h()(fe.datetime,"period"),statsPeriod:null===(t=fe.datetime)||void 0===t?void 0:t.period};(0,v.S9)((0,a.t)("Added widget.")),We(Se.selectedDashboard.value,s)}(t);else{if(Oe){var i;let e=[...p.widgets];const s=Ie(),r={...t,id:Oe.id};return(0,U.I_)(Oe.displayType)!==(0,U.I_)(t.displayType)?(e[s]=(0,U.W8)(r),e=(0,U.Bb)(e)):e[s]=r,R(e),(0,v.S9)((0,a.t)("Updated widget.")),We(null!=ee?ee:K.i0),void(0,D.Z)("dashboards_views.widget_builder.save",{organization:E,data_set:null!==(i=t.widgetType)&&void 0!==i?i:H.l9.DISCOVER,new_widget:!1})}R([...p.widgets,t]),(0,v.S9)((0,a.t)("Added widget.")),We(null!=ee?ee:K.i0),(0,D.Z)("dashboards_views.widget_builder.save",{organization:E,data_set:null!==(e=t.widgetType)&&void 0!==e?e:H.l9.DISCOVER,new_widget:!0})}}function We(e,t){const i=!g()(Be)||t?{...Be,...t}:void 0;e!==K.i0?V.push({pathname:`/organizations/${E.slug}/dashboard/${e}/`,query:i}):V.push({pathname:`/organizations/${E.slug}/dashboards/new/`,query:i})}function Ue(e){return!!(!e&&(0,X.BD)(_e)||be&&!Se.selectedDashboard)}const He=[H.FO.LINE,H.FO.AREA,H.FO.BAR].includes(Se.displayType)&&Se.queries.length<3,$e=[H.FO.TABLE,H.FO.WORLD_MAP,H.FO.BIG_NUMBER].includes(Se.displayType),{columns:Ge,aggregates:Qe,fields:Ye,fieldAliases:Je=[]}=Se.queries[0],Ke=(0,l.useMemo)((()=>Ge.map(((e,t)=>(0,M.HM)({field:e,alias:Je[t]})))),[Ge,Je]),et=(0,l.useMemo)((()=>Qe.map(((e,t)=>(0,M.HM)({field:e,alias:Je[t]})))),[Qe,Je]),it=(0,N.ri)(Ye)?Ye.map(((e,t)=>(0,M.HM)({field:e,alias:Je[t]}))):[...Ke,...et],rt=_e.queries.some((e=>e.columns.filter((e=>!!e)).length>0)),at=de&&Le&&rt||ze;return pe&&!he?(0,j.tZ)(A.Z,{title:p.title,orgSlug:ye,children:(0,j.tZ)(n.JH,{children:(0,j.tZ)(q.Z,{message:(0,a.t)("The widget you want to edit was not found.")})})}):(0,j.tZ)(A.Z,{title:p.title,orgSlug:ye,children:(0,j.tZ)(k.Z,{defaultSelection:{datetime:{start:null,end:null,utc:!1,period:$.GY}},children:(0,j.tZ)(P,{organization:E,selection:O,children:(0,j.tZ)(Q.KC,{children:(0,j.BX)(Zt,{children:[(0,j.tZ)(lt,{orgSlug:ye,title:Se.title,dashboardTitle:p.title,goBackLocation:Re,onChangeTitle:e=>{je("title",e)}}),(0,j.BX)(St,{children:[(0,j.BX)(Ct,{children:[(0,j.BX)(Et,{children:[(0,j.BX)(xt,{condensed:!0,children:[(0,j.tZ)(_.Z,{}),(0,j.tZ)(S.Z,{}),(0,j.tZ)(T.Z,{alignDropdown:"left"})]}),(0,j.BX)(Tt,{symbol:"colored-numeric",children:[(0,j.tZ)(Xe,{widget:_e,organization:E,pageFilters:fe,displayType:Se.displayType,error:null===(s=Se.errors)||void 0===s?void 0:s.displayType,onChange:e=>{je("displayType",e)},noDashboardsMEPProvider:!0}),(0,j.tZ)(le,{dataSet:Se.dataSet,displayType:Se.displayType,onChange:function(e){(0,D.Z)("dashboards_views.widget_builder.change",{from:te,field:"dataSet",value:e,widget_type:ke,organization:E,new_widget:!pe}),Ee((t=>{const i=c()(t);i.queries.splice(0,i.queries.length),f()(i,"dataSet",e),e===K.qg.ISSUES&&f()(i,"displayType",H.FO.TABLE);const s=(0,G.v)(bt[e]);return Te(s),i.queries.push(...null!=Oe&&Oe.widgetType&&ft[Oe.widgetType]===e?Oe.queries:[{...s.defaultWidgetQuery}]),f()(i,"userHasModified",!0),{...i,errors:void 0}}))},hasReleaseHealthFeature:ue}),ze&&(0,j.tZ)(ae,{dataSet:Se.dataSet,queries:Se.queries,displayType:Se.displayType,widgetType:ke,queryErrors:null===(r=Se.errors)||void 0===r?void 0:r.queries,onQueryChange:Pe,handleColumnFieldChange:function(e){const t=e.map(M.sN),i=(0,M.KZ)(e),s=c()(Se);let r=c()(s.queries[0]);r.fields=t,r.aggregates=i.aggregates,r.columns=i.columns,r.fieldAliases=i.fieldAliases,xe.handleColumnFieldChangeOverride&&(r=xe.handleColumnFieldChangeOverride(r)),xe.handleOrderByReset&&(r=xe.handleOrderByReset(r,t)),f()(s,"queries",[r]),f()(s,"userHasModified",!0),Ee(s)},explodedFields:it,tags:W,organization:E}),![H.FO.TABLE].includes(Se.displayType)&&(0,j.tZ)(tt,{dataSet:Se.dataSet,displayType:Se.displayType,widgetType:ke,queryErrors:null===(o=Se.errors)||void 0===o?void 0:o.queries,onYAxisChange:e=>{!function(e){const t=e.map(M.sN),i=c()(Se),s=Se.queries.map((e=>{let i=c()(e);var s,r;return Se.displayType===H.FO.TOP_N?(i.fields=[...null!==(s=null===(r=i.fields)||void 0===r?void 0:r.slice(0,i.fields.length-1))&&void 0!==s?s:[],...t],i.aggregates=[...i.aggregates.slice(0,i.aggregates.length-1),...t]):(i.fields=[...i.columns,...t],i.aggregates=t),xe.handleOrderByReset&&(i=xe.handleOrderByReset(i,t)),i}));f()(i,"queries",s),f()(i,"userHasModified",!0);const r=i.queries[0].columns.filter((e=>!("equation|"===e)));var a;0===r.length?f()(i,"limit",void 0):f()(i,"limit",Math.min(null!==(a=i.limit)&&void 0!==a?a:K._k,(0,K.oA)(s.length,s[0].aggregates.length))),Ee(i)}(e)},aggregates:et,tags:W,organization:E}),(0,j.tZ)(me,{queries:Se.queries,hideLegendAlias:$e,canAddSearchConditions:He,organization:E,queryErrors:null===(d=Se.errors)||void 0===d?void 0:d.queries,onAddSearchConditions:function(){Ee((e=>{const t=c()(e),i=(0,G.v)(bt[e.dataSet]),s=c()(i.defaultWidgetQuery);return s.fields=e.queries[0].fields,s.aggregates=e.queries[0].aggregates,s.columns=e.queries[0].columns,s.orderby=e.queries[0].orderby,t.queries.push(s),t}))},onQueryChange:Pe,onQueryRemove:function(e){Ee((t=>{const i=c()(t);return i.queries.splice(e,1),{...i,errors:void 0}}))},selection:fe,widgetType:ke}),de&&Le&&(0,j.tZ)(Ne,{columns:Ge.filter((e=>!("equation|"===e))).map(((e,t)=>(0,M.HM)({field:e,alias:Je[t]}))),onGroupByChange:function(e){const t=e.map(M.sN),i=c()(Se),s=Se.queries.map((e=>{const i=c()(e);if(i.columns=t,t.length){if(!i.orderby){const t=(0,x._4)({widgetType:null!=ke?ke:H.l9.DISCOVER,widgetBuilderNewDesign:de,columns:e.columns,aggregates:e.aggregates});let s;t.length?(s=t[0].value,i.orderby=`-${s}`):i.orderby=""}}else i.orderby="";return i}));f()(i,"userHasModified",!0),f()(i,"queries",s);const r=i.queries[0].columns.filter((e=>!("equation|"===e)));var a;0===r.length?f()(i,"limit",void 0):f()(i,"limit",Math.min(null!==(a=i.limit)&&void 0!==a?a:K._k,(0,K.oA)(s.length,s[0].aggregates.length))),Ee(i)},organization:E,tags:W,dataSet:Se.dataSet}),at&&(0,j.tZ)(De.j,{limit:Se.limit,displayType:Se.displayType,queries:Se.queries,dataSet:Se.dataSet,widgetBuilderNewDesign:de,error:null===(u=Se.errors)||void 0===u?void 0:u.orderby,onSortByChange:function(e){const t=c()(Se);Se.queries.forEach(((i,s)=>{const r=c()(i);r.orderby=e,f()(t,`queries.${s}`,r)})),f()(t,"userHasModified",!0),Ee(t)},onLimitChange:function(e){Ee((t=>({...t,limit:e})))},organization:E,widgetType:ke,tags:W})]})]}),(0,j.tZ)(Q.k,{children:e=>{let{isMetricsData:t}=e;return(0,j.tZ)(st,{goBackLocation:Re,isEditing:pe,onSave:Ve,onDelete:Me,invalidForm:Ue(t)})}})]}),(0,j.tZ)(Ot,{children:(0,j.tZ)(gt,{organization:E,widgetBuilderNewDesign:de,selectedWidgetId:Se.userHasModified?null:Se.prebuiltWidgetId,onWidgetSelect:e=>{Fe(e.title),Te((0,G.v)(e.widgetType||H.l9.DISCOVER));const{id:t,...i}=e;Ee({...Se,...i,dataSet:e.widgetType?ft[e.widgetType]:K.qg.EVENTS,userHasModified:!1,prebuiltWidgetId:t||null})},bypassOverwriteModal:!Se.userHasModified})})]})]})})})})})}vt.displayName="WidgetBuilder";const wt=(0,V.Z)((0,W.Z)(vt)),Zt=(0,d.Z)(n.JH,{target:"e1rwomk16"})({name:"1hcx8jb",styles:"padding:0"}),xt=(0,d.Z)(F.Z,{target:"e1rwomk15"})("margin-bottom:",(0,B.Z)(2),";"),Tt=(0,d.Z)(O.Z,{target:"e1rwomk14"})("gap:",(0,B.Z)(4),";max-width:100%;"),St=(0,d.Z)(E.uT,{target:"e1rwomk13"})("&&{gap:0;padding:0;}grid-template-rows:1fr;@media (min-width: ",(e=>e.theme.breakpoints.large),"){grid-template-columns:minmax(100px, auto) 400px;}@media (min-width: ",(e=>e.theme.breakpoints.xlarge),"){grid-template-columns:1fr;}"),Et=(0,d.Z)(E.or,{target:"e1rwomk12"})("max-width:1000px;flex:1;padding:",(0,B.Z)(4)," ",(0,B.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints.medium),"){padding:",(0,B.Z)(4),";}@media (max-width: calc(",(e=>e.theme.breakpoints.large)," + ",(0,B.Z)(4),")){",C.Z,"{width:calc(100% - ",(0,B.Z)(4),");}}"),Ot=(0,d.Z)(E.MF,{target:"e1rwomk11"})("padding:",(0,B.Z)(4)," ",(0,B.Z)(2),";@media (max-width: ",(e=>e.theme.breakpoints.large),"){border-top:1px solid ",(e=>e.theme.gray200),";grid-row:2/2;grid-column:1/-1;max-width:100%;}@media (min-width: ",(e=>e.theme.breakpoints.large),"){border-left:1px solid ",(e=>e.theme.gray200),";padding-right:",(0,B.Z)(4),";max-width:400px;}"),Ct=(0,d.Z)("div",{target:"e1rwomk10"})("display:flex;flex-direction:column;@media (max-width: ",(e=>e.theme.breakpoints.large),"){grid-column:1/-1;}");function qt(e){const t=(0,o.Z)();return(0,j.tZ)(s.Z,{features:["new-widget-builder-experience-design","dashboards-edit"],organization:t,renderDisabled:()=>(0,j.tZ)(n.JH,{children:(0,j.tZ)(r.Z,{type:"warning",children:(0,a.t)("You don't have access to this feature")})}),children:(0,j.tZ)(wt,{...e,organization:t})})}qt.displayName="WidgetBuilderContainer";const Ft=qt},"./app/views/dashboardsV2/widgetBuilder/widgetLibrary/card.tsx":(e,t,i)=>{i.d(t,{Z:()=>o});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=i("./app/styles/space.tsx"),a=i("./app/views/dashboardsV2/widgetLibrary/widgetCard.tsx"),n=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function o(e){let{widget:t,iconColor:i}=e;const{title:s,description:r,displayType:o}=t,g=(0,a.T)(o);return(0,n.BX)(d,{children:[(0,n.tZ)(p,{backgroundColor:i,children:(0,n.tZ)(g,{color:"white"})}),(0,n.BX)(l,{children:[(0,n.tZ)(u,{children:s}),(0,n.tZ)(c,{children:r})]})]})}o.displayName="Card";const d=(0,s.Z)("div",{target:"e1kr3ej04"})("display:flex;flex-direction:row;gap:",(0,r.Z)(1),";"),l=(0,s.Z)("div",{target:"e1kr3ej03"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"}),u=(0,s.Z)("div",{target:"e1kr3ej02"})("font-size:",(e=>e.theme.fontSizeLarge),";font-weight:500;margin-bottom:0;color:",(e=>e.theme.gray500),";"),c=(0,s.Z)("small",{target:"e1kr3ej01"})("color:",(e=>e.theme.gray300),";"),p=(0,s.Z)("div",{target:"e1kr3ej00"})("display:flex;justify-content:center;align-items:center;padding:",(0,r.Z)(1),";min-width:40px;height:40px;border-radius:",(e=>e.theme.borderRadius),";background:",(e=>e.backgroundColor),";")},"./app/views/dashboardsV2/widgetLibrary/data.tsx":(e,t,i)=>{i.d(t,{P:()=>o,c:()=>n});var s=i("./app/locale.tsx"),r=i("./app/utils/discover/types.tsx"),a=i("./app/views/dashboardsV2/types.tsx");const n=[{id:"duration-distribution",title:(0,s.t)("Duration Distribution"),description:(0,s.t)("Compare transaction durations across different percentiles."),displayType:a.FO.LINE,widgetType:a.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["p50(transaction.duration)","p75(transaction.duration)","p95(transaction.duration)"],aggregates:["p50(transaction.duration)","p75(transaction.duration)","p95(transaction.duration)"],columns:[],orderby:""}]},{id:"high-throughput-transactions",title:(0,s.t)("High Throughput Transactions"),description:(0,s.t)("Top 5 transactions with the largest volume."),displayType:a.FO.TOP_N,widgetType:a.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["transaction","count()"],aggregates:["count()"],columns:["transaction"],orderby:"-count()"}]},{id:"crash-rates-recent-releases",title:(0,s.t)("Crash Rates for Recent Releases"),description:(0,s.t)("Percentage of crashed sessions for latest releases."),displayType:a.FO.LINE,widgetType:a.l9.RELEASE,interval:"5m",limit:8,queries:[{name:"",conditions:"",fields:["crash_rate(session)","release"],aggregates:["crash_rate(session)"],columns:["release"],orderby:"-release"}]},{id:"session-health",title:(0,s.t)("Session Health"),description:(0,s.t)("Number of abnormal,crashed, errored and healthy sessions."),displayType:a.FO.TABLE,widgetType:a.l9.RELEASE,interval:"5m",queries:[{name:"",conditions:"",fields:["session.status","sum(session)"],aggregates:["sum(session)"],columns:["session.status"],orderby:""}]},{id:"lcp-country",title:(0,s.t)("LCP by Country"),description:(0,s.t)("Density map showing page load times by country."),displayType:a.FO.WORLD_MAP,widgetType:a.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"has:geo.country_code",fields:["p75(measurements.lcp)"],aggregates:["p75(measurements.lcp)"],columns:[],orderby:""}]},{id:"miserable-users",title:(0,s.t)("Miserable Users"),description:(0,s.t)("Unique users who have experienced slow load times."),displayType:a.FO.BIG_NUMBER,widgetType:a.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"",fields:["count_miserable(user,300)"],aggregates:["count_miserable(user,300)"],columns:[],orderby:""}]},{id:"slow-vs-fast",title:(0,s.t)("Slow vs. Fast Transactions"),description:(0,s.t)("Percentage breakdown of transaction durations over and under 300ms."),displayType:a.FO.BAR,widgetType:a.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["equation|(count_if(transaction.duration,greater,300) / count()) * 100","equation|(count_if(transaction.duration,lessOrEquals,300) / count()) * 100"],aggregates:["equation|(count_if(transaction.duration,greater,300) / count()) * 100","equation|(count_if(transaction.duration,lessOrEquals,300) / count()) * 100"],columns:[],orderby:""}]},{id:"issue-for-review",title:(0,s.t)("Issues For Review"),description:(0,s.t)("Most recently seen unresolved issues for review."),displayType:a.FO.TABLE,widgetType:a.l9.ISSUE,interval:"5m",queries:[{name:"",conditions:"is:unresolved is:for_review",fields:["issue","assignee","events","title"],aggregates:[],columns:["issue","assignee","events","title"],orderby:"date"}]},{id:"top-unhandled",title:(0,s.t)("Top Unhandled Error Types"),description:(0,s.t)("Most frequently encountered unhandled errors."),displayType:a.FO.TOP_N,widgetType:a.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"error.unhandled:true",fields:["error.type","count()"],aggregates:["count()"],columns:["error.type"],orderby:"-count()"}]},{id:"users-affected",title:(0,s.t)("Users Affected by Errors"),description:(0,s.t)("Footprint of unique users affected by errors."),displayType:a.FO.LINE,widgetType:a.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"event.type:error",fields:["count_unique(user)","count()"],aggregates:["count_unique(user)","count()"],columns:[],orderby:""}]}];function o(){return n.map((e=>e.displayType===a.FO.TOP_N?{...e,displayType:a.FO.AREA,limit:r.hY}:e))}},"./app/views/dashboardsV2/widgetLibrary/widgetCard.tsx":(e,t,i)=>{i.d(t,{T:()=>p,Z:()=>b});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/core-js/modules/es.array.includes.js"),i("../node_modules/react/index.js")),a=i("./app/components/panels/index.tsx"),n=i("./app/icons/index.tsx"),o=i("./app/icons/iconGraphArea.tsx"),d=i("./app/icons/iconGraphBar.tsx"),l=i("./app/styles/space.tsx"),u=i("./app/views/dashboardsV2/types.tsx"),c=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(e){switch(e){case u.FO.TABLE:return n.dc;case u.FO.WORLD_MAP:return n.vc;case u.FO.BIG_NUMBER:return n.A8;case u.FO.BAR:return d.U;case u.FO.TOP_N:return n.CC;case u.FO.AREA:return o.g;case u.FO.LINE:default:return n.TX}}function g(e){let{selectedWidgets:t,widget:i,setSelectedWidgets:s,"data-test-id":n}=e;const[o,d]=(0,r.useState)(t.includes(i)),l=p(i.displayType);return(0,c.tZ)(f,{"data-test-id":n,selected:o,onClick:()=>{if(o){const e=t.filter((e=>i!==e));s(e)}else{const e=t.slice().concat(i);s(e)}d(!o)},children:(0,c.BX)(a.N,{children:[(0,c.BX)(h,{children:[(0,c.tZ)(l,{size:"xs"}),(0,c.tZ)(m,{children:i.title})]}),(0,c.tZ)(y,{children:i.description})]})})}g.displayName="WidgetLibraryCard";const m=(0,s.Z)("div",{target:"e11j9f793"})("padding-left:",(0,l.Z)(1),";font-size:16px;line-height:140%;color:",(e=>e.theme.gray500),";"),h=(0,s.Z)("div",{target:"e11j9f792"})("padding:",(0,l.Z)(1.5)," ",(0,l.Z)(2),";padding-bottom:",(0,l.Z)(.5),";display:flex;align-items:center;"),y=(0,s.Z)("div",{target:"e11j9f791"})("padding:0 ",(0,l.Z)(1)," ",(0,l.Z)(1.5)," 36px;font-size:14px;line-height:21px;color:",(e=>e.theme.gray300),";"),f=(0,s.Z)(a.s_,{target:"e11j9f790"})("border:",(e=>e.selected?`2px solid ${e.theme.active}`:`1px solid ${e.theme.border}`),";margin:",(e=>e.selected?"-1px":0),";box-sizing:border-box;box-shadow:0px 2px 1px rgba(0, 0, 0, 0.08);cursor:pointer;"),b=g}}]);
//# sourceMappingURL=../sourcemaps/app_views_dashboardsV2_widgetBuilder_index_tsx.3a373236bcb30fafe6b2caac6a437929.js.map