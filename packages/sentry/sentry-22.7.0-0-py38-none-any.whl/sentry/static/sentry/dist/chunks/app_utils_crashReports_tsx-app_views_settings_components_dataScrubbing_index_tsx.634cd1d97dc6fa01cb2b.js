"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_crashReports_tsx-app_views_settings_components_dataScrubbing_index_tsx"],{"./app/utils/crashReports.tsx":(e,t,s)=>{s.d(t,{IS:()=>a,RF:()=>o,uk:()=>r});var i=s("./app/locale.tsx"),n=s("./app/utils.tsx");function a(e,t){return null===e&&(0,n.ri)(t)?(0,i._N)("Inherit organization settings ([organizationValue])",{organizationValue:a(t)}):-1===e?(0,i.t)("Unlimited"):0===e?(0,i.t)("Disabled"):(0,i._N)("[value] per issue",{value:e})}let o;function r(e){const t=[0,1,5,10,20,50,100,-1];return e===o.Project&&t.unshift(null),t}!function(e){e[e.Organization=0]="Organization",e[e.Project=1]="Project"}(o||(o={}))},"./app/views/settings/components/dataScrubbing/index.tsx":(e,t,s)=>{s.d(t,{Z:()=>Je});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),o=s("./app/actionCreators/indicator.tsx"),r=s("./app/actionCreators/modal.tsx"),l=s("./app/api.tsx"),d=s("./app/components/button.tsx"),u=s("./app/components/links/externalLink.tsx"),c=s("./app/components/panels/index.tsx"),h=s("./app/locale.tsx"),p=s("./app/styles/space.tsx"),g=s("../node_modules/lodash/isEqual.js"),v=s.n(g),m=s("../node_modules/lodash/omit.js"),y=s.n(m);let f,b,S,Z;function x(e){return e.type===f.PATTERN&&e.method===b.REPLACE?{type:e.type,pattern:e.pattern,redaction:{method:e.method,text:null==e?void 0:e.placeholder}}:e.type===f.PATTERN?{type:e.type,pattern:e.pattern,redaction:{method:e.method}}:e.method===b.REPLACE?{type:e.type,redaction:{method:e.method,text:null==e?void 0:e.placeholder}}:{type:e.type,redaction:{method:e.method}}}s("../node_modules/core-js/modules/es.array.includes.js"),function(e){e.PATTERN="pattern",e.CREDITCARD="creditcard",e.PASSWORD="password",e.IP="ip",e.IMEI="imei",e.EMAIL="email",e.UUID="uuid",e.PEMKEY="pemkey",e.URLAUTH="url_auth",e.USSSN="us_ssn",e.USER_PATH="userpath",e.MAC="mac",e.ANYTHING="anything"}(f||(f={})),function(e){e.MASK="mask",e.REMOVE="remove",e.HASH="hash",e.REPLACE="replace"}(b||(b={})),function(e){e.UNDEFINED="undefined",e.LOADING="loading",e.INVALID="invalid",e.NOT_FOUND="not_found",e.LOADED="loaded",e.ERROR="error"}(S||(S={})),function(e){e.VALUE="value",e.UNARY="unary",e.BINARY="binary",e.STRING="string"}(Z||(Z={}));const E=function(e,t,s){const i={},n={};for(let e=0;e<s.length;e++){const t=s[e],a=String(e);n[a]=x(t),i[t.source]||(i[t.source]=[]),i[t.source].includes(a)||i[t.source].push(a)}const a={rules:n,applications:i};return e.requestPromise(t,{method:"PUT",data:{relayPiiConfig:JSON.stringify(a)}})};function I(e){switch(e){case f.ANYTHING:return(0,h.t)("Anything");case f.IMEI:return(0,h.t)("IMEI numbers");case f.MAC:return(0,h.t)("MAC addresses");case f.EMAIL:return(0,h.t)("Email addresses");case f.PEMKEY:return(0,h.t)("PEM keys");case f.URLAUTH:return(0,h.t)("Auth in URLs");case f.USSSN:return(0,h.t)("US social security numbers");case f.USER_PATH:return(0,h.t)("Usernames in filepaths");case f.UUID:return(0,h.t)("UUIDs");case f.CREDITCARD:return(0,h.t)("Credit card numbers");case f.PASSWORD:return(0,h.t)("Password fields");case f.IP:return(0,h.t)("IP addresses");case f.PATTERN:return(0,h.t)("Regex matches");default:return""}}function R(e){switch(e){case b.MASK:return{label:(0,h.t)("Mask"),description:(0,h.t)("Replace with ****")};case b.HASH:return{label:(0,h.t)("Hash"),description:(0,h.t)("Replace with DEADBEEF")};case b.REMOVE:return{label:(0,h.t)("Remove"),description:(0,h.t)("Replace with null")};case b.REPLACE:return{label:(0,h.t)("Replace"),description:(0,h.t)("Replace with Placeholder")};default:return{label:""}}}const C=[{type:Z.BINARY,value:"&&"},{type:Z.BINARY,value:"||"}],A=[{type:Z.UNARY,value:"!"}],w=[{type:Z.VALUE,value:"**",description:(0,h.t)("everywhere")},{type:Z.VALUE,value:"password",description:(0,h.t)('attributes named "password"')},{type:Z.VALUE,value:"$error.value",description:(0,h.t)("the exception value")},{type:Z.VALUE,value:"$message",description:(0,h.t)("the log message")},{type:Z.VALUE,value:"extra.MyValue",description:(0,h.t)('the key "MyValue" in "Additional Data"')},{type:Z.VALUE,value:"extra.**",description:(0,h.t)('everything in "Additional Data"')},{type:Z.VALUE,value:"$http.headers.x-custom-token",description:(0,h.t)("the X-Custom-Token HTTP header")},{type:Z.VALUE,value:"$user.ip_address",description:(0,h.t)("the user IP address")},{type:Z.VALUE,value:"$frame.vars.foo",description:(0,h.t)('the local variable "foo"')},{type:Z.VALUE,value:"contexts.device.timezone",description:(0,h.t)("the timezone in the device context")},{type:Z.VALUE,value:"tags.server_name",description:(0,h.t)('the tag "server_name"')},{type:Z.VALUE,value:"$attachments.**",description:(0,h.t)("all attachments")},{type:Z.VALUE,value:"$attachments.'logfile.txt'",description:(0,h.t)('all attachments named "logfile.txt"')},{type:Z.VALUE,value:"$minidump",description:(0,h.t)("the entire minidump of a native crash report")},{type:Z.VALUE,value:"$minidump.heap_memory",description:(0,h.t)("the heap memory region in a native crash report")},{type:Z.VALUE,value:"code_file",description:(0,h.t)("the pathname of a code module in a native crash report")},{type:Z.VALUE,value:"debug_file",description:(0,h.t)("the pathname of a debug module in a native crash report")}];var D=s("../node_modules/lodash/sortBy.js"),N=s.n(D),k=s("./app/components/forms/controls/input.tsx"),T=s("./app/components/forms/field/index.tsx"),U=s("./app/icons/index.tsx"),P=(s("../node_modules/core-js/modules/es.string.replace.js"),s("../node_modules/@sentry/hub/esm/exports.js")),V=s("./app/utils/localStorage.tsx");const L="advanced-data-scrubbing";function F(e){try{V.Z.setItem(L,JSON.stringify(e))}catch(t){P.Tb(t),P.$e((s=>{s.setExtra("storage",e),P.Tb(t)}))}}function O(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w;switch(e.status){case S.LOADING:break;case S.LOADED:F({eventId:e.value,sourceSuggestions:t});break;default:F({eventId:"",sourceSuggestions:t})}}var M=s("./app/components/forms/field/controlState.tsx"),z=s("./app/components/tooltip.tsx"),B=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const _=e=>{let{status:t,onClickIconClose:s}=e;switch(t){case S.ERROR:case S.INVALID:case S.NOT_FOUND:return(0,B.tZ)(j,{onClick:s,children:(0,B.tZ)(z.Z,{title:(0,h.t)("Clear event ID"),children:(0,B.tZ)($,{size:"xs"})})});case S.LOADING:return(0,B.tZ)(M.Z,{isSaving:!0});case S.LOADED:return(0,B.tZ)(U.DL,{color:"green300"});default:return null}},j=(0,n.Z)("div",{target:"e1r9uw6i1"})({name:"15o8flj",styles:":first-child{line-height:0;}"}),$=(0,n.Z)(U.bM,{target:"e1r9uw6i0"})("color:",(e=>e.theme.gray200),";:hover{color:",(e=>e.theme.gray300),";}cursor:pointer;");class X extends a.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{...this.props.eventId}),(0,i.Z)(this,"handleChange",(e=>{const t=e.target.value.replace(/-/g,"").trim();t!==this.state.value&&this.setState({value:t,status:S.UNDEFINED})})),(0,i.Z)(this,"handleBlur",(e=>{e.preventDefault(),this.isEventIdValid()&&this.props.onUpdateEventId(this.state.value)})),(0,i.Z)(this,"handleKeyDown",(e=>{const{keyCode:t}=e;13===t&&this.isEventIdValid()&&this.props.onUpdateEventId(this.state.value)})),(0,i.Z)(this,"handleClickIconClose",(()=>{this.setState({value:"",status:S.UNDEFINED})}))}componentDidUpdate(e){v()(e.eventId,this.props.eventId)||this.loadState()}loadState(){this.setState({...this.props.eventId})}getErrorMessage(){const{status:e}=this.state;switch(e){case S.INVALID:return(0,h.t)("This event ID is invalid.");case S.ERROR:return(0,h.t)("An error occurred while fetching the suggestions based on this event ID.");case S.NOT_FOUND:return(0,h.t)("The chosen event ID was not found in projects you have access to.");default:return}}isEventIdValid(){const{value:e,status:t}=this.state;return!e||32===e.length||(t!==S.INVALID&&(O({value:e,status:t}),this.setState({status:S.INVALID})),!1)}render(){const{disabled:e}=this.props,{value:t,status:s}=this.state;return(0,B.tZ)(T.Z,{"data-test-id":"event-id-field",label:(0,h.t)("Event ID (Optional)"),help:(0,h.t)("Providing an event ID will automatically provide you a list of suggested sources"),inline:!1,error:this.getErrorMessage(),flexibleControlStateSize:!0,stacked:!0,showHelpInTooltip:!0,children:(0,B.BX)(G,{children:[(0,B.tZ)(q,{type:"text",name:"eventId",disabled:e,value:t,placeholder:(0,h.t)("XXXXXXXXXXXXXX"),onChange:this.handleChange,onKeyDown:this.handleKeyDown,onBlur:this.handleBlur}),(0,B.tZ)(Y,{children:(0,B.tZ)(_,{onClickIconClose:this.handleClickIconClose,status:s})})]})})}}X.displayName="EventIdField";const H=X,q=(0,n.Z)(k.Z,{target:"e1noqa6o2"})("flex:1;font-weight:400;input{padding-right:",(0,p.Z)(1.5),";}margin-bottom:0;"),Y=(0,n.Z)("div",{target:"e1noqa6o1"})("height:40px;position:absolute;right:",(0,p.Z)(1.5),";top:0;display:flex;align-items:center;"),G=(0,n.Z)("div",{target:"e1noqa6o0"})({name:"9iujih",styles:"position:relative;display:flex;align-items:center"});var K=s("../node_modules/react-select/dist/index-4322c0ed.browser.esm.js"),W=s("./app/components/forms/selectControl.tsx");class J extends a.Component{constructor(){super(...arguments),(0,i.Z)(this,"selectRef",(0,a.createRef)())}componentDidMount(){var e,t;this.selectRef.current&&null!==(e=this.selectRef.current)&&void 0!==e&&null!==(t=e.select)&&void 0!==t&&t.inputRef&&(this.selectRef.current.select.inputRef.autocomplete="off")}render(){return(0,B.tZ)(W.Z,{...this.props,isSearchable:!1,styles:{control:e=>({...e,minHeight:"41px",height:"41px"})},ref:this.selectRef,components:{Option:e=>{let{data:{label:t,description:s,...i},isSelected:n,...a}=e;return(0,B.tZ)(K.y.Option,{isSelected:n,data:i,...a,children:(0,B.BX)(te,{children:[(0,B.tZ)("div",{"data-test-id":"label",children:t}),s&&(0,B.tZ)(ee,{children:`(${s})`})]})})}},openOnFocus:!0})}}J.displayName="SelectField";const Q=J,ee=(0,n.Z)("div",{target:"eeyos7j1"})("color:",(e=>e.theme.gray300),";"),te=(0,n.Z)("div",{target:"eeyos7j0"})("display:grid;grid-template-columns:1fr auto;gap:",(0,p.Z)(1),";");var se=s("./app/components/forms/inputField.tsx"),ie=s("./app/components/textOverflow.tsx"),ne=s("./app/utils.tsx"),ae=s("./app/components/hovercard.tsx");const oe=e=>{let{examples:t,sourceName:s}=e;return(0,B.tZ)(ue,{children:(0,B.tZ)(le,{position:"right",header:(0,h.t)("Examples for %s in current event",(0,B.tZ)("code",{children:s})),body:t.map((e=>(0,B.tZ)("pre",{children:e},e))),children:(0,B.BX)(de,{children:[(0,h.t)("See Example")," ",(0,B.tZ)(U.BS,{size:"xs"})]})})})};oe.displayName="SourceSuggestionExamples";const re=oe,le=(0,n.Z)(ae.uI,{target:"evt2a1f2"})({name:"75ukw4",styles:"width:400px;pre:last-child{margin:0;}"}),de=(0,n.Z)("span",{target:"evt2a1f1"})("display:inline-grid;grid-template-columns:repeat(2, max-content);align-items:center;gap:",(0,p.Z)(.5),";color:",(e=>e.theme.gray400),";font-size:",(e=>e.theme.fontSizeSmall),";text-decoration:underline;text-decoration-style:dotted;"),ue=(0,n.Z)("div",{target:"evt2a1f0"})({name:"nxv87c",styles:"grid-column:3/3"}),ce=(0,h.t)("Where to look. In the simplest case this can be an attribute name.");class he extends a.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{suggestions:[],fieldValues:[],activeSuggestion:0,showSuggestions:!1,hideCaret:!1,help:ce}),(0,i.Z)(this,"selectorField",(0,a.createRef)()),(0,i.Z)(this,"suggestionList",(0,a.createRef)()),(0,i.Z)(this,"handleChange",(e=>{this.loadFieldValues(e),this.props.onChange(e)})),(0,i.Z)(this,"handleClickOutside",(()=>{this.setState({showSuggestions:!1,hideCaret:!1})})),(0,i.Z)(this,"handleClickSuggestionItem",(e=>()=>{const t=this.getNewFieldValues(e);this.setState({fieldValues:t,activeSuggestion:0,showSuggestions:!1,hideCaret:!1},this.changeParentValue)})),(0,i.Z)(this,"handleKeyDown",((e,t)=>{t.persist();const{keyCode:s}=t,{activeSuggestion:i,suggestions:n}=this.state;if(8!==s&&32!==s)if(13!==s)if(38!==s)if(40!==s);else{if(i===n.length-1)return;this.setState({activeSuggestion:i+1},(()=>{this.scrollToSuggestion()}))}else{if(0===i)return;this.setState({activeSuggestion:i-1},(()=>{this.scrollToSuggestion()}))}else this.handleClickSuggestionItem(n[i])();else this.toggleSuggestions(!0)})),(0,i.Z)(this,"handleFocus",(()=>{this.toggleSuggestions(!0)}))}componentDidMount(){this.loadFieldValues(this.props.value),this.toggleSuggestions(!1)}componentDidUpdate(e){e.suggestions!==this.props.suggestions&&(this.loadFieldValues(this.props.value),this.toggleSuggestions(!1)),e.isRegExMatchesSelected===this.props.isRegExMatchesSelected&&e.value===this.props.value||this.checkPossiblyRegExMatchExpression(this.props.value)}getAllSuggestions(){return[...this.getValueSuggestions(),...A,...C]}getValueSuggestions(){return this.props.suggestions||[]}getFilteredSuggestions(e,t){let s=[];switch(t){case Z.BINARY:s=C;break;case Z.VALUE:s=this.getValueSuggestions();break;case Z.UNARY:s=A;break;default:s=[...this.getValueSuggestions(),...A]}return s.filter((t=>t.value.toLowerCase().indexOf(e.toLowerCase())>-1))}getNewSuggestions(e){const t=e[e.length-1],s=e[e.length-2];return Array.isArray(t)?this.getNewSuggestions(t):Array.isArray(s)?"binary"===(null==t?void 0:t.type)?this.getFilteredSuggestions(null==t?void 0:t.value,Z.VALUE):this.getFilteredSuggestions("",Z.BINARY):"value"===(null==t?void 0:t.type)&&"unary"===(null==s?void 0:s.type)?this.getFilteredSuggestions(null==t?void 0:t.value,Z.VALUE):"unary"===(null==t?void 0:t.type)?this.getFilteredSuggestions("",Z.VALUE):"string"===(null==t?void 0:t.type)&&"value"===(null==s?void 0:s.type)?this.getFilteredSuggestions("",Z.BINARY):"string"!==(null==t?void 0:t.type)||"string"!==(null==s?void 0:s.type)||null!=s&&s.value?("string"!==(null==s?void 0:s.type)||null!=t&&t.value)&&("value"!==(null==s?void 0:s.type)||null!=t&&t.value)&&"binary"!==(null==t?void 0:t.type)?this.getFilteredSuggestions(null==t?void 0:t.value,null==t?void 0:t.type):this.getFilteredSuggestions(null==t?void 0:t.value,Z.BINARY):this.getFilteredSuggestions("",Z.STRING)}loadFieldValues(e){const t=[],s=e.split(" ");for(const e in s){const i=s[e],n=t[t.length-1];if(n&&!Array.isArray(n)&&!n.value&&!i)continue;if(i.includes("!")&&i.split("!")[1]){const e=i.split("!")[1],s=this.getAllSuggestions().find((t=>t.value===e));if(!s){t.push([A[0],{type:Z.STRING,value:e}]);continue}t.push([A[0],s]);continue}const a=this.getAllSuggestions().find((e=>e.value===i));a?t.push(a):t.push({type:Z.STRING,value:i})}const i=this.getNewSuggestions(t);this.setState({fieldValues:t,activeSuggestion:0,suggestions:i})}scrollToSuggestion(){var e,t;const{activeSuggestion:s,hideCaret:i}=this.state;null===(e=this.suggestionList)||void 0===e||null===(t=e.current)||void 0===t||t.children[s].scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),i||this.setState({hideCaret:!0})}changeParentValue(){const{onChange:e}=this.props,{fieldValues:t}=this.state,s=[];for(const e in t){const d=t[e];var i,n,a,o,r,l;Array.isArray(d)?(null!==(i=d[0])&&void 0!==i&&i.value||null!==(n=d[1])&&void 0!==n&&n.value)&&s.push(`${null!==(a=null===(o=d[0])||void 0===o?void 0:o.value)&&void 0!==a?a:""}${null!==(r=null===(l=d[1])||void 0===l?void 0:l.value)&&void 0!==r?r:""}`):s.push(d.value)}e(s.join(" "))}getNewFieldValues(e){const t=[...this.state.fieldValues],s=t[t.length-1];return(0,ne.ri)(s)?Array.isArray(s)?(t[t.length-1]=[s[0],e],t):("unary"===(null==s?void 0:s.type)&&(t[t.length-1]=[s,e]),"string"!==(null==s?void 0:s.type)||null!=s&&s.value||(t[t.length-1]=e),t):[e]}checkPossiblyRegExMatchExpression(e){const{isRegExMatchesSelected:t}=this.props,{help:s}=this.state;if(t)return void(s&&this.setState({help:""}));const i=RegExp("^/.*/g?$").test(e);s?i||this.setState({help:ce}):i&&this.setState({help:(0,h.t)("You might want to change Data Type's value to 'Regex matches'")})}toggleSuggestions(e){this.setState({showSuggestions:e})}render(){const{error:e,value:t,onBlur:s}=this.props,{showSuggestions:i,suggestions:n,activeSuggestion:o,hideCaret:r,help:l}=this.state;return(0,B.BX)(ge,{ref:this.selectorField,hideCaret:r,children:[(0,B.tZ)(ve,{"data-test-id":"source-field",type:"text",label:(0,h.t)("Source"),name:"source",placeholder:(0,h.t)("Enter a custom attribute, variable or header name"),onChange:this.handleChange,autoComplete:"off",value:t,error:e,help:l,onKeyDown:this.handleKeyDown,onBlur:s,onFocus:this.handleFocus,inline:!1,flexibleControlStateSize:!0,stacked:!0,required:!0,showHelpInTooltip:!0}),i&&n.length>0&&(0,B.BX)(a.Fragment,{children:[(0,B.tZ)(me,{ref:this.suggestionList,error:e,"data-test-id":"source-suggestions",children:n.slice(0,50).map(((e,t)=>(0,B.BX)(ye,{onClick:this.handleClickSuggestionItem(e),active:t===o,tabIndex:-1,children:[(0,B.tZ)(ie.Z,{children:e.value}),e.description&&(0,B.BX)(fe,{children:["(",(0,B.tZ)(ie.Z,{children:e.description}),")"]}),e.examples&&e.examples.length>0&&(0,B.tZ)(re,{examples:e.examples,sourceName:e.value})]},e.value)))}),(0,B.tZ)(be,{onClick:this.handleClickOutside})]})]})}}he.displayName="SourceField";const pe=he,ge=(0,n.Z)("div",{target:"e1lnf3935"})("position:relative;width:100%;",(e=>e.hideCaret&&"caret-color: transparent;"),";"),ve=(0,n.Z)(se.Z,{target:"e1lnf3934"})({name:"1wsr984",styles:"z-index:1002;:focus{outline:none;}"}),me=(0,n.Z)("ul",{target:"e1lnf3933"})("position:absolute;width:",(e=>e.error?"calc(100% - 34px)":"100%"),";padding-left:0;list-style:none;margin-bottom:0;box-shadow:0 2px 0 rgba(37, 11, 54, 0.04);border:1px solid ",(e=>e.theme.border),";border-radius:0 0 ",(0,p.Z)(.5)," ",(0,p.Z)(.5),";background:",(e=>e.theme.background),";top:63px;left:0;z-index:1002;overflow:hidden;max-height:200px;overflow-y:auto;"),ye=(0,n.Z)("li",{target:"e1lnf3932"})("display:grid;grid-template-columns:auto 1fr max-content;gap:",(0,p.Z)(1),";border-bottom:1px solid ",(e=>e.theme.border),";padding:",(0,p.Z)(1)," ",(0,p.Z)(2),";font-size:",(e=>e.theme.fontSizeMedium),";cursor:pointer;background:",(e=>e.active?e.theme.backgroundSecondary:e.theme.background),";:hover{background:",(e=>(e.active,e.theme.backgroundSecondary)),";}"),fe=(0,n.Z)("div",{target:"e1lnf3931"})("display:flex;overflow:hidden;color:",(e=>e.theme.gray300),";"),be=(0,n.Z)("div",{target:"e1lnf3930"})({name:"1ljbwes",styles:"position:fixed;top:0;left:0;right:0;bottom:0;z-index:1001"});class Se extends a.Component{constructor(){var e;super(...arguments),(0,i.Z)(this,"state",{displayEventId:!(null===(e=this.props.eventId)||void 0===e||!e.value)}),(0,i.Z)(this,"handleChange",(e=>t=>{this.props.onChange(e,t.target.value)})),(0,i.Z)(this,"handleToggleEventId",(()=>{this.setState((e=>({displayEventId:!e.displayEventId})))}))}render(){const{values:e,onChange:t,errors:s,onValidate:i,sourceSuggestions:n,onUpdateEventId:o,eventId:r}=this.props,{method:l,type:d,source:u}=e,{displayEventId:c}=this.state;return(0,B.BX)(a.Fragment,{children:[(0,B.BX)(xe,{hasTwoColumns:e.method===b.REPLACE,children:[(0,B.tZ)(T.Z,{"data-test-id":"method-field",label:(0,h.t)("Method"),help:(0,h.t)("What to do"),inline:!1,flexibleControlStateSize:!0,stacked:!0,showHelpInTooltip:!0,children:(0,B.tZ)(Q,{placeholder:(0,h.t)("Select method"),name:"method",options:N()(Object.values(b)).map((e=>({...R(e),value:e}))),value:l,onChange:e=>t("method",null==e?void 0:e.value)})}),e.method===b.REPLACE&&(0,B.tZ)(T.Z,{"data-test-id":"placeholder-field",label:(0,h.t)("Custom Placeholder (Optional)"),help:(0,h.t)("It will replace the default placeholder [Filtered]"),inline:!1,flexibleControlStateSize:!0,stacked:!0,showHelpInTooltip:!0,children:(0,B.tZ)(k.Z,{type:"text",name:"placeholder",placeholder:`[${(0,h.t)("Filtered")}]`,onChange:this.handleChange("placeholder"),value:e.placeholder})})]}),(0,B.BX)(xe,{hasTwoColumns:e.type===f.PATTERN,children:[(0,B.tZ)(T.Z,{"data-test-id":"type-field",label:(0,h.t)("Data Type"),help:(0,h.t)("What to look for. Use an existing pattern or define your own using regular expressions."),inline:!1,flexibleControlStateSize:!0,stacked:!0,showHelpInTooltip:!0,children:(0,B.tZ)(Q,{placeholder:(0,h.t)("Select type"),name:"type",options:N()(Object.values(f)).map((e=>({label:I(e),value:e}))),value:d,onChange:e=>t("type",null==e?void 0:e.value)})}),e.type===f.PATTERN&&(0,B.tZ)(T.Z,{"data-test-id":"regex-field",label:(0,h.t)("Regex matches"),help:(0,h.t)("Custom regular expression (see documentation)"),inline:!1,error:null==s?void 0:s.pattern,flexibleControlStateSize:!0,stacked:!0,required:!0,showHelpInTooltip:!0,children:(0,B.tZ)(Ie,{type:"text",name:"pattern",placeholder:(0,h.t)("[a-zA-Z0-9]+"),onChange:this.handleChange("pattern"),value:e.pattern,onBlur:i("pattern")})})]}),(0,B.tZ)(Re,{children:c?(0,B.BX)(Ce,{priority:"link",onClick:this.handleToggleEventId,children:[(0,h.t)("Hide event ID field"),(0,B.tZ)(U.g6,{direction:"up",size:"xs"})]}):(0,B.BX)(Ce,{priority:"link",onClick:this.handleToggleEventId,children:[(0,h.t)("Use event ID for auto-completion"),(0,B.tZ)(U.g6,{direction:"down",size:"xs"})]})}),(0,B.BX)(Ee,{isExpanded:c,children:[c&&(0,B.tZ)(H,{onUpdateEventId:o,eventId:r}),(0,B.tZ)(pe,{onChange:e=>t("source",e),value:u,error:null==s?void 0:s.source,onBlur:i("source"),isRegExMatchesSelected:d===f.PATTERN,suggestions:n})]})]})}}Se.displayName="Form";const Ze=Se,xe=(0,n.Z)("div",{target:"eph2y5h4"})("display:grid;margin-bottom:",(0,p.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints.small),"){gap:",(0,p.Z)(2),";",(e=>e.hasTwoColumns&&"grid-template-columns: 1fr 1fr;")," margin-bottom:",(e=>e.hasTwoColumns?0:(0,p.Z)(2)),";}"),Ee=(0,n.Z)("div",{target:"eph2y5h3"})("height:65px;transition:all 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition-property:height;",(e=>e.isExpanded&&`\n    border-radius: ${e.theme.borderRadius};\n    border: 1px solid ${e.theme.border};\n    box-shadow: ${e.theme.dropShadowLight};\n    margin: ${(0,p.Z)(2)} 0 ${(0,p.Z)(3)} 0;\n    padding: ${(0,p.Z)(2)};\n    height: 180px;\n  `),";"),Ie=(0,n.Z)(k.Z,{target:"eph2y5h2"})("font-family:",(e=>e.theme.text.familyMono),";"),Re=(0,n.Z)("div",{target:"eph2y5h1"})({name:"skgbeu",styles:"display:flex;justify-content:flex-end"}),Ce=(0,n.Z)(d.ZP,{target:"eph2y5h0"})("font-weight:700;color:",(e=>e.theme.subText),";&:hover,&:focus{color:",(e=>e.theme.textColor),";}>*:first-child{display:grid;gap:",(0,p.Z)(.5),";grid-template-columns:repeat(2, max-content);align-items:center;}");let Ae;!function(e){e.Unknown="unknown",e.InvalidSelector="invalid-selector",e.RegexParse="regex-parse"}(Ae||(Ae={}));var we=s("./app/components/buttonBar.tsx");const De=e=>{let{title:t,onSave:s,content:i,disabled:n,Header:o,Body:r,Footer:l,closeModal:u}=e;return(0,B.BX)(a.Fragment,{children:[(0,B.tZ)(o,{closeButton:!0,children:t}),(0,B.tZ)(r,{children:i}),(0,B.tZ)(l,{children:(0,B.BX)(we.ZP,{gap:1.5,children:[(0,B.tZ)(d.ZP,{onClick:u,children:(0,h.t)("Cancel")}),(0,B.tZ)(d.ZP,{onClick:s,disabled:n,priority:"primary",children:(0,h.t)("Save Rule")})]})})]})};De.displayName="Modal";const Ne=De;class ke extends a.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",this.getDefaultState()),(0,i.Z)(this,"handleChange",((e,t)=>{const s={...this.state.values,[e]:t};s.type!==f.PATTERN&&s.pattern&&(s.pattern=""),s.method!==b.REPLACE&&s.placeholder&&(s.placeholder=""),this.setState((t=>({values:s,requiredValues:this.getRequiredValues(s),errors:y()(t.errors,e)})))})),(0,i.Z)(this,"handleSave",(async()=>{const{endpoint:e,api:t,onSubmitSuccess:s,closeModal:i,onGetNewRules:n}=this.props,a=n(this.state.values);try{s(await E(t,e,a)),i()}catch(e){this.convertRequestError(function(e){var t;const s=null===(t=e.responseJSON)||void 0===t?void 0:t.relayPiiConfig[0];if(!s)return{type:Ae.Unknown,message:(0,h.t)("Unknown error occurred while saving data scrubbing rule")};if(s.startsWith("invalid selector: "))for(const e of s.split("\n"))if(e.startsWith("1 | ")){const t=e.slice(3);return{type:Ae.InvalidSelector,message:(0,h.t)("Invalid source value: %s",t)}}if(s.startsWith("regex parse error:"))for(const e of s.split("\n"))if(e.startsWith("error:")){const t=e.slice(6).replace(/at line \d+ column \d+/,"");return{type:Ae.RegexParse,message:(0,h.t)("Invalid regex: %s",t)}}return{type:Ae.Unknown,message:(0,h.t)("An unknown error occurred while saving data scrubbing rule")}}(e))}})),(0,i.Z)(this,"handleValidate",(e=>()=>{const t=!this.state.values[e].trim(),s=this.state.errors[e];t&&s||(!t||s?!t&&s&&this.clearError(e):this.setState((t=>({errors:{...t.errors,[e]:(0,h.t)("Field Required")}}))))})),(0,i.Z)(this,"handleUpdateEventId",(e=>{e!==this.state.eventId.value&&this.setState({eventId:{value:e,status:S.UNDEFINED}})}))}componentDidMount(){this.handleValidateForm()}componentDidUpdate(e,t){v()(t.values,this.state.values)||this.handleValidateForm(),t.eventId.value!==this.state.eventId.value&&this.loadSourceSuggestions(),t.eventId.status!==this.state.eventId.status&&O(this.state.eventId,this.state.sourceSuggestions)}getDefaultState(){const{eventId:e,sourceSuggestions:t}=function(){const e=function(){const e=V.Z.getItem(L);if(e)try{return JSON.parse(e)}catch(t){return void P.$e((s=>{s.setExtra("storage",e),P.Tb(t)}))}}();if(!e){const e={eventId:"",sourceSuggestions:w};return F(e),e}return e}(),s=this.getInitialValues();return{values:s,requiredValues:this.getRequiredValues(s),errors:{},isFormValid:!1,eventId:{value:e,status:e?S.LOADED:S.UNDEFINED},sourceSuggestions:t}}getInitialValues(){var e,t,s,i,n;const{initialState:a}=this.props;return{type:null!==(e=null==a?void 0:a.type)&&void 0!==e?e:f.CREDITCARD,method:null!==(t=null==a?void 0:a.method)&&void 0!==t?t:b.MASK,source:null!==(s=null==a?void 0:a.source)&&void 0!==s?s:"",placeholder:null!==(i=null==a?void 0:a.placeholder)&&void 0!==i?i:"",pattern:null!==(n=null==a?void 0:a.pattern)&&void 0!==n?n:""}}getRequiredValues(e){const{type:t}=e,s=["type","method","source"];return t===f.PATTERN&&s.push("pattern"),s}clearError(e){this.setState((t=>({errors:y()(t.errors,e)})))}async loadSourceSuggestions(){const{orgSlug:e,projectId:t,api:s}=this.props,{eventId:i}=this.state;if(i.value){this.setState((e=>({sourceSuggestions:w,eventId:{...e.eventId,status:S.LOADING}})));try{const n={eventId:i.value};t&&(n.projectId=t);const a=(await s.requestPromise(`/organizations/${e}/data-scrubbing-selector-suggestions/`,{query:n})).suggestions;if(a&&a.length>0)return void this.setState((e=>({sourceSuggestions:a,eventId:{...e.eventId,status:S.LOADED}})));this.setState((e=>({sourceSuggestions:w,eventId:{...e.eventId,status:S.NOT_FOUND}})))}catch{this.setState((e=>({eventId:{...e.eventId,status:S.ERROR}})))}}else this.setState((e=>({sourceSuggestions:w,eventId:{...e.eventId,status:S.UNDEFINED}})))}convertRequestError(e){switch(e.type){case Ae.InvalidSelector:this.setState((t=>({errors:{...t.errors,source:e.message}})));break;case Ae.RegexParse:this.setState((t=>({errors:{...t.errors,pattern:e.message}})));break;default:(0,o.Iw)(e.message)}}handleValidateForm(){const{values:e,requiredValues:t}=this.state,s=t.every((t=>!!e[t]));this.setState({isFormValid:s})}render(){const{values:e,errors:t,isFormValid:s,eventId:i,sourceSuggestions:n}=this.state,{title:a}=this.props;return(0,B.tZ)(Ne,{...this.props,title:a,onSave:this.handleSave,disabled:!s,content:(0,B.tZ)(Ze,{onChange:this.handleChange,onValidate:this.handleValidate,onUpdateEventId:this.handleUpdateEventId,eventId:i,errors:t,values:e,sourceSuggestions:n})})}}ke.displayName="ModalManager";const Te=ke,Ue=e=>{let{savedRules:t,...s}=e;return(0,B.tZ)(Te,{...s,savedRules:t,title:(0,h.t)("Add an advanced data scrubbing rule"),onGetNewRules:e=>[...t,{...e,id:t.length}]})};Ue.displayName="Add";const Pe=Ue,Ve=e=>{let{savedRules:t,rule:s,...i}=e;return(0,B.tZ)(Te,{...i,savedRules:t,title:(0,h.t)("Edit an advanced data scrubbing rule"),initialState:s,onGetNewRules:e=>{const i={...e,id:s.id};return t.map((e=>e.id===i.id?i:e))}})};Ve.displayName="Edit";const Le=Ve;var Fe=s("./app/views/settings/components/emptyMessage.tsx");const Oe=e=>{const{method:t,type:s,source:i}=e,n=R(t),a=I(s),o=[];return o.push(`[${n.label}]`),o.push(e.type===f.PATTERN?`[${e.pattern}]`:`[${a}]`),e.method===b.REPLACE&&e.placeholder&&o.push(` with [${e.placeholder}]`),`${o.join(" ")} ${(0,h.t)("from")} [${i}]`},Me=(0,a.forwardRef)((function(e,t){let{rules:s,onEditRule:i,onDeleteRule:n,disabled:a}=e;return(0,B.tZ)(ze,{ref:t,isDisabled:a,"data-test-id":"advanced-data-scrubbing-rules",children:s.map((e=>{const{id:t}=e;return(0,B.BX)(Be,{children:[(0,B.tZ)(ie.Z,{children:Oe(e)}),i&&(0,B.tZ)(d.ZP,{"aria-label":(0,h.t)("Edit Rule"),size:"sm",onClick:i(t),icon:(0,B.tZ)(U.yl,{}),disabled:a}),n&&(0,B.tZ)(d.ZP,{"aria-label":(0,h.t)("Delete Rule"),size:"sm",onClick:n(t),icon:(0,B.tZ)(U.Fz,{}),disabled:a})]},t)}))})})),ze=(0,n.Z)("ul",{target:"e5ykfeb1"})("list-style:none;margin:0;padding:0;margin-bottom:0!important;",(e=>e.isDisabled&&`\n      color: ${e.theme.gray200};\n      background: ${e.theme.backgroundSecondary};\n  `),";"),Be=(0,n.Z)("li",{target:"e5ykfeb0"})("display:grid;grid-template-columns:auto max-content max-content;grid-column-gap:",(0,p.Z)(1),";align-items:center;padding:",(0,p.Z)(1)," ",(0,p.Z)(2),";border-bottom:1px solid ",(e=>e.theme.border),";&:hover{background-color:",(e=>e.theme.backgroundSecondary),";}&:last-child{border-bottom:0;}"),_e=e=>{let{rules:t,disabled:s,onDeleteRule:i,onEditRule:n}=e;return 0===t.length?(0,B.tZ)(Fe.Z,{icon:(0,B.tZ)(U.FC,{size:"xl"}),description:(0,h.t)("You have no data scrubbing rules")}):(0,B.tZ)(Me,{rules:t,onDeleteRule:i,onEditRule:n,disabled:s})};_e.displayName="Content";const je=_e,$e=function(e){const t=e?JSON.parse(e):{},s=t.rules||{},i=t.applications||{},n=[];for(const e in i)for(const t of i[e]){const i=s[t],a=n.length,o=e;if(!i){if("@"===t[0]){const e=t.slice(1).split(":");let[s]=e;const[,i]=e;"urlauth"===s&&(s="url_auth"),"usssn"===s&&(s="us_ssn"),n.push({id:a,method:i,type:s,source:o})}continue}const{type:r,redaction:l}=i,d=l.method;d!==b.REPLACE||i.type!==f.PATTERN?d!==b.REPLACE?i.type!==f.PATTERN?n.push({id:a,method:d,type:r,source:o}):n.push({id:a,method:d,type:f.PATTERN,source:o,pattern:i.pattern}):n.push({id:a,method:b.REPLACE,type:r,source:o,placeholder:null==l?void 0:l.text}):n.push({id:a,method:b.REPLACE,type:f.PATTERN,source:o,placeholder:null==l?void 0:l.text,pattern:i.pattern})}return n};class Xe extends a.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{isCollapsed:!0}),(0,i.Z)(this,"rulesRef",(0,a.createRef)()),(0,i.Z)(this,"handleToggleCollapsed",(()=>{this.setState((e=>({isCollapsed:!e.isCollapsed})))}))}componentDidUpdate(){this.loadContentHeight()}loadContentHeight(){if(!this.state.contentHeight){var e;const t=null===(e=this.rulesRef.current)||void 0===e?void 0:e.offsetHeight;t&&this.setState({contentHeight:`${t}px`})}}render(){const{rules:e}=this.props,{isCollapsed:t,contentHeight:s}=this.state;return 0===e.length?(0,B.tZ)(Ge,{children:(0,h.t)("There are no data scrubbing rules at the organization level")}):(0,B.BX)(Ge,{isCollapsed:t,contentHeight:s,children:[(0,B.BX)(Ye,{onClick:this.handleToggleCollapsed,children:[(0,B.tZ)("div",{children:(0,h.t)("Organization Rules")}),(0,B.tZ)(d.ZP,{title:t?(0,h.t)("Expand Organization Rules"):(0,h.t)("Collapse Organization Rules"),icon:(0,B.tZ)(U.g6,{size:"xs",direction:t?"down":"up"}),size:"xs","aria-label":(0,h.t)("Toggle Organization Rules")})]}),(0,B.tZ)(qe,{children:(0,B.tZ)(Me,{rules:e,ref:this.rulesRef,disabled:!0})})]})}}Xe.displayName="OrganizationRules";const He=Xe,qe=(0,n.Z)("div",{target:"epx0t0h2"})({name:"ns4bq7",styles:"transition:height 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;height:0;overflow:hidden"}),Ye=(0,n.Z)("div",{target:"epx0t0h1"})("cursor:pointer;display:grid;grid-template-columns:1fr auto;align-items:center;border-bottom:1px solid ",(e=>e.theme.border),";padding:",(0,p.Z)(1)," ",(0,p.Z)(2),";"),Ge=(0,n.Z)("div",{target:"epx0t0h0"})("color:",(e=>e.theme.gray200),";background:",(e=>e.theme.backgroundSecondary),";",(e=>!e.contentHeight&&`padding: ${(0,p.Z)(1)} ${(0,p.Z)(2)}`),";",(e=>!e.isCollapsed&&` border-bottom: 1px solid ${e.theme.border}`),";",(e=>!e.isCollapsed&&e.contentHeight&&`\n      ${qe} {\n        height: ${e.contentHeight};\n      }\n    `),";"),Ke="https://docs.sentry.io/product/data-management-settings/scrubbing/advanced-datascrubbing/";class We extends a.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{rules:[],savedRules:[],relayPiiConfig:this.props.relayPiiConfig,orgRules:[]}),(0,i.Z)(this,"api",new l.KU),(0,i.Z)(this,"handleOpenAddModal",(()=>{const{rules:e}=this.state;(0,r.openModal)((t=>(0,B.tZ)(Pe,{...t,projectId:this.props.projectId,savedRules:e,api:this.api,endpoint:this.props.endpoint,orgSlug:this.props.organization.slug,onSubmitSuccess:e=>{this.successfullySaved(e,(0,h.t)("Successfully added data scrubbing rule"))}})))})),(0,i.Z)(this,"handleOpenEditModal",(e=>()=>{const{rules:t}=this.state;(0,r.openModal)((s=>(0,B.tZ)(Le,{...s,rule:t[e],projectId:this.props.projectId,savedRules:t,api:this.api,endpoint:this.props.endpoint,orgSlug:this.props.organization.slug,onSubmitSuccess:e=>{this.successfullySaved(e,(0,h.t)("Successfully updated data scrubbing rule"))}})))})),(0,i.Z)(this,"handleDelete",(e=>async()=>{const{rules:t}=this.state,s=t.filter((t=>t.id!==e));try{const e=await E(this.api,this.props.endpoint,s);if(null!=e&&e.relayPiiConfig){const t=$e(e.relayPiiConfig);this.setState({rules:t}),(0,o.S9)((0,h.t)("Successfully deleted data scrubbing rule"))}}catch{(0,o.Iw)((0,h.t)("An unknown error occurred while deleting data scrubbing rule"))}}))}componentDidMount(){this.loadRules(),this.loadOrganizationRules()}componentDidUpdate(e,t){t.relayPiiConfig!==this.state.relayPiiConfig&&this.loadRules()}componentWillUnmount(){this.api.clear()}loadOrganizationRules(){const{organization:e,projectId:t}=this.props;if(t)try{this.setState({orgRules:$e(e.relayPiiConfig)})}catch{(0,o.Iw)((0,h.t)("Unable to load organization rules"))}}loadRules(){try{const e=$e(this.state.relayPiiConfig);this.setState({rules:e,savedRules:e})}catch{(0,o.Iw)((0,h.t)("Unable to load project rules"))}}successfullySaved(e,t){const{onSubmitSuccess:s}=this.props;this.setState({rules:$e(e.relayPiiConfig)}),(0,o.S9)(t),null==s||s(e)}render(){const{additionalContext:e,disabled:t,projectId:s}=this.props,{orgRules:i,rules:n}=this.state;return(0,B.BX)(c.s_,{"data-test-id":"advanced-data-scrubbing",id:"advanced-data-scrubbing",children:[(0,B.tZ)(c.V9,{children:(0,B.tZ)("div",{children:(0,h.t)("Advanced Data Scrubbing")})}),(0,B.BX)(c.aU,{type:"info",children:[e," ",`${(0,h.t)("The new rules will only apply to upcoming events. ")}`," ",(0,h._N)("For more details, see [linkToDocs].",{linkToDocs:(0,B.tZ)(u.Z,{href:Ke,children:(0,h.t)("full documentation on data scrubbing")})})]}),(0,B.BX)(c.N,{children:[s&&(0,B.tZ)(He,{rules:i}),(0,B.tZ)(je,{rules:n,onDeleteRule:this.handleDelete,onEditRule:this.handleOpenEditModal,disabled:t}),(0,B.BX)(Qe,{children:[(0,B.tZ)(d.ZP,{href:Ke,external:!0,children:(0,h.t)("Read Docs")}),(0,B.tZ)(d.ZP,{disabled:t,onClick:this.handleOpenAddModal,priority:"primary",children:(0,h.t)("Add Rule")})]})]})]})}}We.displayName="DataScrubbing";const Je=We,Qe=(0,n.Z)("div",{target:"eqomu9m0"})("padding:",(0,p.Z)(1)," ",(0,p.Z)(2),";position:relative;display:grid;gap:",(0,p.Z)(1),";grid-template-columns:auto auto;justify-content:flex-end;border-top:1px solid ",(e=>e.theme.border),";")}}]);
//# sourceMappingURL=../sourcemaps/app_utils_crashReports_tsx-app_views_settings_components_dataScrubbing_index_tsx.67ddd30c12fb993744df5022dfb38dbb.js.map