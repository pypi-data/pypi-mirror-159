"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_createAlertButton_tsx"],{"./app/components/createAlertButton.tsx":(e,t,r)=>{r.d(t,{K:()=>Z,Z:()=>A});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/react/index.js")),a=r("../node_modules/react-router/es/index.js"),s=r("./app/actionCreators/indicator.tsx"),i=r("./app/actionCreators/navigation.tsx"),l=r("./app/components/acl/access.tsx"),c=r("./app/components/alert.tsx"),u=r("./app/components/assistant/guideAnchor.tsx"),d=r("./app/components/button.tsx"),p=r("./app/components/links/link.tsx"),g=r("./app/icons/index.tsx"),m=r("./app/locale.tsx"),y=r("./app/utils/discover/fields.tsx"),v=r("./app/utils/useApi.tsx"),h=r("./app/views/alerts/rules/metric/constants.tsx"),f=r("./app/views/alerts/utils/index.tsx"),j=r("./app/views/alerts/wizard/options.tsx"),b=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function x(e){let{incompatibleQuery:t,eventView:r,orgId:n,onClose:a}=e;const{hasProjectError:s,hasEnvironmentError:i,hasEventTypeError:l,hasYAxisError:c}=t,u=Object.values(t).filter((e=>e)).length,y=r.clone();y.query+=" event.type:error";const v=r.clone();v.query+=" event.type:transaction";const h=r.clone();h.query+=" event.type:default";const f=r.clone();f.query+=" event.type:error or event.type:default";const j=`/organizations/${n}/discover/results/`,x={error:(0,b.tZ)(p.Z,{to:{pathname:j,query:y.generateQueryStringObject()}}),default:(0,b.tZ)(p.Z,{to:{pathname:j,query:h.generateQueryStringObject()}}),transaction:(0,b.tZ)(p.Z,{to:{pathname:j,query:v.generateQueryStringObject()}}),errorDefault:(0,b.tZ)(p.Z,{to:{pathname:j,query:f.generateQueryStringObject()}})};return(0,b.BX)(z,{type:"warning",showIcon:!0,trailingItems:(0,b.tZ)(d.ZP,{icon:(0,b.tZ)(g.bM,{size:"sm"}),"aria-label":(0,m.t)("Close"),size:"zero",onClick:a,borderless:!0}),children:[1===u&&(0,b.BX)(o.Fragment,{children:[s&&(0,m.t)("An alert can use data from only one Project. Select one and try again."),i&&(0,m.t)("An alert supports data from a single Environment or All Environments. Pick one try again."),l&&(0,m._N)("An alert needs a filter of [error:event.type:error], [default:event.type:default], [transaction:event.type:transaction], [errorDefault:(event.type:error OR event.type:default)]. Use one of these and try again.",x),c&&(0,m._N)("An alert can’t use the metric [yAxis] just yet. Select another metric and try again.",{yAxis:(0,b.tZ)(_,{children:r.getYAxis()})})]}),u>1&&(0,b.BX)(o.Fragment,{children:[(0,m.t)("Yikes! That button didn’t work. Please fix the following problems:"),(0,b.BX)(k,{children:[s&&(0,b.tZ)("li",{children:(0,m.t)("Select one Project.")}),i&&(0,b.tZ)("li",{children:(0,m.t)("Select a single Environment or All Environments.")}),l&&(0,b.tZ)("li",{children:(0,m._N)("Use the filter [error:event.type:error], [default:event.type:default], [transaction:event.type:transaction], [errorDefault:(event.type:error OR event.type:default)].",x)}),c&&(0,b.tZ)("li",{children:(0,m._N)("An alert can’t use the metric [yAxis] just yet. Select another metric and try again.",{yAxis:(0,b.tZ)(_,{children:r.getYAxis()})})})]})]})]})}function Z(e){var t,r;let{projects:n,eventView:o,organization:a,referrer:s,onIncompatibleQuery:i,onSuccess:l,useAlertWizardV3:c,alertType:u,...d}=e;const p=1!==o.project.length||-1===o.project[0],g=o.environment.length>1,v=null===(0,f.A4)(o.query),Z=function(e){var t;const r=(0,y.nr)(e.getYAxis());if("field"===r.kind||"equation"===r.kind||"calculatedField"===r.kind)return!0;const n=e.query.match(/event\.type:(transaction|error)/);if(!n)return!1;const o="error"===n[1]?h.yq:h.Yp,a=!o.aggregations.includes(r.function[0]),s=y.lx[r.function[0]];if(!s)return!1;const i=s.parameters.some((e=>"value"===e.kind&&"number"===e.dataType)),l=["",...o.fields,...null!==(t=o.measurementKeys)&&void 0!==t?t:[]],c=!i&&!l.includes(r.function[1]);return a||c}(o),A={hasProjectError:p,hasEnvironmentError:g,hasEventTypeError:v,hasYAxisError:Z},z=n.find((e=>e.id===`${o.project[0]}`)),k=o.generateQueryStringObject();null!==(t=k.query)&&void 0!==t&&t.includes(`project:${null==z?void 0:z.slug}`)&&(k.query=k.query.replace(`project:${null==z?void 0:z.slug}`,""));const _=Object.values(A).some((e=>e)),E=u?j.FZ[u]:j.F4,$=_?void 0:{pathname:c?`/organizations/${a.slug}/alerts/new/metric/`:`/organizations/${a.slug}/alerts/${null==z?void 0:z.slug}/new/`,query:{...k,createFromDiscover:!0,referrer:s,...c?{...E,project:null==z?void 0:z.slug,aggregate:null!==(r=k.yAxis)&&void 0!==r?r:E.aggregate}:{}}};return(0,b.tZ)(w,{organization:a,onClick:e=>{if(_)return e.preventDefault(),void i((e=>(0,b.tZ)(x,{incompatibleQuery:A,eventView:o,orgId:a.slug,onClose:e})),A);l()},to:$,"aria-label":(0,m.t)("Create Alert"),...d})}x.displayName="IncompatibleQueryAlert",Z.displayName="CreateAlertFromViewButton";const w=(0,a.withRouter)((e=>{let{organization:t,projectSlug:r,iconProps:n,referrer:o,router:a,hideIcon:c,showPermissionGuide:y,alertOption:h,onEnter:f,...j}=e;const x=(0,v.Z)(),Z=e=>{const r=t.features.includes("alert-wizard-v3"),n=r?`/organizations/${t.slug}/alerts`:`/organizations/${t.slug}/alerts/${e}`,a=[o?`referrer=${o}`:"",r&&e&&":projectId"!==e?`project=${e}`:"",h?`alert_option=${h}`:""].filter((e=>""!==e));return`${n}/wizard/${a.length?"?":""}${a.join("&")}`};function w(e){e.preventDefault(),null==f||f(),(0,i.T)(Z(":projectId"),a)}async function A(){const e=`/organizations/${t.slug}/`;(0,s.E3)();try{await x.requestPromise(e,{method:"PUT",data:{alertsMemberWrite:!0}}),(0,s.S9)((0,m.t)("Successfully updated organization settings"))}catch(e){(0,s.Iw)((0,m.t)("Unable to update organization settings"))}}const z=(0,m._N)("Ask your organization owner or manager to [settingsLink:enable alerts access] for you.",{settingsLink:(0,b.tZ)(p.Z,{to:`/settings/${t.slug}`})}),k=e=>{var t;return(0,b.tZ)(d.ZP,{disabled:!e,title:e?void 0:z,icon:!c&&(0,b.tZ)(g.vr,{...n}),to:r?Z(r):void 0,tooltipProps:{isHoverable:!0,position:"top",overlayStyle:{maxWidth:"270px"}},onClick:r?f:w,...j,children:null!==(t=j.children)&&void 0!==t?t:(0,m.t)("Create Alert")})},_=!t.alertsMemberWrite&&!!y;return(0,b.tZ)(l.Z,{organization:t,access:["alerts:write"],children:e=>{let{hasAccess:r}=e;return _?(0,b.tZ)(l.Z,{organization:t,access:["org:write"],children:e=>{let{hasAccess:t}=e;return(0,b.tZ)(u.Z,{target:t?"alerts_write_owner":"alerts_write_member",onFinish:t?A:void 0,children:k(r)})}}):k(r)}})})),A=w,z=(0,n.Z)(c.Z,{target:"e173ycuj2"})("color:",(e=>e.theme.textColor),";margin-bottom:0;"),k=(0,n.Z)("ul",{target:"e173ycuj1"})({name:"1ykowef",styles:"margin-bottom:0"}),_=(0,n.Z)("code",{target:"e173ycuj0"})({name:"1imza1v",styles:"background-color:transparent;padding:0"})}}]);
//# sourceMappingURL=../sourcemaps/app_components_createAlertButton_tsx.dd83f7fb14319e9fa99c8759b8f6a173.js.map